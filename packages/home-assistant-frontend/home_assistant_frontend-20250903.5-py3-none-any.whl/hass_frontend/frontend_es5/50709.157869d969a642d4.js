"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["50709"],{55815:function(t,i,e){e.d(i,{Eu:function(){return o},hZ:function(){return a},o9:function(){return c}});var s=e(28105),n=e(45657);const r=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function o(t){return r[t%r.length]}function a(t,i){const e=i.getPropertyValue(`--graph-color-${t+1}`)||o(t);return(0,n.Rq)(e)}const c=(0,s.Z)(t=>r.map((i,e)=>a(e,t)),(t,i)=>t[0].getPropertyValue("--graph-color-1")===i[0].getPropertyValue("--graph-color-1"))},32483:function(t,i,e){e.d(i,{U:function(){return l}});e(26847),e(27530);var s=e(55815),n=e(45657),r=e(66169),o=e(44272),a=e(87409),c=e(16230),h=e(17332);const d={media_player:{paused:.5,idle:1},vacuum:{returning:.5}};let u=0;const _=new Map;function l(t,i,e){return function(t,i,e){var s;if(!e||t===c.nZ)return(0,h.g)("--history-unavailable-color",i);if(t===c.lz)return(0,h.g)("--history-unknown-color",i);const u=(0,a.tD)(e,t);if(!u)return;const _=(0,h.g)(u,i);if(!_)return;const l=(0,o.M)(e.entity_id),f=null===(s=d[l])||void 0===s?void 0:s[t];return f?(0,n.uO)((0,r.C)((0,n.Rw)((0,n.wK)(_)),f)):_}(t,i,e)||function(t,i){if(_.has(t))return _.get(t);const e=(0,s.hZ)(u,i);return u++,_.set(t,e),e}(t,i)}},7214:function(t,i,e){e.d(i,{Cj:function(){return l},F7:function(){return n},Hs:function(){return H},Kd:function(){return S},Kj:function(){return y},Nw:function(){return p},PA:function(){return r},Py:function(){return h},Qm:function(){return I},Z0:function(){return b},_Y:function(){return u},_m:function(){return a},dL:function(){return d},dO:function(){return x},hN:function(){return f},h_:function(){return _},j2:function(){return w},q6:function(){return g},uR:function(){return c},yf:function(){return o}});e(39710),e(26847),e(81738),e(72489),e(56389),e(27530);var s=e(15459),n=function(t){return t[t.NONE=0]="NONE",t[t.ARITHMETIC=1]="ARITHMETIC",t[t.CIRCULAR=2]="CIRCULAR",t}({});const r=99387==e.j?["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"]:null,o=["L","gal","ft³","m³","CCF"],a=t=>t.sendMessagePromise({type:"recorder/info"}),c=(t,i)=>t.callWS({type:"recorder/list_statistic_ids",statistic_type:i}),h=(t,i)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:i}),d=(t,i,e,s,n="hour",r,o)=>t.callWS({type:"recorder/statistics_during_period",start_time:i.toISOString(),end_time:null==e?void 0:e.toISOString(),statistic_ids:s,period:n,units:r,types:o}),u=(t,i,e,s)=>t.callWS({type:"recorder/statistic_during_period",statistic_id:i,units:s,fixed_period:e.fixed_period?{start_time:e.fixed_period.start instanceof Date?e.fixed_period.start.toISOString():e.fixed_period.start,end_time:e.fixed_period.end instanceof Date?e.fixed_period.end.toISOString():e.fixed_period.end}:void 0,calendar:e.calendar,rolling_window:e.rolling_window}),_=t=>t.callWS({type:"recorder/validate_statistics"}),l=(t,i,e)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:i,unit_of_measurement:e}),f=(t,i)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:i}),y=t=>{let i=null;if(!t)return null;for(const e of t)null!==e.change&&void 0!==e.change&&(null===i?i=e.change:i+=e.change);return i},g=(t,i)=>{let e=null;for(const s of i){if(!(s in t))continue;const i=y(t[s]);null!==i&&(null===e?e=i:e+=i)}return e},p=(t,i)=>t.some(t=>void 0!==t[i]&&null!==t[i]),m=["mean","min","max"],v=["sum","state","change"],b=(t,i)=>!(!m.includes(i)||0===t.mean_type)||!(!v.includes(i)||!t.has_sum),w=(t,i,e,s,n)=>{const r=new Date(e).toISOString();return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:i,start_time:r,adjustment:s,adjustment_unit_of_measurement:n})},S=(t,i,e)=>{const n=t.states[i];return n?(0,s.C)(n):(null==e?void 0:e.name)||i},x=(t,i,e)=>{let s;var n;i&&(s=null===(n=t.states[i])||void 0===n?void 0:n.attributes.unit_of_measurement);return void 0===s?null==e?void 0:e.statistics_unit_of_measurement:s},H=t=>t.includes(":"),I=t=>t.callWS({type:"recorder/update_statistics_issues"})},69782:function(t,i,e){e.a(t,async function(t,s){try{e.r(i),e.d(i,{DEFAULT_HOURS_TO_SHOW:function(){return x},HuiHistoryGraphCard:function(){return H}});e(40777),e(26847),e(2394),e(81738),e(22960),e(87799),e(1455),e(27530);var n=e(73742),r=e(59048),o=e(7616),a=e(31733),c=e(37528),h=e(96778),d=(e(12942),e(31138),e(5786),e(89166)),u=e(92523),_=e(93647),l=e(55577),f=e(64637),y=e(7214),g=t([h,d]);[h,d]=g.then?(await g)():g;let p,m,v,b,w,S=t=>t;const x=24;class H extends r.oi{static async getConfigElement(){return await Promise.all([e.e("73614"),e.e("15601"),e.e("15634"),e.e("26452"),e.e("2769"),e.e("19596"),e.e("95115")]).then(e.bind(e,23374)),document.createElement("hui-history-graph-card-editor")}static getStubConfig(){return{type:"history-graph",entities:["sun.sun"]}}getCardSize(){var t,i;return null!==(t=this._config)&&void 0!==t&&t.title?2:0+2*((null===(i=this._entityIds)||void 0===i?void 0:i.length)||1)}getGridOptions(){return{columns:12,min_columns:6,min_rows:2}}setConfig(t){if(!t.entities||!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(!t.entities.length)throw new Error("You must include at least one entity");const i=t.entities?(0,l.A)(t.entities):[];this._entityIds=[],i.forEach(t=>{this._entityIds.push(t.entity),t.name&&(this._names[t.entity]=t.name)}),this._hoursToShow=t.hours_to_show||x,this._config=t}connectedCallback(){super.connectedCallback(),this.hasUpdated&&this._subscribeHistory()}disconnectedCallback(){super.disconnectedCallback(),this._unsubscribeHistory()}async _subscribeHistory(){if(!(0,c.p)(this.hass,"history")||this._subscribed)return;const{numeric_device_classes:t}=await(0,u.ib)(this.hass);this._subscribed=(0,d.xS)(this.hass,i=>{var e;this._subscribed&&(this._stateHistory=(0,d.Nu)(this.hass,i,this._entityIds,this.hass.localize,t,null===(e=this._config)||void 0===e?void 0:e.split_device_classes),this._mergeHistory())},this._hoursToShow,this._entityIds).catch(t=>{this._subscribed=void 0,this._error=t}),await this._fetchStatistics(t),this._setRedrawTimer()}_mergeHistory(){var t;this._stateHistory&&(this._history=(0,d.V3)(this._stateHistory,this._statisticsHistory,null===(t=this._config)||void 0===t?void 0:t.split_device_classes))}async _fetchStatistics(t){var i;const e=new Date,s=new Date;s.setHours(s.getHours()-this._hoursToShow);const n=await(0,y.dL)(this.hass,s,e,this._entityIds,"hour",void 0,["mean","state"]);this._statisticsHistory=(0,d.YA)(this.hass,n,this._entityIds,t,null===(i=this._config)||void 0===i?void 0:i.split_device_classes),this._mergeHistory()}_redrawGraph(){this._history&&(this._history=Object.assign({},this._history))}_setRedrawTimer(){clearInterval(this._interval),this._interval=window.setInterval(()=>this._redrawGraph(),6e4)}_unsubscribeHistory(){clearInterval(this._interval),this._subscribed&&(this._subscribed.then(t=>null==t?void 0:t()),this._subscribed=void 0)}shouldUpdate(t){return(0,_.Wh)(this,t)||t.size>1||!t.has("hass")}updated(t){if(super.updated(t),!(this._config&&this.hass&&this._hoursToShow&&this._entityIds.length))return;if(!t.has("_config")&&!t.has("hass"))return;const i=t.get("_config");!t.has("_config")||(null==i?void 0:i.entities)===this._config.entities&&(null==i?void 0:i.hours_to_show)===this._config.hours_to_show||(this._unsubscribeHistory(),this._subscribeHistory())}render(){var t,i,e,s;if(!this.hass||!this._config)return r.Ld;const n=new Date;n.setHours(n.getHours()-this._hoursToShow);const o=`/history?${(0,f.ou)({entity_id:this._entityIds.join(","),start_date:n.toISOString()})}`,c=null!==(t=null===(i=this._config.grid_options)||void 0===i?void 0:i.columns)&&void 0!==t?t:12,h="number"==typeof c&&c<=12,d="number"==typeof(null===(e=this._config.grid_options)||void 0===e?void 0:e.rows);return(0,r.dy)(p||(p=S` <ha-card> ${0} <div class="content ${0}"> ${0} </div> </ha-card> `),this._config.title?(0,r.dy)(m||(m=S` <h1 class="card-header"> ${0} <a href="${0}"><ha-icon-next></ha-icon-next></a> </h1> `),this._config.title,o):r.Ld,(0,a.$)({"has-header":!!this._config.title,"has-rows":!(null===(s=this._config.grid_options)||void 0===s||!s.rows),"has-height":d}),this._error?(0,r.dy)(v||(v=S` <ha-alert alert-type="error"> ${0}: ${0} </ha-alert> `),this.hass.localize("ui.components.history_charts.error"),this._error.message||this._error.code):(0,r.dy)(b||(b=S` <state-history-charts .hass="${0}" .isLoadingData="${0}" .historyData="${0}" .names="${0}" up-to-now .hoursToShow="${0}" .showNames="${0}" .logarithmicScale="${0}" .minYAxis="${0}" .maxYAxis="${0}" .fitYData="${0}" .height="${0}" .narrow="${0}" .expandLegend="${0}"></state-history-charts> `),this.hass,!this._history,this._history,this._names,this._hoursToShow,void 0===this._config.show_names||this._config.show_names,this._config.logarithmic_scale||!1,this._config.min_y_axis,this._config.max_y_axis,this._config.fit_y_data||!1,d?"100%":void 0,h,this._config.expand_legend))}constructor(...t){super(...t),this._names={},this._entityIds=[],this._hoursToShow=x}}H.styles=(0,r.iv)(w||(w=S`ha-card{display:flex;flex-direction:column;height:100%}.card-header{justify-content:space-between;display:flex;padding-bottom:0}.card-header ha-icon-next{--mdc-icon-button-size:24px;line-height:24px;color:var(--primary-text-color)}.content{padding:0 16px 8px;flex:1;overflow:hidden}.has-header{padding-top:0}state-history-charts{--timeline-top-margin:16px}.has-height state-history-charts{height:100%}.has-rows{--chart-max-height:100%}`)),(0,n.__decorate)([(0,o.Cb)({attribute:!1})],H.prototype,"hass",void 0),(0,n.__decorate)([(0,o.SB)()],H.prototype,"_history",void 0),(0,n.__decorate)([(0,o.SB)()],H.prototype,"_statisticsHistory",void 0),(0,n.__decorate)([(0,o.SB)()],H.prototype,"_config",void 0),(0,n.__decorate)([(0,o.SB)()],H.prototype,"_error",void 0),H=(0,n.__decorate)([(0,o.Mo)("hui-history-graph-card")],H),s()}catch(p){s(p)}})}}]);
//# sourceMappingURL=50709.157869d969a642d4.js.map