"use strict";(self.webpackChunkjupyter_drives=self.webpackChunkjupyter_drives||[]).push([[174],{174:(e,t,a)=>{a.r(t),a.d(t,{default:()=>te});var i=a(201),n=a(652),r=a(86),s=a(565),o=a(690),l=a(436),d=a(10),c=a(760),m=a(397),u=a(256);const p=new c.LabIcon({name:"jupyter-drives:drive-browser",svgstr:'<?xml version="1.0" encoding="UTF-8"?>\n<svg width="34" height="34" viewBox="0 0 80 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g stroke="var(--jp-inverse-layout-color3)" stroke-width="5" fill="none" fill-rule="evenodd">\n        <g transform="translate(8.000000, 8.000000)">\n            <path d="M52.8359,34.8926 L53.2199,32.1886 C56.7609,34.3096 56.8069,35.1856 56.8059132,35.2096 C56.7999,35.2146 56.1959,35.7186 52.8359,34.8926 L52.8359,34.8926 Z M50.8929,34.3526 C44.7729,32.5006 36.2499,28.5906 32.8009,26.9606 C32.8009,26.9466 32.8049,26.9336 32.8049,26.9196 C32.8049,25.5946 31.7269,24.5166 30.4009,24.5166 C29.0769,24.5166 27.9989,25.5946 27.9989,26.9196 C27.9989,28.2446 29.0769,29.3226 30.4009,29.3226 C30.9829,29.3226 31.5109,29.1056 31.9279,28.7606 C35.9859,30.6816 44.4429,34.5346 50.6079,36.3546 L48.1699,53.5606 C48.1629,53.6076 48.1599,53.6546 48.1599,53.7016 C48.1599,55.2166 41.4529,57.9996 30.4939,57.9996 C19.4189,57.9996 12.6409,55.2166 12.6409,53.7016 C12.6409,53.6556 12.6379,53.6106 12.6319,53.5656 L7.5379,16.3586 C11.9469,19.3936 21.4299,20.9996 30.4999,20.9996 C39.5559,20.9996 49.0229,19.3996 53.4409,16.3736 L50.8929,34.3526 Z M6.9999,12.4776 C7.0719,11.1616 14.6339,5.9996 30.4999,5.9996 C46.3639,5.9996 53.9269,11.1606 53.9999,12.4776 L53.9999,12.9266 C53.1299,15.8776 43.3299,18.9996 30.4999,18.9996 C17.6479,18.9996 7.8429,15.8676 6.9999,12.9126 L6.9999,12.4776 Z M55.9999,12.4996 C55.9999,9.0346 46.0659,3.9996 30.4999,3.9996 C14.9339,3.9996 4.9999,9.0346 4.9999,12.4996 L5.0939,13.2536 L10.6419,53.7776 C10.7749,58.3096 22.8609,59.9996 30.4939,59.9996 C39.9659,59.9996 50.0289,57.8216 50.1589,53.7806 L52.5549,36.8836 C53.8879,37.2026 54.9849,37.3656 55.8659,37.3656 C57.0489,37.3656 57.8489,37.0766 58.3339,36.4986 C58.7319,36.0246 58.8839,35.4506 58.7699,34.8396 C58.5109,33.4556 56.8679,31.9636 53.5219,30.0546 L55.8979,13.2926 L55.9999,12.4996 Z"></path>\n        </g>\n    </g>\n</svg>\n\n'}),h=new c.LabIcon({name:"jupyter-drives:add-drive",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="M444-144v-300H144v-72h300v-300h72v300h300v72H516v300h-72Z"/></svg>\n'}),v=new c.LabIcon({name:"jupyter-drives:remove-drive",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="M232-444v-72h496v72H232Z"/></svg>\n'});var g,y,f=a(602),w=a(566);function b(e,t){let a="text",i="text/plain",n="text";return t[e]&&(a=t[e].fileType,i=t[e].fileMimeTypes[0],n=t[e].fileFormat),".ipynb"===e&&(n="text"),[a,i,n]}function x(e,t){return t.filter((t=>t.name===(-1!==e.indexOf("/")?e.substring(0,e.indexOf("/")):e)))[0]}function C(e){return-1!==e.indexOf("/")?e.substring(e.indexOf("/")+1):""}!function(e){e.openDrivesDialog="drives:open-drives-dialog",e.openPath="drives:open-path",e.toggleBrowser="drives:toggle-main",e.createNewDrive="drives:create-new-drive",e.addPublicDrive="drives:add-public-drive",e.addExternalDrive="drives:add-external-drive",e.launcher="launcher:create",e.toggleFileFilter="drives:toggle-file-filter",e.createNewDirectory="drives:create-new-directory",e.createNewFile="drives:create-new-file",e.createNewNotebook="drives:create-new-notebook",e.rename="drives:rename",e.copyPath="drives:copy-path",e.excludeDrive="drives:exclude-drive",e.includeDrive="drives:include-drive",e.copyToFilebrowser="drives:copy-to-filebrowser",e.pasteToFilebrowser="drives:paste-to-filebrowser"}(g||(g={}));class _ extends w.ServerConnection.ResponseError{constructor(e,t=`Invalid response: ${e.status} ${e.statusText}`,a="",i={}){super(e,t),this.traceback=a,this._json=null!=i?i:{}}get json(){return this._json}}async function E(e="",t="GET",a=null,i="jupyter-drives"){const n=w.ServerConnection.makeSettings(),r=m.URLExt.join(n.baseUrl,i,e),s={method:t,body:a?JSON.stringify(a):void 0};let o;try{o=await w.ServerConnection.makeRequest(r,s,n)}catch(e){throw new w.ServerConnection.NetworkError(e)}let l=await o.text(),d=!1;if(l.length>0)try{l=JSON.parse(l),d=!0}catch(e){console.log("Not a JSON response body.",o)}if(!o.ok){if(d){const{message:e,traceback:t,...a}=l;throw new _(o,e||`Invalid response: ${o.status} ${o.statusText}`,t||"",a)}throw new _(o,l)}return l}async function D(e){return await E("drives/config","POST",{exclude_drive_name:e})}async function P(e){return await E("drives/config","POST",{include_drive_name:e})}async function N(){return await E("drives/config","GET")}async function F(){return await E("drives","GET")}async function T(e,t){var a;const i={drive_name:e,provider:t.provider,location:null!==(a=t.location)&&void 0!==a?a:""};try{await E("drives","POST",i)}catch(e){return{error:e}}}async function S(e,t){const a=await E("drives/"+e+"/"+t.path,"GET"),i=void 0!==a.data.length;if(a.data){if(i){const n={};return a.data.forEach((a=>{var i;if(a.path!==t.path&&a.path!==t.path+"/"){const r=a.path.replace(t.path?t.path+"/":"","").split("/")[0],[s,o,l]=b(m.PathExt.extname(m.PathExt.basename(r)),t.registeredFileTypes);n[r]=null!==(i=n[r])&&void 0!==i?i:{name:r,path:t.path?m.PathExt.join(e,t.path,r):m.PathExt.join(e,r),last_modified:a.last_modified,created:"",content:r.split(".")[1]?null:[],format:l,mimetype:o,size:a.size,writable:!0,type:s}}})),{isDir:i,response:a,files:Object.values(n)}}{const[e,n,r]=b(m.PathExt.extname(m.PathExt.basename(t.path)),t.registeredFileTypes);return{isDir:i,response:a,format:r,mimetype:n,type:e}}}return{}}async function I(e){return await E("drives/"+e+"/","POST",{is_public:!0})}async function j(e,t){return await E("drives/"+e+"/","POST",{is_public:!1,region:t})}!function(e){e.renameSingleObject=async function(e,t,a){return await E("drives/"+e+"/"+t,"PATCH",{new_path:a})},e.copySingleObject=async function(e,t,a,i){return await E("drives/"+e+"/"+a,"PUT",{to_path:i,to_drive:t})}}(y||(y={}));class L{constructor(e={}){var t,a;this._drivesList=[],this._name="",this._provider="",this._baseUrl="",this._region="",this._creationDate="",this._fileChanged=new f.Signal(this),this._isDisposed=!1,this._disposed=new f.Signal(this),this._registeredFileTypes={},this._serverSettings=w.ServerConnection.makeSettings(),this._name=null!==(t=e.name)&&void 0!==t?t:"",this._drivesList=null!==(a=e.drivesList)&&void 0!==a?a:[]}get drivesList(){return this._drivesList}set drivesList(e){this._drivesList=e}get baseUrl(){return this._baseUrl}set baseUrl(e){this._baseUrl=e}get name(){return this._name}set name(e){this._name=e}get provider(){return this._provider}set provider(e){this._provider=e}get region(){return this._region}set region(e){this._region=e}get creationDate(){return this._creationDate}set creationDate(e){this._creationDate=e}get serverSettings(){return this._serverSettings}get registeredFileTypes(){return this._registeredFileTypes}set registeredFileTypes(e){this._registeredFileTypes=e}get fileChanged(){return this._fileChanged}get isDisposed(){return this._isDisposed}get disposed(){return this._disposed}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(),f.Signal.clearData(this))}async getDownloadUrl(e){let t="",a="",i="";try{if(""!==e){const a=x(e,this._drivesList);t=await(async(e,t)=>(await E("drives/"+e+"/"+t.path,"PUT",{presigned_link:!0})).data.link)(a.name,{path:C(e)})}else a="Operation not supported."}catch(e){i=e.message}return(i||a)&&l.Notification.emit(null!=a?a:i,a?"warning":"error",{autoClose:5e3}),t}async get(e,t){let a,i="";if(""!==e){const t=x(e,this._drivesList);if(!1===t.mounted)try{const e=t.name,a=await T(e,{provider:t.provider});a&&a.error?i=a.error.message:this._drivesList.filter((t=>t.name===e))[0].mounted=!0}catch(e){}try{const i=C(e),n=await S(t.name,{path:i,registeredFileTypes:this._registeredFileTypes});a={name:n.isDir?i?m.PathExt.basename(i):t.name:m.PathExt.basename(i),path:m.PathExt.join(t.name,n.isDir?i?i+"/":"":n.response.data.path),last_modified:n.isDir?"":n.response.data.last_modified,created:"",content:n.isDir?n.files:n.response.data.content,format:n.isDir?"json":n.format,mimetype:n.isDir?"":n.mimetype,size:n.isDir?void 0:n.response.data.size,writable:!0,type:n.isDir?"directory":n.type}}catch(e){i=e.message}}else{const e=[];try{this._drivesList=await F();for(const t of this._drivesList)e.push({name:t.name,path:t.name,last_modified:"",created:t.creationDate,content:[],format:"json",mimetype:"",size:void 0,writable:!0,type:"directory"})}catch(e){i=e.message}a={name:this._name,path:this._name,last_modified:"",created:"",content:e,format:"json",mimetype:"",size:void 0,writable:!0,type:"directory"}}return i&&l.Notification.emit(i,"error",{autoClose:5e3}),w.Contents.validateContentsModel(a),a}async newUntitled(e={}){var t;let a={name:"",path:"",last_modified:"",created:"",content:[],format:null,mimetype:"",size:0,writable:!0,type:""};const i=null!==(t=e.path)&&void 0!==t?t:"";let n="",r="";if(""!==i)try{const t=x(i,this._drivesList),n=-1!==i.indexOf("/")?i.substring(i.indexOf("/")+1):"",s=await S(t.name,{path:n,registeredFileTypes:this._registeredFileTypes}),o={name:n?m.PathExt.basename(n):t.name,path:m.PathExt.join(t.name,n?n+"/":""),last_modified:"",created:"",content:s.files,format:"json",mimetype:"",size:void 0,writable:!0,type:"directory"};if(void 0!==e.type){const i=this.incrementUntitledName(o,e),r=n?m.PathExt.join(n,i):i,s=await async function(e,t){const a=await E("drives/"+e+"/"+t.path,"POST",{type:t.type}),[i,n,r]=b(m.PathExt.extname(t.name),t.registeredFileTypes);return{response:a,type:i,mimetype:n,format:r}}(t.name,{name:i,path:r,type:e.type,registeredFileTypes:this._registeredFileTypes});a={name:i,path:m.PathExt.join(t.name,r),last_modified:s.response.data.last_modified,created:s.response.data.last_modified,content:s.response.data.content,format:s.format,mimetype:s.mimetype,size:s.response.data.size,writable:!0,type:s.type}}else r="Type of new element is undefined"}catch(e){n=e.message}else r="Operation not supported.";return(n||r)&&l.Notification.emit(null!=r?r:n,r?"warning":"error",{autoClose:5e3}),w.Contents.validateContentsModel(a),this._fileChanged.emit({type:"new",oldValue:null,newValue:a}),a}incrementUntitledName(e,t){const a=e.content;let i="",n=0,r=0,s=0;return"notebook"===t.type&&(t.ext="ipynb"),a.forEach((e=>{void 0!==t.ext?e.name.includes("untitled")&&e.name.includes(".txt")?n+=1:e.name.includes("Untitled")&&e.name.includes(".ipynb")&&(s+=1):e.name.includes("Untitled Folder")&&(r+=1)})),"txt"===t.ext&&(i=0===n?"untitled."+t.ext:"untitled"+n+"."+t.ext),"ipynb"===t.ext?i=0===s?"Untitled."+t.ext:"Untitled"+s+"."+t.ext:"directory"===t.type&&(i=0===r?"Untitled Folder":"Untitled Folder "+r),i}async delete(e){const t=x(e,this._drivesList);try{await async function(e,t){await E("drives/"+e+"/"+t.path,"DELETE")}(t.name,{path:C(e)})}catch(e){l.Notification.emit(e.message,"error",{autoClose:5e3})}this._fileChanged.emit({type:"delete",oldValue:{path:e},newValue:null})}async rename(e,t,a={}){let i="",n="",r={name:"",path:"",last_modified:"",created:"",content:[],format:null,mimetype:"",size:0,writable:!0,type:""};if(""!==e)try{const a=x(e,this._drivesList),n=C(e),s=C(t);let o=m.PathExt.basename(s);try{await async function(e,t){await E("drives/"+e+"/"+t.path,"HEAD")}(a.name,{path:s}),o=await this.incrementName(s,a.name)}catch(i){}finally{const e=await async function(e,t){const a=t.newPath.substring(0,t.newPath.lastIndexOf("/")+1)+t.newFileName,[i,n,r]=b(m.PathExt.extname(m.PathExt.basename(t.newFileName)),t.registeredFileTypes),s=await E("drives/"+e+"/"+t.path,"GET");void 0!==s.data.length&&0!==s.data.length&&await Promise.all(s.data.map((async i=>{const n=i.path.substring(t.path.length);y.renameSingleObject(e,m.PathExt.join(t.path,n),m.PathExt.join(a,n))})));let o={},l={response:o,formattedNewPath:a,format:r,mimetype:n,type:i};try{const i=await y.renameSingleObject(e,t.path,a);o={last_modified:i.data.last_modified,size:i.data.size}}catch(e){}return l}(a.name,{path:n,newPath:s,newFileName:o,registeredFileTypes:this._registeredFileTypes});r={name:o,path:m.PathExt.join(a.name,e.formattedNewPath),last_modified:e.response.length>0?e.response.data.last_modified:"",created:"",content:""!==m.PathExt.extname(o)?null:[],format:e.format,mimetype:e.mimetype,size:e.response.length>0?e.response.data.size:void 0,writable:!0,type:e.type}}}catch(e){i=e.message}else n="Operation not supported.";return(i||n)&&l.Notification.emit(null!=n?n:i,n?"warning":"error",{autoClose:5e3}),w.Contents.validateContentsModel(r),this._fileChanged.emit({type:"rename",oldValue:{path:e},newValue:r}),r}async incrementName(e,t){let a="",i="";i=m.PathExt.basename(e),a=m.PathExt.extname(i),i=""!==a?i.split(".")[i.split(".").length-2]:i;const n=await(async(e,t,a)=>{let i={};t=t.substring(0,t.lastIndexOf("/"));const n=await E("drives/"+e+"/"+t,"GET");return n.data&&0!==n.data.length&&n.data.forEach((e=>{const n=e.path.replace(t?t+"/":"","").split("/")[0];n.substring(0,a.length+1).includes(a)&&(i[n]=1)})),Object.values(i).reduce(((e,t)=>e+t),0)})(t,e,i);let r=n?i+n:i;return r=""!==a?r+a:r,r}async save(e,t={}){let a="",i="",n={name:"",path:"",last_modified:"",created:"",content:[],format:null,mimetype:"",size:0,writable:!0,type:""};if(""!==e)try{const a=x(e,this._drivesList),i=C(e),r=await async function(e,t){const[a,i,n]=b(m.PathExt.extname(m.PathExt.basename(t.path)),t.registeredFileTypes);return{response:await E("drives/"+e+"/"+t.path,"PUT",{content:t.param.content,options_format:t.param.format,content_format:n,content_type:a,options_chunk:t.param.chunk}),type:a,mimetype:i,format:n}}(a.name,{path:i,param:t,registeredFileTypes:this._registeredFileTypes});n={name:i,path:m.PathExt.join(a.name,i),last_modified:r.response.data.last_modified,created:r.response.data.last_modified,content:r.response.data.content,format:r.format,mimetype:r.mimetype,size:r.response.data.size,writable:!0,type:r.type}}catch(e){a=e.message}else i="Operation not supported.";return(a||i)&&l.Notification.emit(null!=i?i:a,i?"warning":"error",{autoClose:5e3}),w.Contents.validateContentsModel(n),this._fileChanged.emit({type:"save",oldValue:null,newValue:n}),n}async incrementCopyName(e,t,a){const i=m.PathExt.basename(e),n=""===m.PathExt.extname(i)?i+"-Copy":i.split(".")[0]+"-Copy."+i.split(".")[1],r=m.PathExt.join(t,n);return await this.incrementName(r,a)}async copy(e,t,a={}){let i="",n="",r={name:"",path:"",last_modified:"",created:"",content:[],format:null,mimetype:"",size:0,writable:!0,type:""};if(""!==e)try{const a=x(e,this._drivesList),i=x(t,this._drivesList),n=C(e),s=C(t),o=await this.incrementCopyName(n,s,i.name),l=await async function(e,t){const a=m.PathExt.join(t.toPath,t.newFileName),[i,n,r]=b(m.PathExt.extname(m.PathExt.basename(t.newFileName)),t.registeredFileTypes),s=await E("drives/"+e+"/"+t.path,"GET");void 0!==s.data.length&&0!==s.data.length&&await Promise.all(s.data.map((async i=>{const n=i.path.substring(t.path.length);y.copySingleObject(e,t.toDrive,m.PathExt.join(t.path,n),m.PathExt.join(a,n))})));try{return{response:await y.copySingleObject(e,t.toDrive,t.path,a),formattedNewPath:a,format:r,mimetype:n,type:i}}catch(e){}return{}}(a.name,{path:n,toPath:s,newFileName:o,toDrive:i.name,registeredFileTypes:this._registeredFileTypes});r={name:o,path:m.PathExt.join(a.name,l.formattedNewPath),last_modified:l.response.data.last_modified,created:"",content:""!==m.PathExt.extname(o)?null:[],format:l.format,mimetype:l.mimetype,size:l.response.data.size,writable:!0,type:l.type}}catch(e){n=e.message}else i="Operation not supported.";return(n||i)&&l.Notification.emit(null!=i?i:n,i?"warning":"error",{autoClose:5e3}),this._fileChanged.emit({type:"new",oldValue:null,newValue:r}),w.Contents.validateContentsModel(r),r}async newDrive(e,t){try{await async function(e,t){return await E("drives/"+e+"/","POST",{location:t.location})}(e,{location:t})}catch(e){l.Notification.emit(e.message,"error",{autoClose:5e3})}const a={name:e,path:e,last_modified:"",created:"",content:[],format:"json",mimetype:"",size:0,writable:!0,type:"directory"};return w.Contents.validateContentsModel(a),this._fileChanged.emit({type:"new",oldValue:null,newValue:a}),a}async addPublicDrive(e){try{await I(e)}catch(e){l.Notification.emit(e.message,"error",{autoClose:5e3})}const t={name:e,path:e,last_modified:"",created:"",content:[],format:"json",mimetype:"",size:0,writable:!0,type:"directory"};return w.Contents.validateContentsModel(t),this._fileChanged.emit({type:"new",oldValue:null,newValue:t}),t}async addExternalDrive(e,t){try{await j(e,t)}catch(e){l.Notification.emit(e.message,"error",{autoClose:5e3})}const a={name:e,path:e,last_modified:"",created:"",content:[],format:"json",mimetype:"",size:0,writable:!0,type:"directory"};return w.Contents.validateContentsModel(a),this._fileChanged.emit({type:"new",oldValue:null,newValue:a}),a}async excludeDrive(e){try{await D(e)}catch(e){l.Notification.emit(e.message,"error",{autoClose:5e3})}const t={name:e,path:e,last_modified:"",created:"",content:[],format:"json",mimetype:"",size:0,writable:!0,type:"directory"};return w.Contents.validateContentsModel(t),this._fileChanged.emit({type:"delete",oldValue:t,newValue:null}),t}async includeDrive(e){try{await P(e)}catch(e){l.Notification.emit(e.message,"error",{autoClose:5e3})}const t={name:e,path:e,last_modified:"",created:"",content:[],format:"json",mimetype:"",size:0,writable:!0,type:"directory"};return w.Contents.validateContentsModel(t),this._fileChanged.emit({type:"new",oldValue:null,newValue:t}),t}createCheckpoint(e){return Promise.resolve({id:"",last_modified:""})}listCheckpoints(e){return Promise.resolve([])}restoreCheckpoint(e,t){return Promise.reject("Repository is read only")}deleteCheckpoint(e,t){return Promise.reject("Read only")}getRegisteredFileTypes(e){const t=e.docRegistry.fileTypes();for(const e of t)0===e.extensions.length&&(this._registeredFileTypes[""]={fileType:"directory",fileFormat:"json",fileMimeTypes:["text/directory"]}),e.extensions.forEach((t=>{var a;this._registeredFileTypes[t]||(this._registeredFileTypes[t]={fileType:e.name,fileMimeTypes:[...e.mimeTypes],fileFormat:null!==(a=e.fileFormat)&&void 0!==a?a:""})}))}}class k extends u.Widget{constructor(){super(),this.node.classList.add("drive-status-widget","drive-status-loading","lm-mod-hidden"),this._textSpan=document.createElement("span"),this._textSpan.textContent="",this.node.appendChild(this._textSpan),this._isLoading=!1}updateStatus(e){this._textSpan.textContent=e}setLoading(e,t){if(this._isLoading=!0,"directory"===t){const t=""===e?"Root":e.split("/").pop()||"Directory";this.updateStatus(`Opening: ${t}`)}else{const t=e.split("/").pop()||"File";this.updateStatus(`Opening: ${t}`)}this.removeClass("lm-mod-hidden")}setLoaded(e){this._isLoading=!1,this.addClass("lm-mod-hidden"),this.updateStatus("")}get isLoading(){return this._isLoading}}const O="DriveBrowser",M="jp-FileDialog",A="jp-new-drive-title",V={id:"jupyter-drives:drives-file-browser",description:"The drive file browser factory provider.",autoStart:!0,requires:[s.IFileBrowserFactory,l.IToolbarWidgetRegistry,d.ISettingRegistry,o.ITranslator,n.IDocumentWidgetOpener],optional:[i.IRouter,i.JupyterFrontEnd.ITreeResolver,i.ILabShell,i.ILayoutRestorer,r.IStatusBar],activate:async(e,t,a,i,n,r,o,d,m,u,h)=>{console.log("JupyterLab extension jupyter-drives:drives-file-browser is activated!");const{commands:v}=e,y=new L({name:"s3"});e.serviceManager.contents.addDrive(y),y.getRegisteredFileTypes(e);const f=t.createFileBrowser("drivebrowser",{auto:!1,restore:!1,driveName:y.name});if(f.node.setAttribute("role","region"),f.node.setAttribute("aria-label","Drive Browser Section"),f.title.icon=p,f.title.caption="Drive File Browser",f.id="drive-file-browser",f.addClass("drive-browser"),B.restoreBrowser(f,v,o,d,m),e.shell.add(f,"left",{rank:102,type:"File Browser"}),u&&u.add(f,"drive-file-browser"),h){const e=new k;h.registerStatusItem("driveBrowserStatus",{item:e,align:"right",rank:500}),f.listing.onItemOpened.connect(((t,a)=>{const{path:i,type:n}=a;e.setLoading(i,n)}));const t=()=>{e.setLoaded()};r.opened.connect(t),f.model.pathChanged.connect(t)}const w=new s.Uploader({model:f.model,translator:n});a.addFactory(O,"uploader",(()=>w)),a.addFactory(O,"file-name-searcher",(e=>{const t=(0,c.FilenameSearcher)({updateFilter:(t,a)=>{e.model.setFilter((e=>t(e.name.toLowerCase())))},useFuzzyFilter:!0,placeholder:"Filter files by names",forceRefresh:!0});return t.addClass("jp-drive-browser-search-box"),t})),B.addCommands(e,y,f,t);const b=()=>{"s3:"!==f.model.path?w.enabled=!0:w.enabled=!1,e.commands.notifyCommandChanged(g.createNewDrive),e.commands.notifyCommandChanged(g.createNewDirectory),e.commands.notifyCommandChanged(g.launcher)};function x(e){!async function(e){await E("drives/config","POST",{new_limit:e})}(e.get("maxFilesListed").composite)}f.model.pathChanged.connect(b),b(),(0,l.setToolbar)(f,(0,l.createToolbarFactory)(a,i,O,V.id,n)),Promise.all([e.restored,i.load(V.id)]).then((([,e])=>{x(e),e.changed.connect(x)})).catch((e=>{console.error(`Something went wrong when reading the settings.\n${e}`)}))}};var B;!function(e){e.restoreBrowser=async function(e,t,a,i,n){const r="jp-mod-restoring";if(e.addClass(r),!a)return await e.model.restore(e.id),await e.model.refresh(),void e.removeClass(r);const s=async()=>{a.routed.disconnect(s);const o=await(null==i?void 0:i.paths);(null==o?void 0:o.file)||(null==o?void 0:o.browser)?(await e.model.restore(e.id,!1),o.file&&await t.execute(g.openPath,{path:o.file,dontShowBrowser:!0}),o.browser&&await t.execute(g.openPath,{path:o.browser,dontShowBrowser:!0})):(await e.model.restore(e.id),await e.model.refresh()),e.removeClass(r),(null==n?void 0:n.isEmpty("main"))&&t.execute("launcher:create")};a.routed.connect(s)};const t=()=>{const e=document.createElement("div"),t=document.createElement("label");t.textContent="Name",t.className=A;const a=document.createElement("input"),i=document.createElement("label");i.textContent="Region",i.className=A;const n=document.createElement("input");return n.placeholder="us-east-1",e.appendChild(t),e.appendChild(a),e.appendChild(i),e.appendChild(n),e};class a extends u.Widget{constructor(e){super({node:t()}),this.onAfterAttach()}onAfterAttach(){this.addClass(M);const e=this.driveInput.value;this.driveInput.setSelectionRange(0,e.length);const t=this.regionInput.value;this.regionInput.setSelectionRange(0,t.length)}get driveInput(){return this.node.getElementsByTagName("input")[0]}get regionInput(){return this.node.getElementsByTagName("input")[1]}getValue(){return[this.driveInput.value,this.regionInput.value]}}e.CreateDriveHandler=a;const i=()=>{const e=document.createElement("div"),t=document.createElement("label");t.textContent="Name",t.className=A;const a=document.createElement("input");return e.appendChild(t),e.appendChild(a),e};class n extends u.Widget{constructor(e){super({node:i()}),this.onAfterAttach()}onAfterAttach(){this.addClass(M);const e=this.driveInput.value;this.driveInput.setSelectionRange(0,e.length)}get driveInput(){return this.node.getElementsByTagName("input")[0]}getValue(){return this.driveInput.value}}e.AddPublicDriveHandler=n,e.addCommands=function(t,a,i,n){const{tracker:r}=n;t.commands.addCommand(g.createNewDrive,{isEnabled:()=>"s3:"===i.model.path,execute:async()=>(0,l.showDialog)({title:"New Drive",body:new e.CreateDriveHandler(a.name),focusNodeSelector:"input",buttons:[l.Dialog.cancelButton(),l.Dialog.okButton({label:"Create",ariaLabel:"Create New Drive"})]}).then((e=>{e.value&&a.newDrive(e.value[0],e.value[1])})),label:"New Drive",icon:p.bindprops({stylesheet:"menuItem"})}),t.contextMenu.addItem({command:g.createNewDrive,selector:"#drive-file-browser.jp-SidePanel .jp-DirListing-content",rank:105}),t.commands.addCommand(g.addPublicDrive,{isVisible:()=>"s3:"===i.model.path,execute:async()=>(0,l.showDialog)({title:"Add Public Drive",body:new e.AddPublicDriveHandler(a.name),focusNodeSelector:"input",buttons:[l.Dialog.cancelButton(),l.Dialog.okButton({label:"Add",ariaLabel:"Add Drive"})]}).then((async e=>{if(e.value){const t=await T(e.value,{provider:"s3"});t&&t.error?l.Notification.emit(t.error.message,"error",{autoClose:5e3}):a.addPublicDrive(e.value)}})),label:"Add Public Drive",icon:p.bindprops({stylesheet:"menuItem"})}),t.contextMenu.addItem({command:g.addPublicDrive,selector:"#drive-file-browser.jp-SidePanel .jp-DirListing-content",rank:110}),t.commands.addCommand(g.addExternalDrive,{isVisible:()=>"s3:"===i.model.path,execute:async()=>(0,l.showDialog)({title:"Add External Drive",body:new e.CreateDriveHandler(a.name),focusNodeSelector:"input",buttons:[l.Dialog.cancelButton(),l.Dialog.okButton({label:"Add",ariaLabel:"Add Drive"})]}).then((async e=>{if(e.value){const t=await T(e.value[0],{provider:"s3",location:e.value[1]});t&&t.error?l.Notification.emit(t.error.message,"error",{autoClose:5e3}):a.addExternalDrive(e.value[0],e.value[1])}})),label:"Add External Drive",icon:p.bindprops({stylesheet:"menuItem"})}),t.contextMenu.addItem({command:g.addExternalDrive,selector:"#drive-file-browser.jp-SidePanel .jp-DirListing-content",rank:110}),t.commands.addCommand(g.toggleFileFilter,{execute:()=>{i.showFileFilter=!i.showFileFilter,t.commands.notifyCommandChanged(g.toggleFileFilter)},isToggled:()=>i.showFileFilter,icon:c.filterIcon.bindprops({stylesheet:"menuItem"}),label:"Toggle File Filter"}),t.commands.addCommand(g.createNewDirectory,{isEnabled:()=>"s3:"!==i.model.path,execute:()=>{t.commands.execute("filebrowser:create-new-directory")},icon:c.newFolderIcon.bindprops({stylesheet:"menuItem"}),label:"New Folder"}),t.commands.addCommand(g.createNewFile,{isEnabled:()=>"s3:"!==i.model.path,execute:()=>{t.commands.execute("filebrowser:create-new-file")},icon:c.fileIcon.bindprops({stylesheet:"menuItem"}),label:"New File"}),t.commands.addCommand(g.createNewNotebook,{isEnabled:()=>"s3:"!==i.model.path,execute:()=>{t.commands.execute("notebook:create-new")},icon:c.notebookIcon.bindprops({stylesheet:"menuItem"}),label:"New Notebook"}),t.commands.addCommand(g.rename,{isEnabled:()=>"s3:"!==i.model.path,execute:()=>{t.commands.execute("filebrowser:rename")},icon:c.editIcon.bindprops({stylesheet:"menuItem"}),label:"Rename"}),t.commands.addCommand(g.copyPath,{execute:()=>{var e;const t=r.currentWidget;if(!t)return;const a=t.selectedItems().next();if(a.done)return;let i=a.value.path;"true"===m.PageConfig.getOption("copyAbsolutePath")&&(i=m.PathExt.joinWithLeadingSlash(null!==(e=m.PageConfig.getOption("serverRoot"))&&void 0!==e?e:"",a.value.path));const n=i.split(":");i=n[0]+"://"+n[1],l.Clipboard.copyToSystem(i)},isVisible:()=>!!r.currentWidget&&1===Array.from(r.currentWidget.selectedItems()).length,icon:c.fileIcon.bindprops({stylesheet:"menuItem"}),label:"Copy Path"}),t.commands.addCommand(g.excludeDrive,{isVisible:()=>"s3:"===i.model.path,execute:async()=>{const e=r.currentWidget;if(!e)return;const t=e.selectedItems().next();if(t.done)return;const i=t.value.name;await a.excludeDrive(i)},label:"Remove Drive",icon:v.bindprops({stylesheet:"menuItem"})}),t.contextMenu.addItem({command:g.excludeDrive,selector:"#drive-file-browser.jp-SidePanel .jp-DirListing-content .jp-DirListing-item[data-isdir]",rank:110}),t.commands.addCommand(g.copyToFilebrowser,{isVisible:()=>!!r.currentWidget&&1===Array.from(r.currentWidget.selectedItems()).length&&"s3:"!==i.model.path,isEnabled:()=>{var e,t;return!!r.currentWidget&&(null===(e=r.currentWidget)||void 0===e?void 0:e.selectedItems().next().value)&&"directory"!==(null===(t=r.currentWidget)||void 0===t?void 0:t.selectedItems().next().value.type)},execute:async()=>{var e;let t=null===(e=r.currentWidget)||void 0===e?void 0:e.selectedItems().next().value.path;l.Clipboard.copyToSystem(t)},label:"Copy to Filebrowser",icon:c.copyIcon.bindprops({stylesheet:"menuItem"})}),t.contextMenu.addItem({command:g.copyToFilebrowser,selector:"#drive-file-browser.jp-SidePanel .jp-DirListing-content",rank:10}),t.commands.addCommand(g.pasteToFilebrowser,{isVisible:()=>!!n.tracker.currentWidget&&"filebrowser"===n.tracker.currentWidget.id,execute:async e=>{let i=await navigator.clipboard.readText();i=i.substring(i.indexOf(":")+1);const r=i.substring(0,i.indexOf("/"));i=i.substring(i.indexOf("/")+1);const s=m.PathExt.basename(i),o=n.tracker.find((e=>"filebrowser"===e.id)),l=n.tracker.currentWidget.model.path;t.serviceManager.contents.save(m.PathExt.join(l,s),{type:"file",format:".txt"===m.PathExt.extname(s)||".ipynb"===m.PathExt.extname(s)?"text":"base64",content:(await S(r,{path:i,registeredFileTypes:a.registeredFileTypes})).response.data.content}),await(null==o?void 0:o.model.refresh())},label:"Paste from Drive",icon:c.pasteIcon.bindprops({stylesheet:"menuItem"})}),t.contextMenu.addItem({command:g.pasteToFilebrowser,selector:".jp-FileBrowser-listing",rank:10})}}(B||(B={}));var z=a(727),R=a(345),W=a(180);function U({driveValue:e,regionValue:t,setPublicDrive:a,setRegion:i,onSubmit:n,isPublic:r,setIsPublic:s,mountError:o,resetMountError:l}){return R.createElement("div",null,R.createElement("div",{className:"add-public-drive-section"},R.createElement("input",{className:"drive-search-input",onInput:e=>{a(e.target.value),l()},placeholder:"Enter drive name",value:e}),R.createElement(W.Button,{className:"input-add-drive-button",onClick:n,title:"Add public drive"},"add")),R.createElement("div",{className:"add-public-drive-section"},"Public drive?",R.createElement("input",{type:"checkbox",checked:r,onChange:e=>{s(e.target.checked),i("")}}),!r&&R.createElement("input",{className:"drive-region-input",onInput:e=>{i(e.target.value),l()},placeholder:"Region (e.g.: us-east-1)",value:t})),o&&R.createElement("div",{className:"add-public-drive-section"},R.createElement("p",{className:"error"},o)))}function H(e){return R.createElement(R.Fragment,null,R.createElement(W.Search,{className:"drive-search-input",onInput:t=>e.setValue(t.target.value),placeholder:"Search drive name"}),R.createElement("div",{className:"drive-search-list"},0===e.availableDrives.length?R.createElement("div",{className:"drives-manager-header-info"},"No available drives."):e.availableDrives.filter((t=>-1!==t.name.toLowerCase().indexOf(e.value.toLowerCase()))).map(((t,a)=>R.createElement("li",{key:a},R.createElement("div",{className:"available-drives-section"},R.createElement("div",null,t.name," "),R.createElement(W.Button,{className:"search-add-drive-button",onClick:async()=>{await P(t.name),await e.model.refresh()},title:"Add drive"},R.createElement(h.react,{tag:"span",className:"available-drives-icon",height:"18px"}))))))))}function G(e){return R.createElement("div",{className:"drive-search-list"},0===e.drives.length?R.createElement("div",{className:"drives-manager-header-info"},"No selected drives."):e.drives.map(((t,a)=>R.createElement("li",{key:a},R.createElement("div",{className:"available-drives-section"},R.createElement("div",null,t.name," "),R.createElement(W.Button,{className:"search-add-drive-button",onClick:async()=>{await D(t.name),await e.model.refresh()},title:"Remove drive"},R.createElement(v.react,{tag:"span",className:"available-drives-icon",height:"18px"})))))))}function $({model:e}){const[t,a]=(0,R.useState)(""),[i,n]=(0,R.useState)(""),[r,s]=(0,R.useState)(e.selectedDrives),[o,l]=(0,R.useState)(e.availableDrives),[d,c]=(0,R.useState)(!1),[m,u]=(0,R.useState)(""),[h,v]=(0,R.useState)("");return R.useEffect((()=>{e.refresh(),e.selectedDrivesChanged.connect(((e,t)=>{s(t)})),e.availableDrivesChanged.connect(((e,t)=>{l(t)}))}),[e]),R.createElement("div",{className:"drive-list-manager"},R.createElement("span",{className:"drives-manager-header"},R.createElement(p.react,{margin:"15px 9.5px 0px 0px",height:"auto",width:"28px"}),R.createElement("div",{className:"drives-manager-header-title"},"Manage listed drives",R.createElement("div",{className:"drives-manager-header-info"},"Add or remove drives from the filebrowser."))),R.createElement("div",null,R.createElement("div",{className:"drives-manager-section"},R.createElement("div",{className:"drives-section-title"},"Selected drives"),R.createElement(G,{drives:r,model:e})),R.createElement("div",{className:"drives-manager-section"},R.createElement("div",{className:"drives-section-title"}," Add external drive"),R.createElement(U,{isName:!1,driveValue:t,regionValue:m,setPublicDrive:a,setRegion:u,isPublic:d,setIsPublic:c,onSubmit:async()=>{const i=await T(t,{provider:"s3",location:m});i&&i.error?v(i.error.message):(d?await I(t):await j(t,m),a(""),u(""),c(!1),await e.refresh())},mountError:h,resetMountError:()=>v("")})),R.createElement("div",{className:"drives-manager-section"},R.createElement("div",{className:"drives-section-title"}," Browser available drives "),R.createElement(H,{isName:!0,value:i,setValue:n,availableDrives:o,model:e}))))}class q extends c.VDomModel{constructor(e,t){super(),this._selectedDrivesChanged=new f.Signal(this),this._availableDrivesChanged=new f.Signal(this),this.availableDrives=e,this.selectedDrives=t}setSelectedDrives(e){this.selectedDrives=e}setAvailableDrives(e){this.availableDrives=e}get selectedDrivesChanged(){return this._selectedDrivesChanged}get availableDrivesChanged(){return this._availableDrivesChanged}refreshSelectedDrives(){F().then((e=>{this.setSelectedDrives(e.map((e=>({name:e.name,region:e.region})))),this._selectedDrivesChanged.emit(this.selectedDrives)}))}refreshAvailanbleDrives(){N().then((e=>{this.setAvailableDrives(e.map((e=>({name:e.name,region:e.region})))),this._availableDrivesChanged.emit(this.availableDrives)}))}async refresh(){await this.refreshSelectedDrives(),await this.refreshAvailanbleDrives()}}class J extends c.VDomRenderer{constructor(e){super(e),this.model=e}render(){return R.createElement($,{model:this.model})}}const Z={id:"jupyter-drives:widget",description:"Open a dialog to managed listed drives in the filebrowser.",requires:[s.IFileBrowserFactory,o.ITranslator],autoStart:!0,activate:(e,t,a)=>{(0,z.addJupyterLabThemeChangeListener)();const{commands:i}=e,{tracker:n}=t,r=a.load("jupyter_drives"),s=new Map;let o=[];F().then((e=>{o=e.map((e=>({name:e.name,region:e.region})))}));let d=[];N().then((e=>{d=e.map((e=>({name:e.name,region:e.region})))}));let c=s.get(o);i.addCommand(g.openDrivesDialog,{execute:e=>{const t=n.currentWidget;c?(o=c.selectedDrives,s.set(o,c)):(c=new q(d,o),s.set(o,c)),t&&c&&(0,l.showDialog)({body:new J(c),buttons:[l.Dialog.cancelButton()]})},icon:p.bindprops({stylesheet:"menuItem"}),caption:r.__("Manage drives listed in filebrowser."),label:r.__("Manage listed drives")})}};var K=a(771),Q=a(53);const X={activate:function(e,t,a,i,n){const{commands:r,shell:s}=e,o=t.load("jupyter-drives"),d=new K.LauncherModel;if(r.addCommand(g.launcher,{label:o.__("New Launcher"),icon:e=>e.toolbar?c.addIcon:void 0,isEnabled:()=>{const e=null==n?void 0:n.tracker.currentWidget;return"s3:"!==(null==e?void 0:e.model.path)},execute:e=>{var i,m;const u=null==n?void 0:n.tracker.currentWidget,p=null!==(m=null!==(i=e.cwd)&&void 0!==i?i:null==u?void 0:u.model.path)&&void 0!==m?m:"",h="launcher-"+Y.id++,v=new K.Launcher({model:d,cwd:p,callback:e=>{(0,Q.find)(s.widgets("main"),(t=>t===e))&&(s.add(e,"main",{ref:h}),v.dispose())},commands:r,translator:t});v.model=d,v.title.icon=c.launcherIcon,v.title.label=o.__("Launcher");const g=new l.MainAreaWidget({content:v});if(g.title.closable=!!Array.from(s.widgets("main")).length,g.id=h,s.add(g,"main",{activate:e.activate,ref:e.ref}),a&&a.layoutModified.connect((()=>{g.title.closable=Array.from(a.widgets("main")).length>1}),g),u){const e=e=>{v.cwd=e.path};u.model.pathChanged.connect(e),v.disposed.connect((()=>{u.model.pathChanged.disconnect(e)}))}return g}}),a){const t=null==n?void 0:n.tracker.currentWidget;Promise.all([e.restored,null==t?void 0:t.model.restored]).then((()=>{a.layoutModified.connect((()=>{a.isEmpty("main")&&r.execute(g.launcher)}))}))}return i&&i.addItem({command:g.launcher,category:o.__("Launcher")}),a&&(a.addButtonEnabled=!0,a.addRequested.connect(((e,t)=>{var a;const i=(null===(a=t.currentTitle)||void 0===a?void 0:a.owner.id)||t.titles[t.titles.length-1].owner.id;return r.execute(g.launcher,{ref:i})}))),d},id:"jupyter-drives:launcher-extension-plugin",description:"Provides the launcher tab service for the file browsers.",requires:[o.ITranslator],optional:[i.ILabShell,l.ICommandPalette,s.IFileBrowserFactory],provides:K.ILauncher,autoStart:!0};var Y;!function(e){e.id=0}(Y||(Y={}));const ee={id:"@jupyterlite/application-extension:session-context-patch",autoStart:!0,requires:[n.IDocumentManager,n.IDocumentWidgetOpener],activate:(e,t,a)=>{const i=e.serviceManager.contents;a.opened.connect(((e,a)=>{var n;const r=t.contextForWidget(a);""!==i.driveName(null!==(n=null==r?void 0:r.path)&&void 0!==n?n:"")&&(a.context.sessionContext._path=null==r?void 0:r.path)}))}},te=[V,Z,X,ee]}}]);