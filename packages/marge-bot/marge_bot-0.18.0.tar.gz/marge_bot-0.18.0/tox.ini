[tox]
minversion = 4.0
envlist = py3,isort,black,flake8,pylint,mypy
isolated_build = True

[testenv]
passenv =
  NO_COLOR
  PWD
  PY_COLORS
  CI_MERGE_REQUEST_DIFF_BASE_SHA

skip_install = True
runner = uv-venv-lock-runner
dependency_groups = lint

[testenv:flake8]
commands =
  flake8 {posargs} {toxinidir}/

[testenv:pylint]
dependency_groups =
  lint
  test
commands =
  pylint {posargs} {toxinidir}/marge/ {toxinidir}/tests/

[testenv:black]
commands =
  black {posargs} {toxinidir}/

[testenv:commitizen]
commands =
  cz check --rev-range {env:CI_MERGE_REQUEST_DIFF_BASE_SHA:origin/main}..HEAD

[testenv:isort]
commands =
  isort {posargs} {toxinidir}/

[testenv:mypy]
commands =
  mypy {posargs}

[testenv:py3]
dependency_groups = test
commands =
  pytest --cov-report term --cov-report html --cov-report xml --junitxml=test.xml {posargs}

[flake8]
exclude = .git,.venv,.tox,dist,doc,*egg,build,__pycache__
# We ignore the following because we use black to handle code-formatting
# E203: Whitespace before ':'
# E501: Line too long
# E704: Multiple statements on one line (def)
# W503: Line break occurred before a binary operator
ignore = E203,E501,E704,W503
