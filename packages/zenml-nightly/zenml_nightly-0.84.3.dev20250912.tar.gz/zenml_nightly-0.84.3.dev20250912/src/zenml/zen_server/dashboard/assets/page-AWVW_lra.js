import{j as e,r as u}from"./@radix-B1sy0Lhr.js";import{x as p,F as f,G as y,H as j,aH as g,aJ as v,a7 as N,B as l,ay as m,a_ as d,aZ as b,d as w,C,o as k,p as S,q as D,w as P}from"./index-Ci5z7q6x.js";import{S as _}from"./chevron-down-Bl7WwQAL.js";import{I as E}from"./Infobox-CXOIY92f.js";import{c as F,b as R}from"./@tanstack-Dwlisomv.js";import{a as T}from"./@react-router-CHjLNlgw.js";import{F as z}from"./icon--Tp6obFZ.js";import"./@reactflow-gbyyU3kq.js";import"./info-CI2szPUG.js";async function O({connectorId:s}){const t=f(j.serviceConnectors.verifyExisting(s)),n=await p(t,{method:"PUT",headers:{"Content-Type":"application/json"}});if(!n.ok){const r=await n.json().then(i=>Array.isArray(i.detail)?i.detail[1]:i.detail).catch(()=>"Failed to verify connector");throw new y({status:n.status,statusText:n.statusText,message:r})}return n.json()}function V(s){return F({...s,mutationFn:async({connectorId:t})=>O({connectorId:t})})}const B="/assets/connectivity-4UKGMYnr.webp";function I({open:s,isLoading:t,isError:n,onClose:r,onSuccess:i,data:a}){const c=!!(a!=null&&a.error),o=(a==null?void 0:a.error)??void 0;return e.jsx(g,{open:s,children:e.jsx(v,{onPointerDownOutside:x=>t?x.preventDefault():r==null?void 0:r(),onEscapeKeyDown:x=>t?x.preventDefault():r==null?void 0:r(),className:"max-w-[540px] p-8",children:e.jsxs("div",{className:"flex w-full flex-col items-center justify-center space-y-5",children:[t&&!a&&e.jsx(A,{onClose:r}),!t&&!n&&!c&&e.jsx(H,{onSuccess:i}),!t&&(n||c)&&e.jsx(Q,{error:o,onClose:r})]})})})}function A({onClose:s}){return e.jsxs(e.Fragment,{children:[e.jsx(N,{}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:"Verifying your service connector"}),e.jsxs("p",{className:"text-text-lg text-theme-text-secondary",children:["Please wait while we check your connection ",e.jsx("br",{}),"This may take up to a minute."]})]}),e.jsx(l,{size:"md",emphasis:"subtle",onClick:s,intent:"secondary",className:"mt-4",children:"Cancel"})]})}function H({onSuccess:s}){return e.jsxs(e.Fragment,{children:[e.jsx(m,{width:180,height:180,className:"fill-theme-text-success"}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:"Connection verified successfully!"}),e.jsx("p",{className:"text-text-lg text-theme-text-secondary",children:"Ready to show your available resources"})]}),e.jsx(l,{size:"md",onClick:s,className:"mt-4",children:"Display Resources"})]})}function Q({onClose:s,error:t}){return e.jsxs(e.Fragment,{children:[e.jsx("img",{src:B,alt:"Connectivity",width:180,height:180}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:"We couldn't verify your connection"}),t&&e.jsx("p",{className:"max-h-[250px] overflow-auto rounded-md border border-theme-border-moderate bg-theme-surface-secondary p-1 text-left font-mono",children:t}),e.jsx("p",{className:"text-text-lg text-theme-text-secondary",children:"Please try again to list your resources"})]}),e.jsx(l,{size:"md",emphasis:"subtle",onClick:s,intent:"secondary",className:"mt-4",children:"Close"})]})}function h({children:s}){const{setResources:t}=d(),{connectorId:n}=T(),r=R({...b.serviceConnectorDetail(n),throwOnError:!0}),[i,a]=u.useState(!1),c=V();if(r.isPending)return e.jsx(w,{className:"h-7 w-[150px]"});if(r.isError)return null;const o=()=>{a(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(I,{data:c.data,open:i,isLoading:c.isPending,isError:c.isError,onClose:o,onSuccess:()=>{c.data&&(t(c.data),a(!1))}}),e.jsxs(l,{disabled:c.isPending&&i,onClick:()=>{a(!0),c.mutate({connectorId:n})},className:"gap-1",size:"md",children:[e.jsx(m,{width:24,height:24,className:"size-5 shrink-0 fill-white"}),s]})]})}function G(){var n;const{resources:s}=d();if(!s)return null;const t=s.connector_type;return!t||typeof t=="string"?null:e.jsxs("div",{className:"space-y-5",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(h,{children:e.jsx("span",{children:"Reverify now"})})}),(n=s.resources)==null?void 0:n.map(r=>{var i,a;return e.jsx(K,{title:(i=t.resource_types.find(c=>c.resource_type===r.resource_type))==null?void 0:i.name,logoUrl:((a=t.resource_types.find(c=>c.resource_type===r.resource_type))==null?void 0:a.logo_url)??void 0,resource:r},r.resource_type)})]})}function K({resource:s,title:t,logoUrl:n}){const[r,i]=u.useState(!0),a=s.error,c=s.resource_ids??[];return e.jsxs(C,{open:r,onOpenChange:i,children:[e.jsx(k,{className:"flex items-center gap-[10px]",children:e.jsxs(S,{className:"flex w-full items-center gap-[10px] text-text-lg",children:[e.jsx(_,{className:` ${r?"":"-rotate-90"} h-5 w-5 rounded-md fill-neutral-500 transition-transform duration-200 hover:bg-neutral-200`}),t||s.resource_type]})}),e.jsx(D,{className:"space-y-5 border-t border-theme-border-moderate bg-theme-surface-primary",children:a?e.jsx("div",{className:"p-5",children:e.jsx(E,{intent:"error",children:a})}):e.jsx("ul",{className:"divide-y divide-theme-border-moderate",children:c.map(o=>e.jsxs("li",{className:"flex items-center space-x-2 py-3 pl-8",children:[!!n&&e.jsx("img",{width:24,height:24,src:n,alt:t,className:"size-5 shrink-0"}),e.jsx("span",{children:o})]},o))})})]})}function M(){return e.jsx("div",{className:"p-9",children:e.jsxs("div",{className:"flex flex-col items-center space-y-5",children:[e.jsx(z,{icon:e.jsx(P,{className:"h-[36px] w-[36px] fill-primary-400"})}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:"Please verify your service connector"}),e.jsxs("p",{className:"text-text-lg text-theme-text-secondary",children:["We'll check your connection and load available resources.",e.jsx("br",{}),"This may take up to a minute."]})]}),e.jsx(h,{children:e.jsx("span",{children:"Verify now"})})]})})}function ee(){const{resources:s}=d();return s===null?e.jsx(M,{}):e.jsx(G,{})}export{ee as default};
