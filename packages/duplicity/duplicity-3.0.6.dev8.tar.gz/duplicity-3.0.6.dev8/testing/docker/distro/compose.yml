#
# Copyright 2017 Nils Tekampe <nils@tekampe.org>,
# Kenneth Loafman <kenneth@loafman.com>
#
# This file is part of duplicity.
# This script sets up a test network for the tests of dupclicity
# This script takes the assumption that the containers for the testinfrastructure do deither run
# or they are removed. It is not intended to have stopped containers.
#
# Duplicity is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by the
# Free Software Foundation; either version 2 of the License, or (at your
# option) any later version.
#
# Duplicity is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with duplicity; if not, write to the Free Software Foundation,
# Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
#

name: distro

services:

    ub20:
        image: distro/ub20
        container_name: ub20
        hostname: ub20
        environment:
            - PYTEST_ARGS=${PYTEST_ARGS:-""}
        entrypoint: /bin/bash
        command: -c "make ext ; pytest ${PYTEST_ARGS:-""}"
        volumes:
            - ../../..:/root/duplicity
            - pytest:/root/duplicity/.pytest_cache

    ub22:
        image: distro/ub22
        container_name: ub22
        hostname: ub22
        environment:
            - PYTEST_ARGS=${PYTEST_ARGS:-""}
        entrypoint: /bin/bash
        command: -c "sleep 2 ; make ext ; pytest ${PYTEST_ARGS:-""}"
        volumes:
            - ../../..:/root/duplicity
            - pytest:/root/duplicity/.pytest_cache

    ub24:
        image: distro/ub24
        container_name: ub24
        hostname: ub24
        environment:
            - PYTEST_ARGS=${PYTEST_ARGS:-""}
        entrypoint: /bin/bash
        command: -c "sleep 4 ; make ext ; pytest ${PYTEST_ARGS:-""}"
        volumes:
            - ../../..:/root/duplicity
            - pytest:/root/duplicity/.pytest_cache

volumes:
    pytest:
