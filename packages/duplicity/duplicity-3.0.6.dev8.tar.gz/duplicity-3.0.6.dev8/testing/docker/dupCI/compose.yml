#
# Copyright 2017 Nils Tekampe
# Copyright 2019 Kenneth Loafman
#
# This file is part of duplicity.
# This script sets up a test network for the tests of dupclicity
# This script takes the assumption that the containers for the testinfrastructure do deither run
# or they are removed. It is not intended to have stopped containers.
#
# Duplicity is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by the
# Free Software Foundation; either version 2 of the License, or (at your
# option) any later version.
#
# Duplicity is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with duplicity; if not, write to the Free Software Foundation,
# Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
#

name: dupCI

services:

    py39:
        image: dupci/py39
        container_name: py39
        hostname: py39
        environment:
            - PYTEST_ARGS=${PYTEST_ARGS:-""}
        entrypoint: /bin/bash
        command: -c "make ext ; pytest ${PYTEST_ARGS:-""}"
        volumes:
            - ../../..:/root/duplicity
            - pytest:/root/duplicity/.pytest_cache

    py310:
        image: dupci/py310
        container_name: py310
        hostname: py310
        environment:
            - PYTEST_ARGS=${PYTEST_ARGS:-""}
        entrypoint: /bin/bash
        command: -c "sleep 2 ; make ext ; pytest ${PYTEST_ARGS:-""}"
        volumes:
            - ../../..:/root/duplicity
            - pytest:/root/duplicity/.pytest_cache

    py311:
        image: dupci/py311
        container_name: py311
        hostname: py311
        environment:
            - PYTEST_ARGS=${PYTEST_ARGS:-""}
        entrypoint: /bin/bash
        command: -c "sleep 4 ; make ext ; pytest ${PYTEST_ARGS:-""}"
        volumes:
            - ../../..:/root/duplicity
            - pytest:/root/duplicity/.pytest_cache

    py312:
        image: dupci/py312
        container_name: py312
        hostname: py312
        environment:
            - PYTEST_ARGS=${PYTEST_ARGS:-""}
        entrypoint: /bin/bash
        command: -c "sleep 6 ; make ext ; pytest ${PYTEST_ARGS:-""}"
        volumes:
            - ../../..:/root/duplicity
            - pytest:/root/duplicity/.pytest_cache

    py313:
        image: dupci/py313
        container_name: py313
        hostname: py313
        environment:
            - PYTEST_ARGS=${PYTEST_ARGS:-""}
        entrypoint: /bin/bash
        command: -c "sleep 8 ; make ext ; pytest ${PYTEST_ARGS:-""}"
        volumes:
            - ../../..:/root/duplicity
            - pytest:/root/duplicity/.pytest_cache

    py314:
        image: dupci/py314
        container_name: py314
        hostname: py314
        environment:
            - PYTEST_ARGS=${PYTEST_ARGS:-""}
        entrypoint: /bin/bash
        command: -c "sleep 10 ; make ext ; pytest ${PYTEST_ARGS:-""}"
        volumes:
            - ../../..:/root/duplicity
            - pytest:/root/duplicity/.pytest_cache

volumes:
    pytest:
