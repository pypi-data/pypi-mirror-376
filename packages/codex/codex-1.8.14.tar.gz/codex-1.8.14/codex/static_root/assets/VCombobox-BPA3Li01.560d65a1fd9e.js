import{u as ye,t as D,e as Ve,m as ke,a as Ce,V as we,b as Ie,f as Se,d as Fe}from"./VSelect-DIXHkKJm.js";import{p as De,c as G,q as Pe}from"./VSelectionControl-xYnmeS9J.js";import{u as Re,f as Ae,p as Te,k as J,l as Me}from"./forwardRefs-BXEe8ItZ.js";import{u as Ee,m as _e,h as Le}from"./filter-Bu2xCEP4.js";import{g as Ne,p as Ke,aD as Be,r as _,aV as w,e as Z,bG as Oe,c as x,aZ as L,bH as Ue,t as ze,aW as P,bI as Q,u as $e,a as d,m as k,o as qe,bJ as He,bK as X,bv as je,b as I,bL as We,F as q,bM as Ge,n as Je,d as Ze,A as Qe}from"./main-d46UvpG6.js";import{a as Y,g as Xe}from"./VDialog-BFf48e97.js";import{a as Ye}from"./VDivider-Dtis_q2S.js";import{V as el}from"./VCheckboxBtn-CYmOhPsT.js";const ll=Ke({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,..._e({filterKeys:["title"]}),...ke({hideNoData:!0,returnObject:!0}),...qe(Pe({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Te({transition:!1})},"VCombobox"),cl=Ne()({name:"VCombobox",props:ll(),emits:{"update:focused":l=>!0,"update:modelValue":l=>!0,"update:search":l=>!0,"update:menu":l=>!0},setup(l,ee){let{emit:le,slots:r}=ee;const{t:N}=Be(),m=_(),g=w(!1),h=w(!0),K=w(!1),B=w(!1),H=_(),R=_(),o=w(-1);let O=!1;const{items:j,transformIn:ae,transformOut:te}=ye(l),{textColorClasses:ue,textColorStyles:ne}=Re(()=>m.value?.color),u=Z(l,"modelValue",[],e=>ae(Oe(e)),e=>{const n=te(e);return l.multiple?n:n[0]??null}),A=De(l),T=x(()=>!!(l.chips||r.chip)),p=x(()=>T.value||!!r.selection),y=w(!l.multiple&&!p.value?u.value[0]?.title??"":""),s=x({get:()=>y.value,set:async e=>{if(y.value=e??"",!l.multiple&&!p.value&&(u.value=[D(l,e)],L(()=>R.value?.scrollToIndex(0))),e&&l.multiple&&l.delimiters?.length){const n=l.delimiters.map(Ue).join("|"),i=e.split(new RegExp(`(?:${n})+`));if(i.length>1){for(let a of i)a=a.trim(),a&&(b(D(l,a)),await L());y.value=""}}e||(o.value=-1),h.value=!e}}),oe=x(()=>typeof l.counterValue=="function"?l.counterValue(u.value):typeof l.counterValue=="number"?l.counterValue:l.multiple?u.value.length:s.value.length),{filteredItems:C,getMatches:ie}=Ee(l,j,()=>h.value?"":s.value),V=x(()=>l.hideSelected?C.value.filter(e=>!u.value.some(n=>n.value===e.value)):C.value.length===0&&B.value?j.value:C.value),M=x(()=>l.hideNoData&&!V.value.length||A.isReadonly.value||A.isDisabled.value),U=Z(l,"menu"),c=x({get:()=>U.value,set:e=>{U.value&&!e&&H.value?.Î¨openChildren.size||e&&M.value||(U.value=e)}}),W=ze(()=>c.value?l.closeText:l.openText);P(y,e=>{B.value=!1,O?L(()=>O=!1):g.value&&!c.value&&(c.value=!0),h.value=!e,le("update:search",e)}),P(u,e=>{!l.multiple&&!p.value&&(y.value=e[0]?.title??"")});const se=x(()=>u.value.map(e=>e.value)),z=x(()=>(l.autoSelectFirst===!0||l.autoSelectFirst==="exact"&&s.value===V.value[0]?.title)&&V.value.length>0&&!h.value&&!K.value),$=_(),re=Ve($,m);function ce(e){O=!0,l.openOnClear&&(c.value=!0)}function ve(){M.value||(c.value=!0)}function de(e){M.value||(g.value&&(e.preventDefault(),e.stopPropagation()),c.value=!c.value)}function fe(e){(X(e)||e.key==="Backspace")&&m.value?.focus()}function me(e){if(He(e)||A.isReadonly.value)return;const n=m.value?.selectionStart,i=u.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(e.key)&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(c.value=!0),["Escape"].includes(e.key)&&(c.value=!1),["Enter","Escape","Tab"].includes(e.key)&&(z.value&&["Enter","Tab"].includes(e.key)&&!u.value.some(a=>{let{value:t}=a;return t===V.value[0].value})&&b(C.value[0]),h.value=!0),e.key==="ArrowDown"&&z.value&&$.value?.focus("next"),e.key==="Enter"&&s.value&&(b(D(l,s.value)),p.value&&(y.value="")),["Backspace","Delete"].includes(e.key)){if(!l.multiple&&p.value&&u.value.length>0&&!s.value)return b(u.value[0],!1);if(~o.value){e.preventDefault();const a=o.value;b(u.value[o.value],!1),o.value=a>=i-1?i-2:a}else e.key==="Backspace"&&!s.value&&(o.value=i-1);return}if(l.multiple)if(e.key==="ArrowLeft"){if(o.value<0&&n&&n>0)return;const a=o.value>-1?o.value-1:i-1;u.value[a]?o.value=a:(o.value=-1,m.value?.setSelectionRange(s.value.length,s.value.length))}else if(e.key==="ArrowRight"){if(o.value<0)return;const a=o.value+1;u.value[a]?o.value=a:(o.value=-1,m.value?.setSelectionRange(0,0))}else~o.value&&X(e)&&(o.value=-1)}function he(){l.eager&&R.value?.calculateVisibleItems()}function be(){g.value&&(h.value=!0,m.value?.focus())}function b(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!e||e.props.disabled))if(l.multiple){const i=u.value.findIndex(t=>(l.valueComparator||Q)(t.value,e.value)),a=n??!~i;if(~i){const t=a?[...u.value,e]:[...u.value];t.splice(i,1),u.value=t}else a&&(u.value=[...u.value,e]);l.clearOnSelect&&(s.value="")}else{const i=n!==!1;u.value=i?[e]:[],y.value=i&&!p.value?e.title:"",L(()=>{c.value=!1,h.value=!0})}}function ge(e){g.value=!0,setTimeout(()=>{K.value=!0})}function pe(e){K.value=!1}function xe(e){(e==null||e===""&&!l.multiple&&!p.value)&&(u.value=[])}return P(g,(e,n)=>{if(!(e||e===n)&&(o.value=-1,c.value=!1,s.value)){if(l.multiple){b(D(l,s.value));return}if(!p.value)return;u.value.some(i=>{let{title:a}=i;return a===s.value})?y.value="":b(D(l,s.value))}}),P(c,e=>{if(!l.hideSelected&&e&&u.value.length){const n=V.value.findIndex(i=>u.value.some(a=>(l.valueComparator||Q)(a.value,i.value)));je&&window.requestAnimationFrame(()=>{n>=0&&R.value?.scrollToIndex(n)})}e&&s.value&&C.value.length===0&&(B.value=!0),h.value=!s.value},{immediate:!0}),P(()=>l.items,(e,n)=>{c.value||g.value&&!n.length&&e.length&&(c.value=!0)}),$e(()=>{const e=!!(!l.hideNoData||V.value.length||r["prepend-item"]||r["append-item"]||r["no-data"]),n=u.value.length>0,i=G.filterProps(l);return d(G,k({ref:m},i,{modelValue:s.value,"onUpdate:modelValue":[a=>s.value=a,xe],focused:g.value,"onUpdate:focused":a=>g.value=a,validationValue:u.externalValue,counterValue:oe.value,dirty:n,class:["v-combobox",{"v-combobox--active-menu":c.value,"v-combobox--chips":!!l.chips,"v-combobox--selection-slot":!!p.value,"v-combobox--selecting-index":o.value>-1,[`v-combobox--${l.multiple?"multiple":"single"}`]:!0},l.class],style:l.style,readonly:A.isReadonly.value,placeholder:n?void 0:l.placeholder,"onClick:clear":ce,"onMousedown:control":ve,onKeydown:me}),{...r,default:()=>I(q,null,[d(Ce,k({ref:H,modelValue:c.value,"onUpdate:modelValue":a=>c.value=a,activator:"parent",contentClass:"v-combobox__content",disabled:M.value,eager:l.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:l.transition,onAfterEnter:he,onAfterLeave:be},l.menuProps),{default:()=>[e&&d(we,k({ref:$,filterable:!0,selected:se.value,selectStrategy:l.multiple?"independent":"single-independent",onMousedown:a=>a.preventDefault(),selectable:!0,onKeydown:fe,onFocusin:ge,onFocusout:pe,tabindex:"-1","aria-live":"polite",color:l.itemColor??l.color},re,l.listProps),{default:()=>[r["prepend-item"]?.(),!V.value.length&&!l.hideNoData&&(r["no-data"]?.()??d(Y,{key:"no-data",title:N(l.noDataText)},null)),d(Ie,{ref:R,renderless:!0,items:V.value,itemKey:"value"},{default:a=>{let{item:t,index:v,itemRef:E}=a;const S=k(t.props,{ref:E,key:t.value,active:z.value&&v===0?!0:void 0,onClick:()=>b(t,null)});return t.type==="divider"?r.divider?.({props:t.raw,index:v})??d(Ye,k(t.props,{key:`divider-${v}`}),null):t.type==="subheader"?r.subheader?.({props:t.raw,index:v})??d(Se,k(t.props,{key:`subheader-${v}`}),null):r.item?.({item:t,index:v,props:S})??d(Y,k(S,{role:"option"}),{prepend:F=>{let{isSelected:f}=F;return I(q,null,[l.multiple&&!l.hideSelected?d(el,{key:t.value,modelValue:f,ripple:!1,tabindex:"-1"},null):void 0,t.props.prependAvatar&&d(Xe,{image:t.props.prependAvatar},null),t.props.prependIcon&&d(J,{icon:t.props.prependIcon},null)])},title:()=>h.value?t.title:Le("v-combobox",t.title,ie(t)?.title)})}}),r["append-item"]?.()]})]}),u.value.map((a,t)=>{function v(f){f.stopPropagation(),f.preventDefault(),b(a,!1)}const E={"onClick:close":v,onKeydown(f){f.key!=="Enter"&&f.key!==" "||(f.preventDefault(),f.stopPropagation(),v(f))},onMousedown(f){f.preventDefault(),f.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},S=T.value?!!r.chip:!!r.selection,F=S?Ge(T.value?r.chip({item:a,index:t,props:E}):r.selection({item:a,index:t})):void 0;if(!(S&&!F))return I("div",{key:a.value,class:Ze(["v-combobox__selection",t===o.value&&["v-combobox__selection--selected",ue.value]]),style:Je(t===o.value?ne.value:{})},[T.value?r.chip?d(Me,{key:"chip-defaults",defaults:{VChip:{closable:l.closableChips,size:"small",text:a.title}}},{default:()=>[F]}):d(Fe,k({key:"chip",closable:l.closableChips,size:"small",text:a.title,disabled:a.props.disabled},E),null):F??I("span",{class:"v-combobox__selection-text"},[a.title,l.multiple&&t<u.value.length-1&&I("span",{class:"v-combobox__selection-comma"},[Qe(",")])])])})]),"append-inner":function(){for(var a=arguments.length,t=new Array(a),v=0;v<a;v++)t[v]=arguments[v];return I(q,null,[r["append-inner"]?.(...t),l.menuIcon?d(J,{class:"v-combobox__menu-icon",color:m.value?.fieldIconColor,icon:l.menuIcon,onMousedown:de,onClick:We,"aria-label":N(W.value),title:N(W.value),tabindex:"-1"},null):void 0])}})}),Ae({isFocused:g,isPristine:h,menu:c,search:s,selectionIndex:o,filteredItems:C,select:b},m)}});export{cl as V};
