(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[316],{16443:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>_});var a=s(95155),n=s(12115),l=s(51290),t=s.n(l),c=s(37123);let i=()=>(0,a.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M8 5V19L19 12L8 5Z"})}),o=()=>(0,a.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M6 19H10V5H6V19ZM14 5V19H18V5H14Z"})});function d(e){let{runData:r,onStatusChange:s}=e,l="paused"===r.scanning_status.toLowerCase(),[d,u]=(0,n.useState)(l),[g,p]=(0,n.useState)(!1),m=async()=>{if(!g){p(!0);try{let e=d?c.Q.runs.resume(r.scan_id):c.Q.runs.pause(r.scan_id);if(!(await fetch(e,{method:"POST"})).ok)throw Error("Failed to ".concat(d?"resume":"pause"," scan"));u(!d),s&&s()}catch(e){console.error("Error toggling scan status:",e)}finally{p(!1)}}};return n.useEffect(()=>{u("paused"===r.scanning_status.toLowerCase())},[r.scanning_status]),(0,a.jsxs)("div",{className:t().progressCard,children:[(0,a.jsxs)("div",{className:t().progressCardContent,children:[(0,a.jsxs)("div",{className:t().progressCardColumn,children:[(0,a.jsxs)("div",{className:t().progressCardField,children:[(0,a.jsx)("div",{className:t().progressCardLabel,children:"Scan name:"}),(0,a.jsx)("div",{className:t().progressCardValue,title:r.scan_name,children:r.scan_name})]}),(0,a.jsxs)("div",{className:t().progressCardField,children:[(0,a.jsx)("div",{className:t().progressCardLabel,children:"Scanning Percentage:"}),(0,a.jsxs)("div",{className:t().progressCardValue,children:[r.scan_percentage.toFixed(2),"%"]})]})]}),(0,a.jsxs)("div",{className:t().progressCardColumn,children:[(0,a.jsxs)("div",{className:t().progressCardField,children:[(0,a.jsx)("div",{className:t().progressCardLabel,children:"Model name:"}),(0,a.jsx)("div",{className:t().progressCardValue,title:r.model_name,children:r.model_name})]}),(0,a.jsxs)("div",{className:t().progressCardField,children:[(0,a.jsx)("div",{className:t().progressCardLabel,children:"Scanning Progress:"}),(0,a.jsxs)("div",{className:t().progressCardValue,children:[r.passed_line,"/",r.total_length||"?"]})]})]}),(0,a.jsxs)("div",{className:t().progressCardColumn,children:[(0,a.jsxs)("div",{className:t().progressCardField,children:[(0,a.jsx)("div",{className:t().progressCardLabel,children:"Starting at:"}),(0,a.jsx)("div",{className:t().progressCardValue,children:r.scan_time})]}),(0,a.jsxs)("div",{className:t().progressCardField,children:[(0,a.jsx)("div",{className:t().progressCardLabel,children:"Time remaining:"}),(0,a.jsx)("div",{className:t().progressCardValue,children:r.remaining_time})]})]}),(0,a.jsx)("button",{className:t().progressCardPlayButton,onClick:m,disabled:g||r.complete_flag,"aria-label":d?"Resume scan":"Pause scan","data-status":d?"paused":"running",title:r.complete_flag?"Scan complete":d?"Resume scan":"Pause scan",children:r.complete_flag?(0,a.jsx)("span",{children:"âœ“"}):d?(0,a.jsx)(i,{}):(0,a.jsx)(o,{})})]}),(0,a.jsx)("div",{className:t().progressBarContainer,children:(0,a.jsx)("div",{className:"".concat(t().progressBarFill," ").concat(d||r.complete_flag?"":t().animatedShimmer),style:{width:"".concat(r.scan_percentage,"%")},role:"progressbar","aria-valuenow":r.scan_percentage,"aria-valuemin":0,"aria-valuemax":100})})]})}var u=s(5777),g=s.n(u),p=s(38561),m=s(78772),h=s(48263);function _(){let[e,r]=(0,n.useState)([]),[s,l]=(0,n.useState)(!0),[t,i]=(0,n.useState)(null),[o,u]=(0,n.useState)(0),[_,C]=(0,n.useState)(!1),v=(0,n.useRef)(5e3),x=(0,n.useRef)(""),j=(0,n.useRef)(null),f=(0,n.useRef)(!0),N=(0,n.useRef)(null),b=(0,n.useRef)(!0),w=(0,n.useRef)(!0),S=(0,n.useCallback)(async()=>{if(!b.current||!w.current)return;j.current&&j.current.abort();let e=new AbortController;j.current=e;let s=e.signal;try{l(!0);let e=await fetch(c.Q.runs.progress,{signal:s});if(!b.current)return;if(!e.ok)throw Error("Failed to fetch active runs");let a=await e.json(),n=a.map(e=>({scan_id:e.scan_id,scan_percentage:e.scan_percentage,passed_line:e.passed_line,scanning_status:e.scanning_status})),t=JSON.stringify(n);f.current?f.current=!1:t===x.current?v.current=Math.min(1.5*v.current,2e4):v.current=5e3,console.log("polling interval",v.current),x.current=t,r(a),i(null)}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;console.error("Error fetching active runs:",e),i(e instanceof Error?e.message:"An error occurred")}finally{j.current===e&&b.current&&(j.current=null,l(!1)),b.current&&w.current&&(N.current=setTimeout(()=>{S()},v.current))}},[]),y=(0,n.useCallback)(()=>{N.current&&clearTimeout(N.current),w.current=!0,S()},[S]),E=(0,n.useCallback)(()=>{w.current=!1,N.current&&(clearTimeout(N.current),N.current=null),j.current&&(j.current.abort(),j.current=null)},[]);(0,n.useEffect)(()=>{b.current=!0,y();let e=()=>{document.hidden?E():y()};return document.addEventListener("visibilitychange",e),()=>{b.current=!1,E(),document.removeEventListener("visibilitychange",e)}},[y,E]),(0,n.useEffect)(()=>{o>0&&(v.current=5e3,E(),y())},[o,y,E]),(0,n.useEffect)(()=>{_?E():y()},[_,y,E]);let F=()=>{v.current=5e3,u(e=>e+1)},L=async e=>{C(!1),e&&setTimeout(async()=>{v.current=5e3,y()},1e3)};return s&&0===e.length?(0,a.jsx)("div",{className:g().loading,children:(0,a.jsx)(h.y,{})}):(0===e.length&&(console.log(" found activeRuns.length === 0"),E()),(0,a.jsxs)("div",{className:g().container,children:[(0,a.jsxs)("div",{className:g().pageHeader,children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:g().title,children:"Progress"}),(0,a.jsx)("div",{className:g().subtitle,children:"Watch the scanning progress"})]}),(0,a.jsx)("div",{className:g().actions,children:(0,a.jsx)(p.T,{radius:"full",variant:"bordered",color:"primary",onPress:()=>C(!0),className:g().buttonColorSolid,children:"New Scan"})})]}),t?(0,a.jsx)("div",{className:g().error,children:t}):(0,a.jsx)("div",{className:g().progressCardContainer,children:e.length>0?e.map(e=>(0,a.jsx)(d,{runData:e,onStatusChange:F},e.scan_id)):(0,a.jsx)("div",{className:g().progressCard,children:(0,a.jsx)("div",{className:g().progressCardContent,children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{children:"No Active Scans"}),(0,a.jsx)("p",{children:"There are no scans currently in progress."})]})})})}),(0,a.jsx)(m.D,{isOpen:_,onClose:e=>L(e)})]}))}},28873:(e,r,s)=>{Promise.resolve().then(s.bind(s,16443))},51290:e=>{e.exports={progressCard:"progress_progressCard__ZToeC",progressCardContent:"progress_progressCardContent__l29zd",progressCardColumn:"progress_progressCardColumn__6QQ_p",progressCardField:"progress_progressCardField__HVAxs",progressCardLabel:"progress_progressCardLabel__Mvy2y",progressCardValue:"progress_progressCardValue__5zi6b",progressCardPlayButton:"progress_progressCardPlayButton__f_7IO",progressBarContainer:"progress_progressBarContainer__hsCBQ",progressBarFill:"progress_progressBarFill__DwPH0",animatedShimmer:"progress_animatedShimmer__P7h1_",shimmer:"progress_shimmer___1Xip"}}},e=>{var r=r=>e(e.s=r);e.O(0,[802,512,766,817,508,904,441,684,358],()=>r(28873)),_N_E=e.O()}]);