# call with:
# cbindgen --config shared/cbindgen.toml --crate lakers-shared --output target/include/lakers_shared.h -vv

language = "C"

header = """
// clang-format off

/*
 * ================================================================================================
 *  WARNING: This file is automatically generated by cbindgen. Manual edits are likely to be lost.
 * ================================================================================================
 */

#ifndef LAKERS_SHARED_H
#define LAKERS_SHARED_H

/* Manually implemented to work around https://github.com/mozilla/cbindgen/issues/1018 */

#if defined(_LARGE_BUFFERS)
#define _MAX_MESSAGE_SIZE_LEN_1024
#define _MAX_KDF_CONTENT_LEN_1024
#define _MAX_BUFFER_LEN_1024
#define _MAX_CONNID_ENCODED_LEN_24
#define _MAX_EAD_LEN_1024
#endif

#if defined(_MAX_MESSAGE_SIZE_LEN_1024)
#define MAX_MESSAGE_SIZE_LEN 1024
#elif defined(_MAX_MESSAGE_SIZE_LEN_512)
#define MAX_MESSAGE_SIZE_LEN 512
#elif defined(_MAX_MESSAGE_SIZE_LEN_448)
#define MAX_MESSAGE_SIZE_LEN 448
#elif defined(_MAX_MESSAGE_SIZE_LEN_384)
#define MAX_MESSAGE_SIZE_LEN 384
#elif defined(_MAX_MESSAGE_SIZE_LEN_320)
#define MAX_MESSAGE_SIZE_LEN 320
#elif defined(_MAX_MESSAGE_SIZE_LEN_256)
#define MAX_MESSAGE_SIZE_LEN 256
#else
#define MAX_MESSAGE_SIZE_LEN 128 + 64
#endif

#if defined(_MAX_KDF_CONTENT_LEN_1024)
#define MAX_KDF_CONTEXT_LEN 1024
#elif defined(_MAX_KDF_CONTENT_LEN_512)
#define MAX_KDF_CONTEXT_LEN 512
#elif defined(_MAX_KDF_CONTENT_LEN_448)
#define MAX_KDF_CONTEXT_LEN 448
#elif defined(_MAX_KDF_CONTENT_LEN_384)
#define MAX_KDF_CONTEXT_LEN 384
#elif defined(_MAX_KDF_CONTENT_LEN_320)
#define MAX_KDF_CONTEXT_LEN 320
#else
#define MAX_KDF_CONTEXT_LEN 256
#endif

#if defined(_MAX_BUFFER_LEN_1024)
#define MAX_BUFFER_LEN 1024
#elif defined(_MAX_BUFFER_LEN_512)
#define MAX_BUFFER_LEN 512
#elif defined(_MAX_BUFFER_LEN_448)
#define MAX_BUFFER_LEN 448
#elif defined(_MAX_BUFFER_LEN_384)
#define MAX_BUFFER_LEN 384
#else
#define MAX_BUFFER_LEN 256 + 64
#endif

#if defined(_MAX_EAD_LEN_1024)
#define MAX_EAD_LEN 1024
#elif defined(_MAX_EAD_LEN_768)
#define MAX_EAD_LEN 768
#elif defined(_MAX_EAD_LEN_512)
#define MAX_EAD_LEN 512
#elif defined(_MAX_EAD_LEN_384)
#define MAX_EAD_LEN 384
#elif defined(_MAX_EAD_LEN_256)
#define MAX_EAD_LEN 256
#elif defined(_MAX_EAD_LEN_192)
#define MAX_EAD_LEN 192
#elif defined(_MAX_EAD_LEN_128)
#define MAX_EAD_LEN 128
#else
#define MAX_EAD_LEN 64
#endif

#if defined(_MAX_CONNID_ENCODED_LEN_24)
#define MAX_CONNID_ENCODED_LEN 24
#else
#define MAX_CONNID_ENCODED_LEN 8
#endif
"""

trailer = """
#endif  /* LAKERS_SHARED_H */

// clang-format on
"""

# Done manually so that the manual parts of the MAX_MESSAGE_SIZE_LEN_xxx etc
# features can be placed after the include guard:
# include_guard = "LAKERS_SHARED_H"
cpp_compat = true

[defines]
"feature = large_buffers" = "_LARGE_BUFFERS"
"feature = max_message_size_len_256" = "_MAX_MESSAGE_SIZE_LEN_256"
"feature = max_message_size_len_320" = "_MAX_MESSAGE_SIZE_LEN_320"
"feature = max_message_size_len_384" = "_MAX_MESSAGE_SIZE_LEN_384"
"feature = max_message_size_len_448" = "_MAX_MESSAGE_SIZE_LEN_448"
"feature = max_message_size_len_512" = "_MAX_MESSAGE_SIZE_LEN_512"
"feature = max_message_size_len_1024" = "_MAX_MESSAGE_SIZE_LEN_1024"
"feature = max_kdf_content_len_320" = "_MAX_KDF_CONTENT_LEN_320"
"feature = max_kdf_content_len_384" = "_MAX_KDF_CONTENT_LEN_384"
"feature = max_kdf_content_len_448" = "_MAX_KDF_CONTENT_LEN_448"
"feature = max_kdf_content_len_512" = "_MAX_KDF_CONTENT_LEN_512"
"feature = max_kdf_content_len_1024" = "_MAX_KDF_CONTENT_LEN_1024"
"feature = max_buffer_len_384" = "_MAX_BUFFER_LEN_384"
"feature = max_buffer_len_448" = "_MAX_BUFFER_LEN_448"
"feature = max_buffer_len_512" = "_MAX_BUFFER_LEN_512"
"feature = max_buffer_len_1024" = "_MAX_BUFFER_LEN_1024"
"feature = max_ead_len_128" = "_MAX_EAD_LEN_128"
"feature = max_ead_len_192" = "_MAX_EAD_LEN_192"
"feature = max_ead_len_256" = "_MAX_EAD_LEN_256"
"feature = max_ead_len_384" = "_MAX_EAD_LEN_384"
"feature = max_ead_len_512" = "_MAX_EAD_LEN_512"
"feature = max_ead_len_768" = "_MAX_EAD_LEN_768"
"feature = max_ead_len_1024" = "_MAX_EAD_LEN_1024"
"feature = max_connid_encoded_len_24" = "_MAX_CONNID_ENCODED_LEN_24"

[export]
include = [
    "EdhocMessageBuffer", "BytesMac", "BytesMac2",
    "EADBuffer",
    "EADItemC", "EadItemsC",
    "EdhocBuffer", "BufferKid", "BufferCred", "BufferIdCred",
    "CredentialKey", "CredentialType", "IdCred",
    "CredentialTransfer",
    "InitiatorStart", "WaitM2", "Completed", "ProcessedM2", "WaitM4",
    "EdhocInitiatorC", "EdhocInitiatorWaitM2C", "EdhocInitiatorProcessingM2C", "EdhocInitiatorProcessedM2C", "EdhocInitiatorDoneC",
]
