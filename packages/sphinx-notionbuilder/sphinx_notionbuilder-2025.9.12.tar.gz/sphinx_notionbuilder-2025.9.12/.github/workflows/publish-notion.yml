---
name: Publish documentation to Notion

on:
  push:
    branches: [main]

jobs:
  publish:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v5

      - name: Install uv
        uses: astral-sh/setup-uv@v6

      - name: Build documentation
        run: |
          rm -rf ./build-sample
          uv run sphinx-build -W -b notion sample ./build-sample

      - name: Publish to Notion
        run: |
          uv run --all-extras notion-upload \
            --parent-page-id "${{ vars.NOTION_SAMPLE_PAGE_ID }}" \
            --file "./build-sample/index.json" \
            --title "Sphinx-Notionbuilder Sample"
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
