.Dd September 12 2025
.Dt PUFFMATIC-NET 1
.Os
.Sh NAME
.Nm puffmatic-net
.Nd create OpenBSD installation sets for autoinstall
.Sh SYNOPSIS
.Nm puffmatic-net
.Op Fl h
.Op Fl v
.Sh DESCRIPTION
The
.Nm
utility downloads OpenBSD installation sets from a configured mirror
and processes domain configurations for all hosts, creating
autoinstall response files, disklabel files, and site sets.
.Pp
The resulting files can be served over HTTP for network
installation. Before exposing installation files on the public
internet, please refer to
.Sx SECURITY CONSIDERATIONS
.Pp  
For additional details, please refer to
.Sx EXAMPLES.
.Pp
Options:
.Bl -tag -width Ds
.It Fl h
Display help and exit
.It Fl v
Enable verbose mode
.El

.Sh EXIT STATUS
The
.Nm
exits with the following status:
.Bl -tag -width Ds -offset indent -compact
.It Li 0
Success
.It Li >0
An error occured.
.El
.Sh EXAMPLES
Puffmatic ships with example domain configuration
.Em example.com .
The example contains configuration files and templates required to
generate complete installable file sets for 2 hosts. Copy that
directory into your
.Pa $HOME
first.

Then, to generate site sets, enter the directory
.Pa $HOME/example.com
and run the script:

.Bd -literal -offset indent
$ cd ~/example.com
$ puffmatic-net -v
.Ed

The output files will be placed in
.Pa example.com/output/resp
and
.Pa example.com/output/sets ,
by default.

Additionally,
.Pa example.com/httpd
contains example configuration for serving those files using
.Xr httpd 8 .

.Sh DIAGNOSTICS
.Pp
Since puffmatic is written in Python, thereof any fatal error is
likely to produce a detailed stack trace.
.Pp
Additional diangostic output will be reported to stdout when suitable.
.Sh SEE ALSO
.Xr httpd 8
.Xr mount_mfs 8
.Xr mtree 8
.Xr puffmatic-usb 1
.Sh AUTHORS
.Nm
has been implemented by
.An Chris Narkiewicz Aq Mt hello@ezaquarii.com
.Sh CAVEATS
.Pp
This tool requires privileged access to execute the
.Xr mount 8
and
.Xr umount 8
commands, which are essential for mounting the mfs filesystem in
noperm mode to create site archives.
.Pp  
The initial synchronization with the mirror may take considerable
amount of time, as the script needs to download the complete file set
from the mirror server. This process might create the impression that
the script is unresponsive. However, subsequent executions will
utilize these already downloaded files.
.Sh BUGS
To report a bug, please visit \fIhttps://github.com/ezaquarii/puffmatic/\fR.
.Sh SECURITY CONSIDERATIONS
.Pp  
The resulting files are designed for HTTP delivery, facilitating
(semi-)automatic installation on VPS hosting via the internet. Therefore,
users must protect the files on the server from unauthorized access.
.Pp  
The configuration includes support for basic authentication and a
.Qq secret path  
method to secure archive files.
.Pp  
Response files can be secured using basic authentication and TLS.
.Pp  
While set archives can be secured by TLS, the installer does not
support basic authentication. These files may be stored in a
.Qq secret directory
(path), which will remain accessible only to the installer having
prior access to the (protected) response file.
