"use strict";(self.webpackChunk_calliope_jupyter_ai_core=self.webpackChunk_calliope_jupyter_ai_core||[]).push([[288,983],{277:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)((0,a.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},316:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)((0,a.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check")},369:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=n(4182)},557:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)((0,a.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1z"}),"Lock")},1070:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)((0,a.jsx)("path",{d:"M6 6h12v12H6z"}),"Stop")},1434:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)((0,a.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit")},3360:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)((0,a.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel")},4043:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)((0,a.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutline")},4079:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(4636),o=n(2672);const a=(0,n(6310).A)("MuiBox",["root"]),i=(0,o.A)({defaultClassName:a.root,generateClassName:r.A.generate})},4087:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)((0,a.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings")},4729:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)((0,a.jsx)("path",{d:"M20 19.59V8l-6-6H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c.45 0 .85-.15 1.19-.4l-4.43-4.43c-.8.52-1.74.83-2.76.83-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5c0 1.02-.31 1.96-.83 2.75zM9 13c0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3-3 1.34-3 3"}),"FindInPage")},4811:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)((0,a.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},4983:(e,t,n)=>{n.r(t),n.d(t,{CommandIDs:()=>Te,IJaiCompletionProvider:()=>k,IJaiStatusItem:()=>S,IJaiTelemetryHandler:()=>I,TelemetryContextProvider:()=>Le,default:()=>ze,useTelemetry:()=>je});var r=n(521),o=n(2127),a=n(1436),i=n(2043),s=n(5256),l=n(3345),c=n.n(l),d=n(4729);const u="@jupyter-ai/core:file-command-provider";class m{constructor(e,t){this.id=u,this._regex=/@file:(([\w/\-_.@]|\\ )+)/g,this._contentsManager=e,this._docRegistry=t}async listCommandCompletions(e){const t=e.currentWord;if(!t||!t.startsWith("@"))return[];if(t.startsWith("@file:")){const e=t.split("@file:")[1],n=await async function(e,t,n){const[r,o]=function(e){const t=e.split("/");let n,r;return 1===t.length?(n="",r=t[0]):(n=t.slice(0,-1).join("/")+"/",r=t[t.length-1]??""),[n,r]}(n),a=await e.get(r.replaceAll("\\ "," ")),i=[];if(!Array.isArray(a.content))return[];const s=a.content.filter(e=>e.name.toLowerCase().startsWith(o.toLowerCase())).sort((e,t)=>{const n=("directory"===e.type?-1:1)-("directory"===t.type?-1:1),r=e.name<t.name?-1:1;return n||r});for(const e of s){const{icon:n}=t.getFileTypeForModel(e);let o,a="@file:"+r+e.name;a=a.replaceAll(/(?<!\\) /g,"\\ "),o="directory"===e.type?{name:e.name+"/",providerId:u,icon:n,description:"Search this directory",replaceWith:a+"/"}:{name:e.name,providerId:u,icon:n,description:"Attach this file",replaceWith:a,spaceOnAccept:!0},i.push(o)}return i}(this._contentsManager,this._docRegistry,e);return n}return"@file".startsWith(t)?[{name:"@file:",providerId:this.id,description:"Include a file with your prompt",icon:c().createElement(d.A,null)}]:[]}async onSubmit(e){const t=Array.from(e.value.matchAll(this._regex)),n=[];for(const e of t)e.length<2||n.push(e[1]);for(let t of n)t=t.replaceAll("\\ "," "),e.addAttachment?.({type:"file",value:t});e.value=e.value.replaceAll(this._regex,(e,t)=>`\`${t.replaceAll("\\ "," ")}\``)}}const p={id:"@jupyter-ai/core:file-command-plugin",description:"Adds support for the @file command in Jupyter AI.",autoStart:!0,requires:[o.IChatCommandRegistry],activate:(e,t)=>{const{serviceManager:n,docRegistry:r}=e;t.addProvider(new m(n.contents,r))}};var h=n(9907);class g{constructor(){this.id="@jupyter-ai/core:slash-command-provider",this._regex=/\/([\w-]*)/g,this._slash_commands=[{name:"/refresh-personas",providerId:this.id,description:"Refresh available personas",icon:c().createElement(h.A,null),spaceOnAccept:!0}]}async listCommandCompletions(e){const t=function(e){let t=0;for(;t<e.length&&/\s/.test(e[t]);)t++;let n=t;for(;n<e.length&&!/\s/.test(e[n]);)n++;return e.substring(t,n)||null}(e.value);return e.currentWord!==t?[]:t&&t.startsWith("/")?this._slash_commands.filter(e=>e.name.startsWith(t)):[]}async onSubmit(e){}}const f=[p,{id:"@jupyter-ai/core:slash-command-plugin",description:"Adds support for slash commands in Jupyter AI.",autoStart:!0,requires:[o.IChatCommandRegistry],activate:(e,t)=>{t.addProvider(new g)}}];var y=n(7630),v=n(5010),C=n(7245),b=n(6835),w=n(306),x=n(9980),E=n(7262);const S=new E.Token("jupyter_ai:IJupyternautStatus","Status indicator displayed in the statusbar"),k=new E.Token("jupyter_ai:IJaiCompletionProvider","The jupyter-ai inline completion provider API"),I=new E.Token("jupyter_ai:telemetry","An optional plugin that handles telemetry events emitted via interactions on agent messages, when provided by a separate labextension. Not provided by default.");var A=n(4602),M=n(3760);const _=new M.LabIcon({name:"jupyter-ai::chat",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px">\n  <g class="jp-icon3" fill="#616161">\n    <path d="M0 0h24v24H0V0z" fill="none"/>\n    <path d="M15 4v7H5.17L4 12.17V4h11m1-2H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm5 4h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1z"/>\n  </g>\n</svg>\n'}),P=new M.LabIcon({name:"jupyter-ai::jupyternaut",svgstr:'<svg viewBox="0 0 38 38" fill="none"\n    xmlns="http://www.w3.org/2000/svg">\n    <g>\n        <circle cx="19" cy="19" r="19" fill="#F37726" />\n        <path fill-rule="evenodd" clip-rule="evenodd"\n            d="M19.9483 6.83653C20.5827 6.6205 21.0391 6.0196 21.0391 5.31212C21.0391 4.42296 20.3183 3.70215 19.4291 3.70215C18.5399 3.70215 17.8191 4.42296 17.8191 5.31212C17.8191 6.01951 18.2753 6.62033 18.9096 6.83644V8.00387H18.3702C12.0844 8.00387 6.97151 13.1171 6.97151 19.4026C6.97151 25.6885 12.0848 30.8013 18.3702 30.8013H19.7682C26.0541 30.8013 31.167 25.6881 31.167 19.4026C31.167 13.1773 26.1511 8.10183 19.9483 8.00527V6.83653ZM18.3702 29H19.7682C25.1351 29 29.4985 24.0213 29.4985 20.6545C29.4985 15.2876 25.1351 10.9242 19.7682 10.9242H18.3702C13.0034 10.9242 8.64 15.2876 8.64 20.6545C8.64 24.0213 13.0034 29 18.3702 29ZM32.8926 23.997C33.6267 23.997 33.6301 23.4847 33.6348 22.7562V22.7562V22.7562V22.7561C33.636 22.5714 33.6373 22.3728 33.6506 22.1651C33.7079 21.3027 33.7245 20.4643 33.7079 19.6759L33.7046 19.5569C33.6673 18.2251 33.661 17.999 32.3999 17.7511L32.252 17.7265L32.2535 17.776C32.2611 18.0225 32.2686 18.269 32.2686 18.515C32.2686 20.3168 31.9974 22.0628 31.4956 23.704C31.3593 24.1499 31.8389 24.5669 32.249 24.3451L32.8926 23.997ZM5.28037 23.997C4.54628 23.997 4.54296 23.4847 4.53822 22.7563C4.53702 22.5715 4.53573 22.3729 4.52241 22.1651C4.46511 21.3027 4.44849 20.4644 4.4651 19.6759L4.46846 19.557C4.50567 18.2251 4.51198 17.9991 5.77316 17.7512L5.921 17.7265L5.91949 17.776L5.91949 17.776C5.91193 18.0225 5.90438 18.269 5.90438 18.515C5.90438 20.3169 6.17557 22.0628 6.67738 23.704C6.81372 24.1499 6.33412 24.5669 5.92398 24.3451L5.28037 23.997ZM19.5225 11.9922C14.8928 11.9922 11.0449 14.9283 10.0641 18.7499C9.93031 19.2711 10.6154 19.4434 10.9411 19.0152C12.324 17.1972 14.0829 16.8622 15.6479 16.5641C17.7622 16.1614 19.5225 15.8262 19.5225 11.9922Z"\n            fill="white" />\n    </g>\n</svg>\n'}),j=(new M.LabIcon({name:"jupyter-ai::replace-cell",svgstr:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path fill-rule="evenodd" clip-rule="evenodd"\n        d="M12 4.71429V7H1.71429V4.71429H12ZM12.5714 3C13.2026 3 13.7143 3.51168 13.7143 4.14286V7.57143C13.7143 8.20263 13.2026 8.71429 12.5714 8.71429H1.14286C0.51168 8.71429 0 8.20263 0 7.57143V4.14286C0 3.51168 0.511669 3 1.14286 3H12.5714Z"\n        fill="#565656" />\n    <path fill-rule="evenodd" clip-rule="evenodd"\n        d="M14 8.71429V11H3.71429V8.71429H14ZM14.5714 7C15.2026 7 15.7143 7.51168 15.7143 8.14286V11.5714C15.7143 12.2026 15.2026 12.7143 14.5714 12.7143H3.14286C2.51168 12.7143 2 12.2026 2 11.5714V8.14286C2 7.51168 2.51167 7 3.14286 7H14.5714Z"\n        fill="#565656" />\n</svg>\n'}),new M.LabIcon({name:"jupyter-ai::include-selection",svgstr:'<svg width="18" height="9" viewBox="0 0 18 9" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path fill-rule="evenodd" clip-rule="evenodd"\n        d="M-0.0018417 1.33824L0.837379 0.499023L1.35717 1.01871C1.35741 1.01862 1.35764 1.01853 1.35787 1.01845L3.411 3.07158H3.41049L4.83909 4.49987L3.41011 5.92872H3.41075L1.35769 7.98178C1.35749 7.98171 1.35729 7.98164 1.35709 7.98156L0.837023 8.50158L-0.00219727 7.66236L3.1547 4.49987L-0.0018417 1.33824ZM2.6821 8.07158H16.143C16.932 8.07158 17.5716 7.43201 17.5716 6.64301V2.35729C17.5716 1.56832 16.932 0.928721 16.143 0.928721H2.68236L4.82522 3.07158H15.4287V5.92872H4.82496L2.6821 8.07158ZM1.74238 4.50002L0.428719 5.81655V3.18349L1.74238 4.50002Z"\n        fill="#757575" />\n</svg>\n'}),P.react);function L(e){return"ipythongfm"===e.name?"Markdown (IPython)":"ipython"===e.name?"IPython":e.displayName??e.name}class T{constructor(e){this.options=e,this.identifier=T.ID,this.icon=P.bindprops({width:16,top:1}),this._settings=T.DEFAULT_SETTINGS,this._settingsChanged=new A.Signal(this),this._streamPromises=new Map,this._counter=0,e.completionHandler.streamed.connect(this._receiveStreamChunk,this)}get name(){return"JupyterAI"}async fetch(e,t){const n=this._settings.triggerKind,r=t.triggerKind;if("manual"===n&&r!==y.InlineCompletionTriggerKind.Invoke)return{items:[]};const o=e.mimeType??"text/plain",i=this.options.languageRegistry.findByMIME(o);if(!i)return console.warn(`Could not recognise language for ${o} - cannot complete`),{items:[]};if(!this.isLanguageEnabled(i?.name))return{items:[]};let s,l=t.session?.path;if(t.widget instanceof x.NotebookPanel){const e=t.widget.content.activeCell;e&&(s=e.model.id)}!l&&t.widget instanceof b.DocumentWidget&&(l=t.widget.context.path);const c=++this._counter,d=this._settings.streaming,u="always"===d||"never"!==d&&t.triggerKind===y.InlineCompletionTriggerKind.Invoke;u&&this._streamPromises.clear();const m=await this.options.completionHandler.sendMessage({path:l,mime:o,prefix:this._prefixFromRequest(e),suffix:this._suffixFromRequest(e),language:this._resolveLanguage(i),number:c,stream:u,cell_id:s}),p=m.error;return p?(a.Notification.emit(`Inline completion failed: ${p.type}`,"error",{autoClose:!1,actions:[{label:"Show Traceback",callback:()=>{(0,a.showErrorMessage)("Inline completion failed on the server side",{message:`${p.title}\n${p.traceback}`})}}]}),{items:[{error:{message:p.title},insertText:""}]}):m.list}async*stream(e){let t=!1;for(;!t;){const n=new E.PromiseDelegate;this._streamPromises.set(e,n);const r=n.promise;yield r,t=(await r).done}}get schema(){return{properties:{triggerKind:{title:"Inline completions trigger",type:"string",oneOf:[{const:"any",title:"Automatic (on typing or invocation)"},{const:"manual",title:"Only when invoked manually"}],description:"When to trigger inline completions when using jupyter-ai."},maxPrefix:{title:"Maximum prefix length",minimum:1,type:"number",description:"At most how many prefix characters should be provided to the model."},maxSuffix:{title:"Maximum suffix length",minimum:0,type:"number",description:"At most how many suffix characters should be provided to the model."},disabledLanguages:{title:"Disabled languages",type:"array",items:{type:"string",oneOf:this.options.languageRegistry.getLanguages().map(e=>({const:e.name,title:L(e)}))},description:"Languages for which the completions should not be shown."},streaming:{title:"Streaming",type:"string",oneOf:[{const:"always",title:"Always"},{const:"manual",title:"When invoked manually"},{const:"never",title:"Never"}],description:"Whether to show suggestions as they are generated"}},default:T.DEFAULT_SETTINGS}}async configure(e){this._settings=e,this._settingsChanged.emit()}isEnabled(){return this._settings.enabled}isLanguageEnabled(e){return!this._settings.disabledLanguages.includes(e)}get settingsChanged(){return this._settingsChanged}_receiveStreamChunk(e,t){const n=t.response.token;if(!n)throw Error("Stream chunks must return define `token` in `response`");const r=this._streamPromises.get(n);r?(r.resolve(t),t.done&&this._streamPromises.delete(n)):console.warn("Unhandled stream chunk")}_prefixFromRequest(e){const t=e.text.slice(0,e.offset);return t.slice(-Math.min(this._settings.maxPrefix,t.length))}_suffixFromRequest(e){const t=e.text.slice(e.offset);return t.slice(0,Math.min(this._settings.maxPrefix,t.length))}_resolveLanguage(e){return e?"ipython"===e.name?"python":"ipythongfm"===e.name?"markdown":e.name:"plain English"}}!function(e){e.ID="@jupyterlab/jupyter-ai",e.DEFAULT_SETTINGS={triggerKind:"any",maxPrefix:1e4,maxSuffix:1e4,debouncerDelay:250,enabled:!1,disabledLanguages:["ipythongfm"],streaming:"manual"}}(T||(T={}));var z,B=n(3566),F=n(8397);class D{constructor(e={}){this._replyForResolver={},this._isDisposed=!1,this._socket=null,this._streamed=new A.Signal(this),this._initialized=new E.PromiseDelegate,this.serverSettings=e.serverSettings??B.ServerConnection.makeSettings()}async initialize(){await this._initialize()}sendMessage(e){return new Promise(t=>{this._socket?.send(JSON.stringify(e)),this._replyForResolver[e.number]=t})}get streamed(){return this._streamed}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed)return;this._isDisposed=!0;const e=this._socket;e&&(this._socket=null,e.onopen=()=>{},e.onerror=()=>{},e.onmessage=()=>{},e.onclose=()=>{},e.close())}_onMessage(e){switch(e.type){case"connection":this._initialized.resolve();break;case"stream":this._streamed.emit(e);break;default:e.reply_to in this._replyForResolver?(this._replyForResolver[e.reply_to](e),delete this._replyForResolver[e.reply_to]):console.warn("Unhandled message",e)}}_onClose(e,t){if(t(new Error("Inline completion websocket disconnected")),console.error("Inline completion websocket disconnected"),1006===e.code){const e=1;console.info(`Will try to reconnect in ${e} s.`),setTimeout(async()=>await this._initialize(),1e3*e)}}async _initialize(){if(this.isDisposed)return;const e=new E.PromiseDelegate;this._initialized=e,console.log("Creating a new websocket connection for inline completions...");const{token:t,WebSocket:n,wsUrl:r}=this.serverSettings,o=F.URLExt.join(r,"api/ai/completion/inline")+(t?`?token=${encodeURIComponent(t)}`:""),a=this._socket=new n(o);a.onclose=t=>this._onClose(t,e.reject.bind(e)),a.onerror=t=>e.reject(t),a.onmessage=e=>e.data&&this._onMessage(JSON.parse(e.data))}}!function(e){e.toggleCompletions="jupyter-ai:toggle-completions",e.toggleLanguageCompletions="jupyter-ai:toggle-language-completions"}(z||(z={}));const R={id:"@jupyter-ai/core:inline-completions",autoStart:!0,requires:[y.ICompletionProviderManager,C.IEditorLanguageRegistry,v.ISettingRegistry],optional:[S],provides:k,activate:async(e,t,n,r,o)=>{if(void 0===t.registerInlineProvider)return console.warn("Inline completions are only supported in JupyterLab 4.1+ and Jupyter Notebook 7.1+"),null;const a=new D,i=new T({completionHandler:a,languageRegistry:n});await a.initialize(),t.registerInlineProvider(i);const s=()=>{const t=function(e){if(!(e instanceof b.DocumentWidget))return null;let t;const{content:n}=e;return n instanceof w.FileEditor?t=n.editor:n instanceof x.Notebook&&(t=n.activeCell?.editor),t instanceof C.CodeMirrorEditor?t:void 0}(e.shell.currentWidget);return t?n.findByMIME(t.model.mimeType):null};async function l(){return await r.load("@jupyterlab/completer-extension:inline-completer")}async function c(){return(await l()).composite.providers[T.ID]}async function d(e){const t=await l(),n=t.user.providers,r={...n,[T.ID]:{...n?.[T.ID],...e}};t.set("providers",r)}return e.commands.addCommand(z.toggleCompletions,{execute:async()=>{d({enabled:!(await c()).enabled})},label:"Enable completions by Jupyternaut",isToggled:()=>i.isEnabled()}),e.commands.addCommand(z.toggleLanguageCompletions,{execute:async()=>{const e=await c(),t=s();if(!t)return;const n=[...e.disabledLanguages];d({disabledLanguages:n.includes(t.name)?n.filter(e=>e!==t.name):n.concat(t.name)})},label:()=>{const e=s();return e?`Disable completions in ${L(e)}`:"Disable completions in <language> files"},isToggled:()=>{const e=s();return!!e&&!i.isLanguageEnabled(e.name)},isVisible:()=>!!s(),isEnabled:()=>!!s()&&i.isEnabled()}),o&&(o.addItem({command:z.toggleCompletions,rank:1}),o.addItem({command:z.toggleLanguageCompletions,rank:2})),i}};var H,V=n(1070);async function N(e="",t={}){const n=B.ServerConnection.makeSettings(),r=F.URLExt.join(n.baseUrl,"api/ai",e);let o;try{o=await B.ServerConnection.makeRequest(r,t,n)}catch(e){throw new B.ServerConnection.NetworkError(e)}let a=await o.text();if(a.length>0)try{a=JSON.parse(a)}catch{console.log("Not a JSON response body.",o)}if(!o.ok)throw new B.ServerConnection.ResponseError(o,a.message||a);return a}function O(e){const{message:t,model:n}=e,[r,a]=(0,l.useState)(!1),i="Stop streaming";return(0,l.useEffect)(()=>{const e=(e,n)=>{n.filter(e=>e.messageID===t.id).length>0?a(!0):a(!1)};return t.sender.username!==n.user?.username&&t.sender.bot&&(n.writersChanged?.connect(e),e(0,n.writers)),()=>{n.writersChanged?.disconnect(e)}},[n]),r?c().createElement(o.TooltippedButton,{onClick:()=>{N("chats/stop_streaming",{method:"POST",body:JSON.stringify({message_id:t.id}),headers:{"Content-Type":"application/json"}})},tooltip:i,buttonProps:{size:"small",variant:"contained",title:i},sx:{display:r?"inline-flex":"none"}},c().createElement(V.A,null)):c().createElement(c().Fragment,null)}!function(e){async function t(e){return N("config",{method:"POST",body:JSON.stringify(e)})}async function n(e){return N("secrets/",{method:"PUT",body:JSON.stringify({updated_secrets:e})})}e.getConfig=async function(){return N("config")},e.listLmProviders=async function(){return N("providers")},e.listEmProviders=async function(){return N("providers/embeddings")},e.updateConfig=t,e.listSecrets=async function(){return N("secrets/",{method:"GET"})},e.updateSecrets=n,e.deleteSecret=async function(e){return n({[e]:null})},e.listChatModels=async function(){return(await N("models/chat/",{method:"GET"})).chat_models},e.getChatModel=async function(){return(await N("config/")).model_provider_id},e.updateChatModel=async function(e){return await t({model_provider_id:e})},e.getCompletionModel=async function(){return(await N("config/")).completions_model_provider_id},e.updateCompletionModel=async function(e){return await t({completions_model_provider_id:e})},e.getModelParameters=async function(e,t){const n=new URLSearchParams;e&&n.append("model",e),t&&n.append("provider",t);const r="model-parameters"+(n.toString()?`?${n.toString()}`:"");return await N(r)},e.saveModelParameters=async function(e,t){return await N("model-parameters",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({model_id:e,parameters:t})})}}(H||(H={}));var $=n(86);class J extends M.VDomRenderer{constructor(e){super(new M.VDomModel),this._handleClick=()=>{this._popup&&this._popup.dispose(),this._menu&&this._menu.dispose(),this._menu=new M.RankedMenu({commands:this._commandRegistry,renderer:M.MenuSvg.defaultRenderer});for(const e of this._items)this._menu.addItem(e);this._popup=(0,$.showPopup)({body:this._menu,anchor:this,align:"left"})},this._menu=null,this._popup=null,this._commandRegistry=e.commandRegistry,this._items=[],this.addClass("jp-mod-highlighted"),this.title.caption="Open Jupyternaut status menu",this.node.addEventListener("click",this._handleClick)}addItem(e){this._items.push(e)}hasItems(){return 0!==this._items.length}render(){return this.model?c().createElement(j,{top:"2px",width:"16px",stylesheet:"statusBar"}):null}dispose(){this.node.removeEventListener("click",this._handleClick),super.dispose()}}const W={id:"jupyter_ai:status-item",description:"Provides a status item for Jupyter AI.",autoStart:!0,optional:[$.IStatusBar],provides:S,activate:(e,t)=>{const n=new J({commandRegistry:e.commands});return t&&t.registerStatusItem("jupyter_ai:jupyternaut-status",{item:n,align:"right",rank:100,isActive:()=>n.hasItems()}),n}};var U=n(2199),q=n(5840),Z=n(3468);function G(e){return getComputedStyle(document.body).getPropertyValue(e).trim()}function K(e){const[t,n]=(0,l.useState)((0,q.A)());return(0,l.useEffect)(()=>{async function t(){n(await async function(){await async function(){for(;!document.body.hasAttribute("data-jp-theme-light");)await new Promise(e=>setTimeout(e,100))}();const e=document.body.getAttribute("data-jp-theme-light");return(0,q.A)({spacing:4,components:{MuiButton:{defaultProps:{size:"small"}},MuiFilledInput:{defaultProps:{margin:"dense"}},MuiFormControl:{defaultProps:{margin:"dense",size:"small"}},MuiFormHelperText:{defaultProps:{margin:"dense"}},MuiIconButton:{defaultProps:{size:"small"}},MuiInputBase:{defaultProps:{margin:"dense",size:"small"}},MuiInputLabel:{defaultProps:{margin:"dense"}},MuiListItem:{defaultProps:{dense:!0}},MuiOutlinedInput:{defaultProps:{margin:"dense"}},MuiFab:{defaultProps:{size:"small"}},MuiTable:{defaultProps:{size:"small"}},MuiTextField:{defaultProps:{margin:"dense",size:"small"}},MuiToolbar:{defaultProps:{variant:"dense"}}},palette:{background:{paper:G("--jp-layout-color1"),default:G("--jp-layout-color1")},mode:"true"===e?"light":"dark",primary:{main:G("--jp-brand-color1"),light:G("--jp-brand-color2"),dark:G("--jp-brand-color0")},error:{main:G("--jp-error-color1"),light:G("--jp-error-color2"),dark:G("--jp-error-color0")},warning:{main:G("--jp-warn-color1"),light:G("--jp-warn-color2"),dark:G("--jp-warn-color0")},success:{main:G("--jp-success-color1"),light:G("--jp-success-color2"),dark:G("--jp-success-color0")},text:{primary:G("--jp-ui-font-color1"),secondary:G("--jp-ui-font-color2"),disabled:G("--jp-ui-font-color3")}},shape:{borderRadius:2},typography:{fontFamily:G("--jp-ui-font-family"),fontSize:12,htmlFontSize:16,button:{textTransform:"capitalize"}}})}())}t(),e.themeManager?.themeChanged.connect(t)},[]),c().createElement(Z.A,{theme:t},e.children)}var Y=n(4079),X=n(4087),Q=n(7641);function ee(){const[e,t]=(0,l.useState)(null),[n,r]=(0,l.useState)(""),[o,a]=(0,l.useState)(0),[i,s]=(0,l.useState)(!1),[d,u]=(0,l.useState)(),[m,p]=(0,l.useState)();return{show:(0,l.useCallback)((o,i)=>{const l=i.toString();o!==e||l!==n?(null===e&&u(new Promise(e=>{p(()=>e)})),t(o),r(l),a(0),s(!0)):a(e=>e+1)},[n,e]),jsx:(0,l.useMemo)(()=>c().createElement(U.Collapse,{in:i,onExited:()=>{m?.(),t(null),r(""),a(0)},timeout:200},null!==e&&c().createElement(U.Alert,{severity:e},n+(o?` (${o})`:""))),[n,o,e,i,m]),clear:(0,l.useCallback)(()=>(s(!1),d),[i,d])}}var te=n(7135),ne=n(9193),re=n(5173);const oe=(0,ne.Ay)(U.Popper)(({theme:e})=>({zIndex:e.zIndex.modal,"& .MuiPaper-root":{maxHeight:"200px",overflow:"auto",border:`1px solid ${e.palette.divider}`,boxShadow:e.shadows[8]}}));function ae(e,t,n=!1){if(t.trim().length<=1)return e;const r=n?t:t.toLowerCase();return e.filter(e=>(n?e.label:e.label.toLowerCase()).includes(r))}function ie(e){const[t,n]=(0,l.useState)(e.value||""),[r,o]=(0,l.useState)(!1),[a,i]=(0,l.useState)(-1),s=(0,l.useRef)(null),d=(0,l.useRef)(null),u=(0,l.useMemo)(()=>(e.optionsFilter||ae)(e.options,t,e.caseSensitive).slice(0,e.maxOptions??e.options.length),[e.options,t,e.optionsFilter,e.maxOptions,e.caseSensitive]);(0,l.useEffect)(()=>{n(e.value||"")},[e.value]);const m=r&&u.length>0,p=(0,l.useCallback)(t=>{const a=t.target.value;n(a),i(-1),r||""===a.trim()||o(!0),e.onChange&&e.onChange(a)},[r,e.onChange]),h=(0,l.useCallback)(()=>{o(!0)},[]),g=(0,l.useCallback)(t=>{n(t.value),o(!1),i(-1),e.onChange&&e.onChange(t.value),d.current&&d.current.blur()},[e.onChange]),f=(0,l.useCallback)(e=>{if(m)switch(e.key){case"ArrowDown":e.preventDefault(),i(e=>e<u.length-1?e+1:0);break;case"ArrowUp":e.preventDefault(),i(e=>e>0?e-1:u.length-1);break;case"Enter":e.preventDefault(),a>=0&&a<u.length&&g(u[a]);break;case"Escape":o(!1),i(-1)}},[m,u,a,g]),y=(0,l.useCallback)(()=>{o(!1),i(-1)},[]);return c().createElement(U.ClickAwayListener,{onClickAway:y},c().createElement("div",{style:{position:"relative",width:"100%"}},c().createElement(U.TextField,{...e.textFieldProps,ref:s,inputRef:d,value:t,onChange:p,onFocus:h,onKeyDown:f,placeholder:e.placeholder,fullWidth:!0,InputProps:{...e.textFieldProps?.InputProps,endAdornment:e.showClearButton&&t?c().createElement(U.InputAdornment,{position:"end"},c().createElement(U.IconButton,{"aria-label":"clear input",onClick:()=>{n(""),e.onChange&&e.onChange(""),d.current&&d.current.focus()},edge:"end",size:"small"},c().createElement(re.A,null))):e.textFieldProps?.InputProps?.endAdornment}}),c().createElement(oe,{open:m,anchorEl:s.current,placement:"bottom-start",style:{width:s.current?.offsetWidth}},c().createElement(U.Paper,null,u.map((n,r)=>{const o=e.boldMatches?function(e,t,n=!1){if(t.trim().length<=1)return e;const r=n?t:t.toLowerCase(),o=n?e:e.toLowerCase(),a=[];let i=0,s=o.indexOf(r);for(;-1!==s;)s>i&&a.push(e.slice(i,s)),a.push(c().createElement("strong",{key:`${s}-${r}`},e.slice(s,s+r.length))),i=s+r.length,s=o.indexOf(r,i);return i<e.length&&a.push(e.slice(i)),a.length>0?c().createElement(c().Fragment,null,a):e}(n.label,t,e.caseSensitive):n.label;return c().createElement(U.MenuItem,{key:`${n.value}-${r}`,selected:r===a,onClick:()=>{g(n)},sx:{"&.Mui-selected":{backgroundColor:"action.hover"},"&.Mui-selected:hover":{backgroundColor:"action.selected"}}},o)})))))}function se(e){const[t,n]=(0,l.useState)([]),[r,o]=(0,l.useState)(!0),[a,i]=(0,l.useState)(!1),[s,d]=(0,l.useState)(""),u=ee();(0,l.useEffect)(()=>{!async function(){try{let t,r;if("chat"===e.modality)[t,r]=await Promise.all([H.listChatModels(),H.getChatModel()]);else{if("completion"!==e.modality)throw new Error(`Unrecognized model modality '${e.modality}'.`);[t,r]=await Promise.all([H.listChatModels(),H.getCompletionModel()])}n(t),d(r??""),e.onModelIdFetch?.(r,!0)}catch(e){console.error("Failed to load chat models:",e),n([])}finally{o(!1)}}()},[]);const m=(0,l.useMemo)(()=>t.map(e=>({label:e,value:e})),[t]);return c().createElement(U.Box,{sx:{display:"flex",flexDirection:"column",gap:2}},c().createElement(ie,{options:m,value:s,onChange:d,placeholder:e.placeholder,boldMatches:!0,showClearButton:!0}),c().createElement(U.Button,{variant:"contained",onClick:async()=>{i(!0);try{const t=s.trim()||null;if("chat"===e.modality)await H.updateChatModel(t);else{if("completion"!==e.modality)throw new Error(`Unrecognized model modality '${e.modality}'.`);await H.updateCompletionModel(t)}e.onModelIdFetch?.(t,!1),u.show("success",t?`Successfully updated ${e.modality} model to '${s.trim()}'.`:`Successfully cleared ${e.modality} model.`)}catch(t){console.error(`Failed to update ${e.modality} model:`,t);const n=t instanceof Error?t.message:"An unknown error occurred";u.show("error",`Failed to update ${e.modality} model: ${n}`)}finally{i(!1)}},disabled:r||a,sx:{alignSelf:"center"},startIcon:c().createElement(te.A,null)},a?`Updating ${e.modality} model...`:`Update ${e.modality} model`),u.jsx)}var le=n(277);const ce=["string","integer","number","boolean","array","object"];function de(e){const[t,n]=(0,l.useState)(null),[r,o]=(0,l.useState)([]),[a,i]=(0,l.useState)(""),[s,d]=(0,l.useState)(!1),u=ee(),m=(0,l.useRef)({});(0,l.useEffect)(()=>{!async function(){if(!e.modelId)return n(null),void o([]);d(!0);try{const[t,r]=await Promise.all([H.getModelParameters(e.modelId),H.getConfig()]);n(t);const a=((e,t)=>Object.entries(e).map(([e,n])=>{const r=t?.[e],o=r?.type||(e=>"boolean"==typeof e?"boolean":"number"==typeof e?Number.isInteger(e)?"integer":"number":Array.isArray(e)?"array":"object"==typeof e&&null!==e?"object":"string")(n);return{name:e,type:o,value:String(n),isStatic:!0}}))(r.fields[e.modelId]||{},t.parameters);o(a)}catch(t){console.error("Failed to fetch parameters:",t),n(null),u.show("error",`Failed to fetch parameters for model '${e.modelId}'. You can still add custom parameters manually.`)}finally{d(!1)}}()},[e.modelId]);const p=(e,t,n)=>{o(r=>r.map((r,o)=>o===e?{...r,[t]:n,isStatic:!(!r.isStatic||"value"===t)&&r.isStatic}:r)),i(""),"type"===t&&n&&setTimeout(()=>{m.current[e]?.focus()},0)},h=r.length>0,g=e=>{const n=t?.parameters?Object.keys(t.parameters):[],o=r.filter(t=>t.name!==e&&""!==t.name.trim()).map(e=>e.name);return n.filter(e=>!o.includes(e))};return s?c().createElement(U.Box,{sx:{display:"flex",justifyContent:"center",p:3}},"Loading parameters..."):c().createElement(U.Box,null,r.map((e,n)=>c().createElement(U.Box,{key:n,sx:{display:"flex",gap:2,mb:2,alignItems:"center"}},e.isStatic?c().createElement(U.TextField,{label:"Parameter name",value:e.name,size:"small",sx:{flex:1},disabled:!0,InputProps:{readOnly:!0}}):c().createElement(U.Autocomplete,{options:g(e.name),value:e.name||null,onChange:(e,r)=>{((e,n)=>{if(!n)return;const r=t?.parameters?.[n];o(t=>t.map((t,o)=>o===e?{...t,name:n,type:r?.type||t.type,isStatic:!1}:t)),i("")})(n,r)},freeSolo:!0,size:"small",sx:{flex:1},renderInput:e=>c().createElement(U.TextField,{...e,label:"Parameter name",placeholder:"Select or type parameter name"}),getOptionLabel:e=>"string"==typeof e?e:"",renderOption:(e,n)=>{const r=t?.parameters?.[n];return c().createElement(U.Box,{component:"li",...e,title:r?.description},c().createElement(U.Box,null,c().createElement(U.Box,{sx:{fontWeight:"medium"}},n),r&&c().createElement(U.Box,{sx:{fontSize:"0.75rem",color:"text.secondary"}},r.type," ",r.description&&`- ${r.description.slice(0,50)}${r.description.length>50?"...":""}`)))}}),c().createElement(U.FormControl,{size:"small",sx:{flex:1},disabled:e.isStatic},c().createElement(U.InputLabel,null,"Parameter type"),c().createElement(U.Select,{value:e.type,label:"Parameter type",onChange:e=>p(n,"type",e.target.value),disabled:e.isStatic},ce.map(e=>c().createElement(U.MenuItem,{key:e,value:e},e)))),c().createElement(U.TextField,{label:"Argument value",placeholder:"e.g. 0.7, https://localhost:8989",value:e.value,onChange:e=>p(n,"value",e.target.value),size:"small",sx:{flex:1},inputRef:e=>{m.current[n]=e}}),c().createElement(U.IconButton,{onClick:()=>(e=>{o(t=>t.filter((t,n)=>n!==e)),i("")})(n),color:"error",size:"small",sx:{ml:1}},c().createElement(le.A,null)))),a&&c().createElement(U.Alert,{severity:"error",sx:{mb:2}},a),c().createElement(U.Button,{variant:"outlined",onClick:()=>{o([...r,{name:"",type:"",value:"",isStatic:!1}]),i("")},sx:{m:3}},"Add a custom model parameter"),h&&c().createElement(U.Button,{variant:"contained",onClick:async()=>{if(r.filter(e=>""!==e.value.trim()&&!e.isStatic&&(""===e.name.trim()||""===e.type.trim())).length>0)return void i("Parameter value specified but name or type is missing");if(!e.modelId)return void i("No model selected");if(r.filter(e=>""===e.value.trim()).length>0)return void u.show("error","All parameters must have argument values. Use the delete button to remove unwanted parameters.");if(r.some(e=>{if("boolean"===e.type.toLowerCase()){const t=e.value.toLowerCase().trim();return"true"!==t&&"false"!==t}return!1}))return void i('Boolean parameters must have value "true" or "false"');const t=r.reduce((e,t)=>(e[t.name]={value:t.value,type:t.type},e),{});try{await H.saveModelParameters(e.modelId,t),i(""),u.show("success",`Successfully saved parameters for model '${e.modelId}'.`)}catch(e){const t=e instanceof Error?e.message:"An unknown error occurred";u.show("error",`Failed to save model parameters: ${t}`),i("Failed to save parameters. Please try again.")}},sx:{alignSelf:"center"},startIcon:c().createElement(te.A,null)},"Save Model Parameters"),u.jsx)}var ue=n(1434),me=n(4043),pe=n(3360),he=n(316),ge=n(5718),fe=n(6077),ye=n(4811);const ve=(0,U.styled)(({className:e,...t})=>c().createElement(U.Tooltip,{...t,arrow:!0,classes:{popper:e}}))(({theme:e})=>({[`& .${U.tooltipClasses.tooltip}`]:{backgroundColor:e.palette.common.black,color:e.palette.common.white,boxShadow:e.shadows[1],fontSize:11},[`& .${U.tooltipClasses.arrow}`]:{color:e.palette.common.black}}));function Ce(e){const[t,n]=(0,l.useState)(!1),[r,o]=(0,l.useState)(!1);return c().createElement(U.Box,{sx:{position:"relative",display:"inline-block",boxSizing:"content-box"}},c().createElement(ve,{title:"Click again to confirm",open:r,onClose:()=>o(!1),arrow:!0,placement:"top"},c().createElement(U.IconButton,{disabled:t,onClick:async function(){if(e.confirm&&!r)return void o(!0);let t=!1;try{const t=e.onClick();if("canceled"===t)return;n(!0),await t}catch(n){t=!0,n instanceof Error?e.onError(n.toString()):(console.error(n),e.onError("Unknown error occurred. Check the browser console logs."))}finally{n(!1)}t||e.onSuccess()},onMouseDown:e.onMouseDown},e.children)),t&&c().createElement(U.CircularProgress,{size:"100%",sx:{position:"absolute",top:0,left:0}}))}function be(e){const t=ee(),[n,r]=(0,l.useState)(!1);if(!e.editableSecrets)return null;const o=(0,l.useCallback)(()=>{r(!0)},[]),a=(0,l.useCallback)(()=>{r(!1)},[]),i=(0,l.useCallback)(()=>{r(!1),t.show("success","Secret added successfully."),e.reloadSecrets()},[t,e.reloadSecrets]),s=(0,l.useCallback)(e=>{t.show("error",e)},[t]);return c().createElement(U.Box,null,e.editableSecrets.length>0?c().createElement(U.Box,{sx:{"& > .MuiBox-root:not(:first-child)":{marginTop:-2}}},e.editableSecrets.map(n=>c().createElement(we,{key:n,alert:t,secret:n,reloadSecrets:e.reloadSecrets}))):c().createElement(U.Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:4,textAlign:"center",color:"text.secondary",backgroundColor:"action.hover",borderRadius:1,marginBottom:2}},c().createElement(U.Typography,{variant:"h6",sx:{marginBottom:1,fontWeight:500}},"No secrets configured"),c().createElement(U.Typography,{variant:"body2",sx:{maxWidth:400,opacity:.8}},'Click "Add secret" to add an API key and start using Jupyternaut with your preferred model provider.')),n?c().createElement(xe,{alert:t,onCancel:a,onSuccess:i,onError:s}):c().createElement(U.Button,{startIcon:c().createElement(ye.A,null),onClick:o,sx:{color:"primary.main",backgroundColor:"transparent",border:"none",padding:0,fontSize:"inherit",textTransform:"none","&:hover":{backgroundColor:"transparent",textDecoration:"underline"}}},"Add secret"),t.jsx)}function we(e){const[t,n]=(0,l.useState)(""),[r,o]=(0,l.useState)(!1),[a,i]=(0,l.useState)(!1),[s,d]=(0,l.useState)(!1),u=(0,l.useRef)();(0,l.useEffect)(()=>{s?u.current?.focus():(n(""),o(!1),i(!1))},[s]);const m=(0,l.useCallback)(()=>{d(!0)},[]),p=(0,l.useCallback)(()=>H.deleteSecret(e.secret),[]),h=(0,l.useCallback)(()=>{o(e=>!e)},[]),g=(0,l.useCallback)(()=>{d(!1)},[]),f=(0,l.useCallback)(()=>0===t.length?(u.current?.blur(),"canceled"):H.updateSecrets({[e.secret]:t}),[t]),y=(0,l.useCallback)(t=>{e.alert.show("error",t)},[e.alert]),v=(0,l.useCallback)(()=>{s&&i(!t)},[s,t]),C=(0,l.useCallback)(()=>{d(!1),e.alert.show("success","API key updated successfully."),e.reloadSecrets()},[e.alert,e.reloadSecrets]),b=(0,l.useCallback)(()=>{e.alert.show("success","API key deleted successfully."),e.reloadSecrets()},[e.alert,e.reloadSecrets]);return c().createElement(U.Box,{sx:{display:"flex",alignItems:"flex-start"}},c().createElement(U.TextField,{value:t,onChange:e=>n(e.target.value),disabled:!s,inputRef:u,onBlur:v,error:a,helperText:"Secret value must not be empty",placeholder:"Secret value",FormHelperTextProps:{sx:{visibility:a?"unset":"hidden",margin:0,whiteSpace:"nowrap"}},size:"small",variant:"standard",type:r?"text":"password",label:c().createElement(U.Typography,null,c().createElement("pre",{style:{margin:0}},e.secret)),InputProps:{endAdornment:s&&c().createElement(U.InputAdornment,{position:"end"},c().createElement(U.IconButton,{onClick:h,edge:"end",onMouseDown:e=>e.preventDefault()},r?c().createElement(fe.A,null):c().createElement(ge.A,null)))},sx:{flexGrow:1,margin:0,"& .MuiInputBase-input":{padding:0,paddingBottom:1}}}),c().createElement(U.Box,{sx:{marginTop:"11px",marginLeft:2,whiteSpace:"nowrap"}},s?c().createElement(c().Fragment,null,c().createElement(U.IconButton,{onClick:g,onMouseDown:e=>e.preventDefault()},c().createElement(pe.A,null)),c().createElement(Ce,{onClick:f,onError:y,onSuccess:C,onMouseDown:e=>e.preventDefault(),confirm:!1},c().createElement(he.A,{color:"success"}))):c().createElement(c().Fragment,null,c().createElement(U.IconButton,{onClick:m},c().createElement(ue.A,null)),c().createElement(Ce,{onClick:p,onError:y,onSuccess:b,confirm:!0},c().createElement(me.A,{color:"error"})))))}function xe(e){const[t,n]=(0,l.useState)(""),[r,o]=(0,l.useState)(""),[a,i]=(0,l.useState)(!1),[s,d]=(0,l.useState)(!1),[u,m]=(0,l.useState)(!1),p=(0,l.useRef)(),h=(0,l.useRef)();(0,l.useEffect)(()=>{p.current?.focus()},[]);const g=(0,l.useCallback)(()=>{i(e=>!e)},[]),f=(0,l.useCallback)(()=>{const e=!t.trim(),n=!r.trim();return d(e),m(n),!e&&!n},[t,r]),y=(0,l.useCallback)(()=>f()?H.updateSecrets({[t.trim()]:r.trim()}):"canceled",[t,r,f]);return c().createElement(U.Box,{sx:{display:"flex",alignItems:"flex-start",gap:2,marginTop:2}},c().createElement(U.TextField,{value:t,onChange:e=>n(e.target.value),inputRef:p,error:s,helperText:"Secret name must not be empty",placeholder:"Secret name",FormHelperTextProps:{sx:{visibility:s?"unset":"hidden",margin:0,whiteSpace:"nowrap"}},size:"small",variant:"standard",label:"Secret name",onBlur:()=>!t.trim()&&d(!0),sx:{flexGrow:1,margin:0,"& .MuiInputBase-input":{padding:0,paddingBottom:1}}}),c().createElement(U.TextField,{value:r,onChange:e=>o(e.target.value),inputRef:h,error:u,helperText:"Secret value must not be empty",placeholder:"Secret value",FormHelperTextProps:{sx:{visibility:u?"unset":"hidden",margin:0,whiteSpace:"nowrap"}},size:"small",variant:"standard",type:a?"text":"password",label:"Secret value",onBlur:()=>!r.trim()&&m(!0),InputProps:{endAdornment:c().createElement(U.InputAdornment,{position:"end"},c().createElement(U.IconButton,{onClick:g,edge:"end",onMouseDown:e=>e.preventDefault()},a?c().createElement(fe.A,null):c().createElement(ge.A,null)))},sx:{flexGrow:1,margin:0,"& .MuiInputBase-input":{padding:0,paddingBottom:1}}}),c().createElement(U.Box,{sx:{marginTop:"11px",whiteSpace:"nowrap"}},c().createElement(U.IconButton,{onClick:e.onCancel,onMouseDown:e=>e.preventDefault()},c().createElement(pe.A,null)),c().createElement(Ce,{onClick:y,onError:e.onError,onSuccess:e.onSuccess,onMouseDown:e=>e.preventDefault(),confirm:!1},c().createElement(he.A,{color:"success"}))))}var Ee=n(557);function Se(e){return e.secrets&&0!==e.secrets.length?c().createElement(U.List,{sx:{padding:0}},e.secrets.map((t,n)=>c().createElement(U.ListItem,{key:t,sx:{borderBottom:n<e.secrets.length-1?"1px solid":"none",borderBottomColor:"divider",paddingY:1.5,paddingX:2,"&:hover":{backgroundColor:"action.hover"}}},c().createElement(U.ListItemIcon,{sx:{minWidth:36}},c().createElement(Ee.A,{fontSize:"small"})),c().createElement(U.ListItemText,{primary:c().createElement(U.Box,{sx:{display:"flex",alignItems:"center",gap:1}},c().createElement(U.Typography,{variant:"body1",component:"code",sx:{fontFamily:"monospace",fontSize:"0.875rem",fontWeight:500,opacity:.618}},t))})))):null}function ke(){const[e,t]=(0,l.useState)([]),[n,r]=(0,l.useState)([]),[o,a]=(0,l.useState)(!0),[i,s]=(0,l.useState)(!1),d=ee();return(0,l.useEffect)(()=>{(async()=>{try{a(!0);const e=await H.listSecrets();t(e.editable_secrets),r(e.static_secrets),s(!1)}catch(e){s(!0),d.show("error",e)}finally{a(!1)}})()},[]),o?c().createElement(U.Box,{sx:{display:"flex",justifyContent:"center",padding:2}},c().createElement(U.CircularProgress,{size:24})):i?c().createElement(U.Box,null,d.jsx):c().createElement(U.Box,null,c().createElement("p",null,"This section shows the secrets set in the ",c().createElement("code",null,".env")," file at the workspace root. For most chat models, an API key secret in"," ",c().createElement("code",null,".env")," is required for Jupyternaut to reply in the chat. See the"," ",c().createElement(U.Link,{href:"https://docs.litellm.ai/docs/providers",target:"_blank",rel:"noopener noreferrer"},"documentation")," ","for information on which API key is required for your model provider."),c().createElement("p",null,'Click "Add secret" to add a secret to the ',c().createElement("code",null,".env")," file. Secrets can also be updated by editing the ",c().createElement("code",null,".env")," file directly in JupyterLab."),c().createElement(be,{editableSecrets:e,reloadSecrets:async()=>{try{const e=await H.listSecrets();t(e.editable_secrets),r(e.static_secrets),s(!1)}catch(e){s(!0),d.show("error",e)}}}),n.length?c().createElement(U.Alert,{severity:"info"},c().createElement("p",{style:{marginTop:0}},"The secrets below are set by the environment variables and the traitlets configuration passed to the server process. These secrets can only be changed either upon restarting the server or by contacting your server administrator."),c().createElement(Se,{secrets:n})):null)}const Ie=c().createElement("p",null,"You may provide any model ID accepted by LiteLLM. Details can be found from the"," ",c().createElement("a",{href:"https://docs.litellm.ai/docs/providers",target:"_blank",rel:"noopener noreferrer"},"LiteLLM documentation"),".");function Ae(e){const[t,n]=(0,l.useState)(null),[r,o]=(0,l.useState)(null),[a,i]=(0,l.useState)(e.completionProvider&&e.completionProvider.isEnabled());return(0,l.useEffect)(()=>{const t=()=>{i(e.completionProvider&&e.completionProvider.isEnabled())};return e.completionProvider?.settingsChanged.connect(t),()=>{e.completionProvider?.settingsChanged.disconnect(t)}},[e.completionProvider]),c().createElement(Y.A,{className:"jp-ai-ChatSettings",sx:{"& .MuiAlert-root":{marginTop:2}}},c().createElement("h2",{className:"jp-ai-ChatSettings-header"},"Chat model"),c().createElement("p",null,"Configure the language model used by Jupyternaut in chats."),Ie,c().createElement(se,{modality:"chat",label:"Chat model ID",placeholder:"e.g. 'anthropic/claude-3-5-haiku-latest'",onModelIdFetch:e=>o(e)}),c().createElement(Y.A,{sx:{display:"none"}},c().createElement("h2",{className:"jp-ai-ChatSettings-header"},"Completion model",c().createElement(Me,{provider:e.completionProvider,openSettings:e.openInlineCompleterSettings,isCompleterEnabled:a,hasCompletionModel:!!t})),c().createElement("p",null,"Configure the language model used to generate inline completions when editing documents in JupyterLab."),Ie,c().createElement(se,{modality:"completion",label:"Completion model ID",placeholder:"e.g. 'anthropic/claude-3-5-haiku-latest'",onModelIdFetch:e=>{n(e)}})),c().createElement("h2",{className:"jp-ai-ChatSettings-header"},"Model parameters"),c().createElement("p",null,"Configure additional parameters for the language model."),c().createElement(de,{modelId:r}),c().createElement("h2",{className:"jp-ai-ChatSettings-header"},"Secrets and API keys"),c().createElement(ke,null))}function Me(e){return e.hasCompletionModel&&!e.isCompleterEnabled?c().createElement(U.Tooltip,{title:"A completion model is selected, but "+(null===e.provider?"the inline completion plugin is not available. Update to JupyterLab 4.1+ to use inline completions.":"inline completions are disabled. Click the icon to open the inline completion settings.")},c().createElement(U.IconButton,{onClick:e.openSettings},c().createElement(Q.A,null))):c().createElement(U.Tooltip,{title:"Open inline completion settings"},c().createElement(U.IconButton,{onClick:e.openSettings},c().createElement(X.A,null)))}const _e={onEvent:e=>{}},Pe=c().createContext(_e);function je(){return(0,l.useContext)(Pe)}function Le(e){const[t]=(0,l.useState)(e.telemetryHandler??_e);return c().createElement(Pe.Provider,{value:t},e.children)}var Te;!function(e){e.openAiSettings="jupyter-ai:open-settings"}(Te||(Te={}));const ze=[{id:"@jupyter-ai/core:plugin",autoStart:!0,requires:[i.IRenderMimeRegistry],optional:[a.ICommandPalette,a.IThemeManager,k,r.INotebookShell],activate:async(e,t,n,r,o,i)=>{const l=()=>{e.commands.execute("settingeditor:open",{query:"Inline Completer"})};let d,u;try{u=function(e,t,n,r){const o=a.ReactWidget.create(c().createElement(K,{themeManager:e},c().createElement(Ae,{rmRegistry:t,completionProvider:n,openInlineCompleterSettings:r})));return o.id="jupyter-ai::settings",o.title.icon=M.settingsIcon,o.title.caption="Jupyter AI Settings",o}(r,t,o,l)}catch(e){console.error(e),u=function(e){const t=a.ReactWidget.create(c().createElement(K,{themeManager:e},c().createElement(U.Box,{sx:{width:"100%",height:"100%",boxSizing:"border-box",background:"var(--jp-layout-color0)",display:"flex",flexDirection:"column"}},c().createElement(U.Box,{sx:{padding:4}},c().createElement(U.Alert,{severity:"error"},"There seems to be a problem with the Chat backend, please look at the JupyterLab server logs or contact your administrator to correct this problem.")))));return t.id="jupyter-ai::chat",t.title.icon=_,t.title.caption="Jupyter AI Chat",t}(r)}e.commands.addCommand(Te.openAiSettings,{execute:()=>{if(!d||d.isDisposed){if(i){d=new s.Widget;const e=new s.SingletonLayout;d.layout=e,e.widget=u}else d=new a.MainAreaWidget({content:u});d.id="jupyter-ai-settings",d.title.label="AI settings",d.title.caption="AI settings",d.title.closable=!0}d.isAttached||e?.shell.add(d,i?"right":"main"),e.shell.activateById(d.id)},label:"AI settings"}),n&&n.addItem({category:"jupyter-ai",command:Te.openAiSettings})}},W,R,{id:"@jupyter-ai/core:stop-streaming",autoStart:!0,requires:[o.IMessageFooterRegistry],activate:(e,t)=>{t.addSection({component:O,position:"center"})}},...f]},5173:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)((0,a.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear")},5718:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)((0,a.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")},6077:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)((0,a.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff")},7135:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)((0,a.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save")},7641:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)([(0,a.jsx)("path",{d:"M12 5.99 19.53 19H4.47zM12 2 1 21h22z"},"0"),(0,a.jsx)("path",{d:"M13 16h-2v2h2zm0-6h-2v5h2z"},"1")],"WarningAmber")},9907:(e,t,n)=>{var r=n(8034);t.A=void 0;var o=r(n(369)),a=n(1085);t.A=(0,o.default)((0,a.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh")}}]);