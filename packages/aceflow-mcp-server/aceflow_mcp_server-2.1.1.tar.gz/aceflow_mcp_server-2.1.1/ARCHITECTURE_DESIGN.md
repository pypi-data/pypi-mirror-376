# AceFlow MCPå·¥å…·æ¶æ„è®¾è®¡æ–‡æ¡£

**ç‰ˆæœ¬**: 2.0  
**åˆ›å»ºæ—¶é—´**: 2025-08-25  
**è®¾è®¡åŸåˆ™**: AI-MCPåŒå‘åä½œæ¶æ„  

## ğŸ¯ è®¾è®¡ç›®æ ‡

### æ ¸å¿ƒç›®æ ‡
- **èŒè´£åˆ†ç¦»**: AI Agentè´Ÿè´£æ™ºèƒ½åˆ†æå’Œå†…å®¹ç”Ÿæˆï¼ŒMCPå·¥å…·è´Ÿè´£æ•°æ®ç®¡ç†å’Œæµç¨‹æ§åˆ¶
- **åŒå‘åä½œ**: AI Agentæ—¢ä»MCPè·å–æ•°æ®ï¼Œä¹Ÿå‘MCPæä¾›åˆ†æç»“æœ
- **æ ‡å‡†åŒ–**: ç»Ÿä¸€çš„æ¥å£è§„èŒƒå’Œæ•°æ®æ ¼å¼ï¼Œä¿è¯äº§å‡ºä¸€è‡´æ€§
- **æ™ºèƒ½åŒ–**: å……åˆ†åˆ©ç”¨AI Agentçš„ä»£ç ç†è§£å’Œåˆ†æèƒ½åŠ›

## ğŸ—ï¸ æ•´ä½“æ¶æ„

### æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    åŒå‘æ•°æ®äº¤æ¢    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AI Agent      â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   MCP å·¥å…·      â”‚
â”‚ (Claude Code)   â”‚                  â”‚                 â”‚
â”‚                 â”‚                  â”‚                 â”‚
â”‚ â€¢ é¡¹ç›®åˆ†æ      â”‚ â”€â”€â”€â”€ åˆ†æç»“æœ â”€â”€â”€â†’ â”‚ â€¢ æ•°æ®æ”¶é›†      â”‚
â”‚ â€¢ ä»£ç ç†è§£      â”‚ â†â”€â”€â”€ æ•°æ®åŒ… â”€â”€â”€â”€â”€â”€ â”‚ â€¢ æ¨¡æ¿ç®¡ç†      â”‚
â”‚ â€¢ å†…å®¹ç”Ÿæˆ      â”‚                  â”‚ â€¢ æµç¨‹æ§åˆ¶      â”‚
â”‚ â€¢ æ–‡æ¡£è¾“å‡º      â”‚                  â”‚ â€¢ çŠ¶æ€ç®¡ç†      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                    â”‚
         â”œâ”€â”€â”€ è¯»å–é¡¹ç›®æ–‡ä»¶                    â”œâ”€â”€â”€ ç®¡ç†templates/
         â”œâ”€â”€â”€ åˆ†æä»£ç ç»“æ„                    â”œâ”€â”€â”€ ç»´æŠ¤project state  
         â””â”€â”€â”€ è¾“å‡ºåˆ°aceflow_result/           â””â”€â”€â”€ è·Ÿè¸ªé˜¶æ®µä¾èµ–
```

### èŒè´£åˆ’åˆ†

#### AI Agent (Claude Code) èŒè´£
- **é¡¹ç›®åˆ†æ**: è¯»å–å’Œç†è§£é¡¹ç›®æ–‡ä»¶ã€ä»£ç ç»“æ„ã€æµ‹è¯•ç»“æœ
- **æ•°æ®æä¾›**: å‘MCPå·¥å…·æä¾›åˆ†æå¾—å‡ºçš„é¡¹ç›®æ•°æ®
- **å†…å®¹ç”Ÿæˆ**: åŸºäºMCPæä¾›çš„æ•°æ®åŒ…ç”Ÿæˆå®Œæ•´çš„é˜¶æ®µæ–‡æ¡£
- **è´¨é‡ä¿è¯**: ç¡®ä¿ç”Ÿæˆå†…å®¹ç¬¦åˆæ¨¡æ¿ç»“æ„ä¸”å…·æœ‰å®é™…æ„ä¹‰

#### MCP å·¥å…·èŒè´£
- **æ•°æ®ç®¡ç†**: æ”¶é›†ã€å­˜å‚¨å’Œç®¡ç†AIæä¾›çš„é¡¹ç›®æ•°æ®
- **æ¨¡æ¿ç®¡ç†**: åŠ è½½å’Œæä¾›æ ‡å‡†åŒ–çš„é˜¶æ®µæ¨¡æ¿
- **æµç¨‹æ§åˆ¶**: ç®¡ç†å·¥ä½œæµçŠ¶æ€ã€é˜¶æ®µä¾èµ–å’Œæ¨è¿›é€»è¾‘
- **æ•°æ®å‡†å¤‡**: ä¸ºAI Agentå‡†å¤‡å®Œæ•´çš„æ‰§è¡Œæ•°æ®åŒ…

## ğŸ”Œ MCPå·¥å…·æ¥å£è®¾è®¡

### æ ¸å¿ƒæ¥å£è§„èŒƒ

#### 1. aceflow_stage ä¸»æ¥å£
```python
aceflow_stage(
    action: str,           # æ“ä½œç±»å‹
    stage: Optional[str],  # é˜¶æ®µID
    data: Optional[Dict]   # æ•°æ®è½½è·
) -> Dict[str, Any]
```

#### 2. æ”¯æŒçš„æ“ä½œç±»å‹

##### 2.1 æ•°æ®è®¾ç½®æ“ä½œ
```python
# AI Agent å‘MCPæä¾›åˆ†ææ•°æ®
aceflow_stage(action="set_analysis", stage="current", data={
    "project_info": {
        "tech_stack": ["Vue3", "FastAPI", "DuckDB"],
        "file_count": 45,
        "test_files": 12,
        "dependencies": ["vue", "fastapi", "duckdb"]
    },
    "code_metrics": {
        "total_lines": 5420,
        "test_coverage": 85.6,
        "complexity_score": 7.2
    },
    "test_results": {
        "total_tests": 23,
        "passed": 21,
        "failed": 2,
        "coverage_percent": 85.6
    }
})
```

##### 2.2 è¾“å‡ºä¿å­˜æ“ä½œ
```python
# AI Agent ä¿å­˜é˜¶æ®µè¾“å‡ºä¾›åç»­ä½¿ç”¨
aceflow_stage(action="save_output", stage="s1_user_story", data={
    "content": "å®Œæ•´çš„ç”¨æˆ·æ•…äº‹å†…å®¹...",
    "metadata": {
        "word_count": 1200,
        "stories_count": 5,
        "completion_time": "2025-08-25 14:30:00"
    }
})
```

##### 2.3 æ•°æ®å‡†å¤‡æ“ä½œ
```python
# AI Agent è¯·æ±‚æ‰§è¡Œæ•°æ®åŒ…
aceflow_stage(action="prepare_data", stage="s5_test_report")

# è¿”å›æ ¼å¼:
{
    "success": True,
    "stage_id": "s5_test_report",
    "data_package": {
        "template": {
            "content": "# S5 æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿å†…å®¹...",
            "format": "markdown",
            "placeholders": ["{{test_count}}", "{{coverage}}"]
        },
        "previous_outputs": {
            "s4_implementation": "å®ç°é˜¶æ®µçš„è¾“å‡ºå†…å®¹..."
        },
        "analysis_data": {
            "test_results": {...},
            "code_metrics": {...}
        },
        "project_context": {
            "name": "MyProject",
            "mode": "standard",
            "current_stage": "s5_test_report"
        }
    },
    "instructions": {
        "task": "åŸºäºæ¨¡æ¿å’Œæ•°æ®ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š",
        "output_location": "aceflow_result/s5_test_report.md",
        "requirements": [...]
    }
}
```

##### 2.4 æµç¨‹æ§åˆ¶æ“ä½œ
```python
# çŠ¶æ€æŸ¥è¯¢
aceflow_stage(action="status")

# é˜¶æ®µæ¨è¿›  
aceflow_stage(action="next")

# é˜¶æ®µè·³è½¬
aceflow_stage(action="goto", stage="s3_testcases")
```

## ğŸ”„ åä½œå·¥ä½œæµç¨‹

### å…¸å‹é˜¶æ®µæ‰§è¡Œæµç¨‹

#### Phase 1: AI Agent é¡¹ç›®åˆ†æ
```
1. AI Agent è¯»å–é¡¹ç›®æ–‡ä»¶
   - åˆ†æä»£ç ç»“æ„å’ŒæŠ€æœ¯æ ˆ
   - æ£€æŸ¥æµ‹è¯•æ–‡ä»¶å’Œè¦†ç›–ç‡
   - ç†è§£é¡¹ç›®è§„æ¨¡å’Œå¤æ‚åº¦

2. AI Agent å‘MCPæä¾›åˆ†æç»“æœ
   aceflow_stage(action="set_analysis", data={
       "tech_stack": [...],
       "test_metrics": {...},
       "code_quality": {...}
   })
```

#### Phase 2: MCPå·¥å…·æ•°æ®å‡†å¤‡
```
3. AI Agent è¯·æ±‚æ‰§è¡Œæ•°æ®åŒ…
   aceflow_stage(action="prepare_data", stage="s5_test_report")

4. MCPå·¥å…·å‡†å¤‡å®Œæ•´æ•°æ®åŒ…
   - åŠ è½½s5_test_report.mdæ¨¡æ¿
   - æ”¶é›†å‰ä¸€é˜¶æ®µè¾“å‡º(s4_implementation)
   - æ•´åˆAIæä¾›çš„åˆ†ææ•°æ®
   - è¿”å›å®Œæ•´æ‰§è¡ŒåŒ…
```

#### Phase 3: AI Agent å†…å®¹ç”Ÿæˆ
```
5. AI Agent åŸºäºæ•°æ®åŒ…ç”Ÿæˆå†…å®¹
   - ç†è§£æ¨¡æ¿ç»“æ„
   - ç»“åˆåˆ†ææ•°æ®å¡«å……å…·ä½“å†…å®¹
   - åŸºäºå‰ä¸€é˜¶æ®µè¾“å‡ºä¿æŒé€»è¾‘è¿è´¯
   - ç”Ÿæˆå®Œæ•´ä¸”æœ‰æ„ä¹‰çš„æ–‡æ¡£

6. AI Agent è¾“å‡ºæœ€ç»ˆæ–‡æ¡£
   - å†™å…¥ aceflow_result/s5_test_report.md
   - é€šçŸ¥MCPä¿å­˜è¾“å‡º(å¯é€‰)
```

#### Phase 4: æµç¨‹æ¨è¿›
```
7. æ›´æ–°é¡¹ç›®çŠ¶æ€
   aceflow_stage(action="complete_stage", stage="s5_test_report")

8. æ¨è¿›åˆ°ä¸‹ä¸€é˜¶æ®µ
   aceflow_stage(action="next")
```

## ğŸ“Š æ•°æ®æ¨¡å‹è®¾è®¡

### é¡¹ç›®ä¸Šä¸‹æ–‡æ•°æ®ç»“æ„
```python
ProjectContext = {
    "project": {
        "name": str,
        "mode": str,  # minimal|standard|complete|smart
        "created_at": str,
        "last_updated": str
    },
    "flow": {
        "current_stage": str,
        "completed_stages": List[str],
        "next_stage": Optional[str],
        "progress_percentage": int
    },
    "analysis_data": {
        "project_info": Dict,
        "code_metrics": Dict, 
        "test_results": Dict,
        "dependencies": List[str]
    }
}
```

### é˜¶æ®µè¾“å‡ºæ•°æ®ç»“æ„
```python
StageOutput = {
    "stage_id": str,
    "content": str,
    "metadata": {
        "created_at": str,
        "word_count": int,
        "ai_generated": bool,
        "template_used": str
    },
    "dependencies": List[str],  # ä¾èµ–çš„å‰ç½®é˜¶æ®µ
    "artifacts": List[str]      # ç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„
}
```

## ğŸ› ï¸ æŠ€æœ¯å®ç°è¦ç‚¹

### 1. æ•°æ®å­˜å‚¨ç­–ç•¥
- **é¡¹ç›®çŠ¶æ€**: `.aceflow/current_state.json`
- **åˆ†ææ•°æ®**: `.aceflow/analysis_data.json` 
- **é˜¶æ®µè¾“å‡º**: `.aceflow/stage_outputs/`
- **æœ€ç»ˆæ–‡æ¡£**: `aceflow_result/`

### 2. æ¨¡æ¿ç®¡ç†
- **ä½ç½®**: `templates/` ç›®å½•
- **æ ¼å¼**: Markdown + å ä½ç¬¦
- **åŠ è½½**: åŠ¨æ€è¯»å–ï¼Œæ”¯æŒè‡ªå®šä¹‰

### 3. é”™è¯¯å¤„ç†
- **æ•°æ®ç¼ºå¤±**: æä¾›é»˜è®¤å€¼æˆ–æç¤ºAIè¡¥å……
- **æ¨¡æ¿ç¼ºå¤±**: ä½¿ç”¨é€šç”¨æ¨¡æ¿å›é€€
- **æ ¼å¼é”™è¯¯**: éªŒè¯å¹¶ç»™å‡ºä¿®å¤å»ºè®®

## ğŸ“ ç¤ºä¾‹åœºæ™¯

### åœºæ™¯: ç”ŸæˆS5æµ‹è¯•æŠ¥å‘Š

#### 1. AI Agent åˆ†æé¡¹ç›®
```bash
# AIè¯»å–æµ‹è¯•æ–‡ä»¶
ls tests/ 
# å‘ç°: test_user.py, test_task.py, test_api.py

# AIåˆ†ææµ‹è¯•ç»“æœ 
pytest --coverage
# å¾—åˆ°: 23ä¸ªæµ‹è¯•ï¼Œ21ä¸ªé€šè¿‡ï¼Œè¦†ç›–ç‡85.6%
```

#### 2. AIå‘MCPæä¾›æ•°æ®
```python
aceflow_stage(action="set_analysis", data={
    "test_results": {
        "total_tests": 23,
        "passed": 21, 
        "failed": 2,
        "coverage_percent": 85.6,
        "test_files": ["test_user.py", "test_task.py", "test_api.py"]
    }
})
```

#### 3. AIè¯·æ±‚æ•°æ®åŒ…
```python
result = aceflow_stage(action="prepare_data", stage="s5_test_report")
# MCPè¿”å›: æ¨¡æ¿ + S4è¾“å‡º + æµ‹è¯•æ•°æ® + æŒ‡å¯¼ä¿¡æ¯
```

#### 4. AIç”Ÿæˆå®Œæ•´æŠ¥å‘Š
åŸºäºæ•°æ®åŒ…ç”ŸæˆåŒ…å«çœŸå®æµ‹è¯•æ•°æ®çš„æŠ¥å‘Šï¼š
```markdown
# S5 æµ‹è¯•æŠ¥å‘Š - MyTaskApp

## æµ‹è¯•æ¦‚è§ˆ
- æµ‹è¯•ç”¨ä¾‹æ€»æ•°: 23ä¸ª
- é€šè¿‡ç”¨ä¾‹: 21ä¸ª (91.3%)
- å¤±è´¥ç”¨ä¾‹: 2ä¸ª (8.7%)
- æµ‹è¯•è¦†ç›–ç‡: 85.6%

## æµ‹è¯•æ–‡ä»¶åˆ†æ
- test_user.py: ç”¨æˆ·ç®¡ç†æ¨¡å—æµ‹è¯•
- test_task.py: ä»»åŠ¡ç®¡ç†æ ¸å¿ƒæµ‹è¯•  
- test_api.py: APIæ¥å£æµ‹è¯•

## å¤±è´¥ç”¨ä¾‹åˆ†æ
åŸºäºS4å®ç°é˜¶æ®µçš„ä»£ç åˆ†æï¼Œå¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹ä¸»è¦é›†ä¸­åœ¨...
```

## ğŸ¯ é¢„æœŸæ”¶ç›Š

### 1. æ™ºèƒ½åŒ–ç¨‹åº¦å¤§å¹…æå‡
- AIèƒ½å¤ŸçœŸæ­£ç†è§£é¡¹ç›®å¹¶ç”Ÿæˆæœ‰æ„ä¹‰çš„å†…å®¹
- ä¸å†æ˜¯ç®€å•çš„æ¨¡æ¿å¡«å……

### 2. æ•°æ®ä¸€è‡´æ€§ä¿è¯
- ç»Ÿä¸€çš„æ•°æ®æ ¼å¼å’Œæ¥å£è§„èŒƒ
- MCPå·¥å…·ç¡®ä¿æ¨¡æ¿ç»“æ„ä¸€è‡´æ€§

### 3. å¯æ‰©å±•æ€§å¼º
- æ˜“äºæ·»åŠ æ–°çš„åˆ†æç»´åº¦
- æ”¯æŒè‡ªå®šä¹‰é˜¶æ®µå’Œæ¨¡æ¿

### 4. ç”¨æˆ·ä½“éªŒä¼˜ç§€  
- AIè‡ªåŠ¨åˆ†æï¼Œç”¨æˆ·æ— éœ€æ‰‹åŠ¨è¾“å…¥æ•°æ®
- ç”Ÿæˆçš„æ–‡æ¡£ç›´æ¥å¯ç”¨ï¼Œæ— éœ€äºŒæ¬¡ç¼–è¾‘

---
*è®¾è®¡æ–‡æ¡£ç‰ˆæœ¬: 2.0*  
*æœ€åæ›´æ–°: 2025-08-25*