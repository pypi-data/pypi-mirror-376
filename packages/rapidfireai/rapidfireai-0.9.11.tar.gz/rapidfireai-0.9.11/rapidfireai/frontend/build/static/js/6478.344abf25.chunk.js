"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[6478],{19805:function(e,t,a){a.d(t,{O:function(){return l}});var n=a(89555),o=(a(31014),a(68254)),r=a(77336),i=a(47664),s=a(50111);const l=function(){const{theme:e}=(0,o.u)();return(0,s.FD)("div",{className:"center",children:[(0,s.Y)("img",{alt:"No experiments found.",style:{height:"200px",marginTop:"80px"},src:r.A}),(0,s.Y)("h1",{style:{paddingTop:"10px",color:e.colors.textSecondary},children:"No Experiments Exist"}),(0,s.FD)("h2",{css:(0,n.AH)({color:e.colors.textSecondary},""),children:["To create an experiment use the ",(0,s.Y)("a",{href:i.d1,children:"mlflow experiments"})," CLI."]})]})}},28825:function(e,t,a){a.d(t,{A:function(){return l}});var n=a(89555),o=(a(31014),a(79083)),r=a(68254),i=a(50111);const s="The current user does not have permission to view this page.";function l(e){let{errorMessage:t}=e;const{theme:a}=(0,r.u)();return(0,i.FD)("div",{className:"center",children:[(0,i.Y)("img",{style:{height:300,marginTop:80},src:o.A,alt:"permission denied"}),(0,i.Y)("h1",{style:{paddingTop:10},children:"Permission Denied"}),(0,i.Y)("h2",{"data-testid":"error-message",css:(0,n.AH)({color:a.colors.textSecondary},""),children:t||s})]})}},2028:function(e,t,a){var n=a(31014),o=a(50111);t.A=e=>{let{logs:t,onScrollToBottom:a,emptyStateMessage:r="No logs available. If this is a new cluster, logs will appear here once the cluster starts."}=e;const[i,s]=(0,n.useState)([]),l=(0,n.useRef)(null),[d,m]=(0,n.useState)(!0);(0,n.useEffect)((()=>{s(t)}),[t]),(0,n.useEffect)((()=>{l.current&&d&&(l.current.scrollTop=l.current.scrollHeight)}),[i,d]);return(0,o.Y)("div",{ref:l,className:"terminal-container",style:{backgroundColor:"#000",color:"#fff",fontFamily:"monospace",padding:"20px",height:"650px",overflowY:"auto",borderRadius:"5px",boxShadow:"0 0 10px rgba(0,0,0,0.5)",position:"relative"},onScroll:()=>{if(!l.current)return;const{scrollTop:e,scrollHeight:t,clientHeight:n}=l.current,o=t-e-n<50;m(o),o&&a&&a()},children:i.length>0?(0,o.Y)("div",{style:{minHeight:"100%"},children:i.map(((e,t)=>(0,o.Y)("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordBreak:"break-all",lineHeight:"1.5"},children:e},t)))}):(0,o.Y)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center",color:"#888",width:"80%"},children:r})})}},82196:function(e,t,a){a.d(t,{A:function(){return c}});var n=a(89555),o=a(68254),r=a(82589),i=a(88443),s=a(37616),l=a(56412),d=a(50111);var m={name:"1voqbl3",styles:"margin-top:0;font-weight:normal"};const c=e=>{let{isOpen:t,closeModal:a,experimentId:c}=e;const{theme:u}=(0,o.u)(),p=`\nimport mlflow\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.datasets import load_diabetes\nfrom sklearn.ensemble import RandomForestRegressor\n\n# set the experiment id\nmlflow.set_experiment(experiment_id="${c}")\n\nmlflow.autolog()\ndb = load_diabetes()\n\nX_train, X_test, y_train, y_test = train_test_split(db.data, db.target)\n\n# Create and train models.\nrf = RandomForestRegressor(n_estimators=100, max_depth=6, max_features=3)\nrf.fit(X_train, y_train)\n\n# Use the model to make predictions on the test dataset.\npredictions = rf.predict(X_test)\n`.trimStart(),g=`\nimport mlflow\nimport openai\n\n# you must set the OPENAI_API_KEY environment variable\nassert (\n  "OPENAI_API_KEY" in os.environ\n), "Please set the OPENAI_API_KEY environment variable."\n\n# set the experiment id\nmlflow.set_experiment(experiment_id="${c}")\n\nsystem_prompt = (\n  "The following is a conversation with an AI assistant."\n  + "The assistant is helpful and very friendly."\n)\n\n# start a run\nmlflow.start_run()\nmlflow.log_param("system_prompt", system_prompt)\n\n# Create a question answering model using prompt engineering\n# with OpenAI. Log the model to MLflow Tracking\nlogged_model = mlflow.openai.log_model(\n    model="gpt-3.5-turbo",\n    task=openai.ChatCompletion,\n    artifact_path="model",\n    messages=[\n        {"role": "system", "content": system_prompt},\n        {"role": "user", "content": "{question}"},\n    ],\n)\n\n# Evaluate the model on some example questions\nquestions = pd.DataFrame(\n    {\n        "question": [\n            "How do you create a run with MLflow?",\n            "How do you log a model with MLflow?",\n            "What is the capital of France?",\n        ]\n    }\n)\nmlflow.evaluate(\n    model=logged_model.model_uri,\n    model_type="question-answering",\n    data=questions,\n)\nmlflow.end_run()\n`.trimStart(),h=18*(Math.min(...[p,g].map((e=>e.split("\n").length)))+1);return(0,d.Y)(r.aFV,{visible:t,onCancel:a,onOk:a,footer:(0,d.Y)("div",{css:(0,n.AH)({display:"flex",gap:u.spacing.sm,justifyContent:"flex-end"},""),children:(0,d.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_createnotebookrunmodal.tsx_117",onClick:a,type:"primary",children:(0,d.Y)(i.A,{id:"ttyLD4",defaultMessage:"Okay"})})}),title:(0,d.FD)("div",{children:[(0,d.Y)(o.T.Title,{level:2,css:(0,n.AH)({marginTop:u.spacing.sm,marginBottom:u.spacing.xs},""),children:(0,d.Y)(i.A,{id:"iF1UfU",defaultMessage:"New run using notebook"})}),(0,d.Y)(o.T.Hint,{css:m,children:"Run this code snippet in a notebook or locally, to create an experiment run"})]}),children:(0,d.FD)(r.tUM,{children:[(0,d.Y)(r.mFh,{tab:(0,d.Y)(i.A,{id:"71dHIO",defaultMessage:"Classical ML"}),children:(0,d.Y)(s.z7,{style:{padding:"5px",height:h},language:"python",actions:(0,d.Y)("div",{style:{marginTop:u.spacing.sm,marginRight:u.spacing.md},children:(0,d.Y)(l.i,{copyText:p,showLabel:!1,icon:(0,d.Y)(r.TdU,{})})}),children:p})},"classical-ml"),(0,d.Y)(r.mFh,{tab:(0,d.Y)(i.A,{id:"xBVMQz",defaultMessage:"LLM"}),children:(0,d.Y)(s.z7,{style:{padding:"5px",height:h},language:"python",actions:(0,d.Y)("div",{style:{marginTop:u.spacing.sm,marginRight:u.spacing.md},children:(0,d.Y)(l.i,{copyText:g,showLabel:!1,icon:(0,d.Y)(r.TdU,{})})}),children:g})},"llm")]})})}},24774:function(e,t,a){a.d(t,{Z:function(){return Q}});var n=a(89555),o=a(68254),r=a(82589),i=a(9133),s=a(31014),l=a(88464),d=a(88443),m=a(10811),c=a(76010),u=a(44240),p=a(57392),g=a(54346),h=a(24947),f=a(65795),v=a(69526);const _=[{type:"slider",name:"temperature",string:(0,v.zR)({id:"Jrri/Y",defaultMessage:"Temperature"}),helpString:(0,v.zR)({id:"5yWkFd",defaultMessage:"Increase or decrease the confidence level of the language model."}),max:1,min:0,step:.01},{type:"input",name:"max_tokens",string:(0,v.zR)({id:"qR3llD",defaultMessage:"Max tokens"}),helpString:(0,v.zR)({id:"cEwSR8",defaultMessage:"Maximum number of language tokens returned from evaluation."}),max:65536,min:1,step:1},{type:"list",name:"stop",string:(0,v.zR)({id:"FAfPOl",defaultMessage:"Stop Sequences"}),helpString:(0,v.zR)({id:"J2XCE/",defaultMessage:"Specify sequences that signal the model to stop generating text."})}],y={temperature:.01,max_tokens:100},b=()=>{const[e,t]=(0,s.useState)(y),a=(0,s.useCallback)(((e,a)=>{t((t=>({...t,[e]:a})))}),[]);return{parameterDefinitions:_,parameters:e,updateParameter:a}};var Y=a(20193),x=a(50111);var w={name:"151f7v8",styles:"span{font-weight:normal;}"};const A=e=>{let{disabled:t=!1,parameters:a,updateParameter:i}=e;const{parameterDefinitions:s}=b(),{theme:l}=(0,o.u)();return(0,x.FD)("div",{css:(0,n.AH)({marginBottom:l.spacing.lg},""),children:[(0,x.Y)(r.D$Q.Label,{css:(0,n.AH)({marginBottom:l.spacing.md},""),children:(0,x.Y)(d.A,{id:"KADUUT",defaultMessage:"Model parameters"})}),s.map((e=>(0,x.Y)("div",{css:(0,n.AH)({marginBottom:l.spacing.md},""),children:(0,x.FD)(x.FK,{children:[(0,x.FD)(r.D$Q.Label,{htmlFor:e.name,css:w,children:[(0,x.Y)(d.A,{...e.string}),(0,x.Y)(r.m_M,{title:(0,x.Y)(d.A,{...e.helpString}),placement:"right",children:(0,x.Y)(r.mo0,{css:(0,n.AH)({marginLeft:l.spacing.sm,verticalAlign:"text-top",color:l.colors.textSecondary},"")})})]}),(0,x.Y)(r.D$Q.Hint,{}),"temperature"===e.name&&(0,x.Y)(Y.o,{"data-testid":e.name,disabled:t,max:e.max,min:e.min,step:e.step,defaultValue:a[e.name]||0,onChange:t=>i(e.name,t)}),"input"===e.type&&(0,x.Y)(o.f,{"data-testid":e.name,type:"number",disabled:t,max:e.max,min:e.min,step:e.step,value:a[e.name]||0,onChange:t=>i(e.name,parseInt(t.target.value,10))}),"list"===e.type&&(0,x.Y)(r._vn,{allowClear:!0,mode:"tags",style:{width:"100%"},open:!1,disabled:t,onChange:t=>i(e.name,t),value:a[e.name]||[],dangerouslySetAntdProps:{suffixIcon:null}})]})},e.name)))]})},M=" }}",T="new_variable",k=()=>{const[e,t]=(0,s.useState)(f.KH),a=(0,s.useRef)(),n=(0,s.useCallback)((()=>{t((e=>{const t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e.includes(T))return T;const t=(0,i.max)(e.map((e=>{var t;return parseInt((null===(t=e.match(/new_variable_(\d+)/))||void 0===t?void 0:t[1])||"1",10)})))||1;return`${T}_${t+1}`}((0,f.rl)(e)),n=`${e} {{ ${t}${M}`;return requestAnimationFrame((()=>{const e=a.current;e&&(e.focus(),e.setSelectionRange(n.length-t.length-3,n.length-3))})),n}))}),[t]);return{savePromptTemplateInputRef:(0,s.useCallback)((e=>{var t;a.current=null===e||void 0===e||null===(t=e.resizableTextArea)||void 0===t?void 0:t.textArea}),[]),handleAddVariableToTemplate:n,promptTemplate:e,updatePromptTemplate:t}},D=(0,v.zR)({id:"lM0z8k",defaultMessage:"The following variable names contain spaces which is disallowed: {invalidNames}"}),C=e=>{let{violations:t}=e;const{namesWithSpaces:a}=t,{formatMessage:n}=(0,l.A)();return(0,x.Y)(x.FK,{children:a.length>0&&(0,x.Y)(o.T.Text,{color:"warning",size:"sm","aria-label":n(D,{invalidNames:a.join(", ")}),children:(0,x.Y)(d.A,{...D,values:{invalidNames:(0,x.Y)(x.FK,{children:a.map((e=>(0,x.Y)("code",{children:e},e)))})}})})})};var F=a(57207);const I=[{prompt:["You are a marketing consultant for a technology company. Develop a marketing strategy report for {{ company_name }} aiming to {{ company_goal }}"],variables:[{name:"company_name",value:"XYZ Company"},{name:"company_goal",value:"Increase top-line revenue"}]},{prompt:['You are a helpful and friendly customer support chatbot. Answer the users question "{{ user_question }}" clearly, based on the following documentation: {{ documentation }}'],variables:[{name:"user_question",value:"Is MLflow open source?"},{name:"documentation",value:"MLflow is an open source platform for managing the end-to-end machine learning lifecycle."}]},{prompt:['Summarize the given text "{{ text }}" into a concise and coherent summary, capturing the main ideas and key points. Make sure that the summary does not exceed {{ word_count }} words.'],variables:[{name:"text",value:"Although C. septempunctata larvae and adults mainly eat aphids, they also feed on Thysanoptera, Aleyrodidae, on the larvae of Psyllidae and Cicadellidae, and on eggs and larvae of some beetles and butterflies. There are one or two generations per year. Adults overwinter in ground litter in parks, gardens and forest edges and under tree bark and rocks. C. septempunctata has a broad ecological range, generally living wherever there are aphids for it to eat. This includes, amongst other biotopes, meadows, fields, Pontic\u2013Caspian steppe, parkland, gardens, Western European broadleaf forests and mixed forests. In the United Kingdom, there are fears that the seven-spot ladybird is being outcompeted for food by the harlequin ladybird. An adult seven-spot ladybird may reach a body length of 7.6\u201312.7 mm (0.3\u20130.5 in). Their distinctive spots and conspicuous colours warn of their toxicity, making them unappealing to predators. The species can secrete a fluid from joints in their legs which gives them a foul taste. A threatened ladybird may both play dead and secrete the unappetising substance to protect itself. The seven-spot ladybird synthesizes the toxic alkaloids, N-oxide coccinelline and its free base precoccinelline; depending on sex and diet, the spot size and coloration can provide some indication of how toxic the individual insect is to potential predators."},{name:"word_count",value:"75"}]},{prompt:["Generate a list of ten titles for my book. The book is about {{ topic }}. Each title should be between {{ word_range }} words long.","### Examples of great titles ###","{{ examples }}"],variables:[{name:"topic",value:"my journey as an adventurer who has lived an unconventional life, meeting many different personalities and finally finding peace in gardening."},{name:"word_range",value:"two to five"},{name:"examples",value:'"Long walk to freedom", "Wishful drinking", "I know why the caged bird sings"'}]},{prompt:["Generate a SQL query from a user\u2019s question, using the information from the table.","Question: {{ user_question }}","Table Information: {{ table_information }}"],variables:[{name:"user_question",value:"Which product generated the most sales this month?"},{name:"table_information",value:"CREATE TABLE Sales (SaleID INT PRIMARY KEY, ProductID INT, SaleDate DATE, CustomerID INT, QuantitySold INT, UnitPrice DECIMAL(10, 2));"}]}],{TextArea:S}=o.f,E=e=>{let{isOpen:t,closeExamples:a,closeModal:i,updatePromptTemplate:s,updateInputVariableValue:l}=e;const{theme:m}=(0,o.u)();return(0,x.Y)(r.aFV,{verticalSizing:"maxed_out",visible:t,onCancel:i,title:(0,x.Y)("div",{children:(0,x.FD)(o.T.Title,{level:2,css:(0,n.AH)({marginTop:m.spacing.sm,marginBottom:m.spacing.xs},""),children:[(0,x.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodalexamples.tsx_48",css:(0,n.AH)({marginRight:m.spacing.sm,marginBottom:m.spacing.sm},""),icon:(0,x.Y)(r.A60,{}),onClick:a}),(0,x.Y)(d.A,{id:"KzC+38",defaultMessage:"Prompt template examples"})]})}),dangerouslySetAntdProps:{width:1200},children:I.map((e=>(0,x.FD)("div",{css:(0,n.AH)({display:"flex",flexDirection:"column",gap:m.spacing.md},""),children:[(0,x.FD)("div",{css:(0,n.AH)({boxSizing:"border-box",border:`1px solid ${m.colors.actionDefaultBorderDefault}`,borderRadius:m.borders.borderRadiusMd,background:m.colors.backgroundPrimary,padding:m.spacing.md,margin:0,overflow:"hidden",display:"flex",flexDirection:"column",gap:`${m.spacing.xs}px`},""),children:[(0,x.FD)(o.T.Title,{level:4,children:[(0,x.Y)(d.A,{id:"GDzD7I",defaultMessage:"Prompt Template"}),(0,x.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodalexamples.tsx_90",type:"tertiary",size:"small",style:{float:"right"},onClick:()=>(e=>{s(e.prompt.join("\n")),e.variables.forEach((e=>{let{name:t,value:a}=e;l(t,a)})),a()})(e),children:(0,x.Y)(d.A,{id:"Np53PR",defaultMessage:"Try this template"})})]}),e.prompt.map((e=>(0,x.Y)(o.T.Paragraph,{children:e},e))),(0,x.Y)(F.A,{css:(0,n.AH)({marginTop:m.spacing.xs,marginBottom:m.spacing.xs},"")}),e.variables.map((e=>{let{name:t,value:a}=e;return(0,x.FD)("div",{children:[(0,x.Y)(o.T.Title,{level:4,children:t}),(0,x.Y)(o.T.Paragraph,{children:a})]},t)}))]}),(0,x.Y)(r.hKd,{})]},e.prompt.join("\n"))))})};const{TextArea:H}=o.f;var L={name:"1ll9bqd",styles:"cursor:default"};const P=e=>{let{evaluationMetadata:t,isEvaluating:a,isOutputDirty:i,evaluationOutput:l,evaluationError:m,evaluateButtonTooltip:c,disabled:u,onEvaluateClick:p,onCancelClick:g}=e;const{theme:h}=(0,o.u)(),v=(0,s.useMemo)((()=>t?a?null:(0,x.FD)("div",{css:(0,n.AH)({display:"flex",gap:h.spacing.xs,alignItems:"center"},""),children:[f.Ef in t&&(0,x.FD)(o.T.Hint,{size:"sm",children:[Math.round(Number(t[f.Ef]))," ms","MLFLOW_total_tokens"in t?",":""]}),f.jC in t&&(0,x.Y)(o.T.Hint,{size:"sm",children:(0,x.Y)(d.A,{id:"/nPZbt",defaultMessage:"{totalTokens} total tokens",values:{totalTokens:t[f.jC]}})})]}):null),[t,a,h]);return(0,x.FD)(x.FK,{children:[(0,x.FD)("div",{css:(0,n.AH)({marginBottom:h.spacing.md},""),children:[(0,x.Y)(r.m_M,{title:c,children:(0,x.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationcreatepromptrunoutput.tsx_85","data-testid":"button-evaluate",icon:(0,x.Y)(r.udU,{}),onClick:p,disabled:u,loading:a,children:(0,x.Y)(d.A,{id:"72uGpl",defaultMessage:"Evaluate"})})}),a&&(0,x.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_components_evaluationcreatepromptrunoutput.tsx_99","data-testid":"button-cancel",icon:(0,x.Y)(r.wFz,{}),onClick:g,css:(0,n.AH)({marginLeft:h.spacing.sm},""),children:(0,x.Y)(d.A,{id:"CTEh+b",defaultMessage:"Cancel"})})]}),(0,x.FD)(r.D$Q.Label,{children:[(0,x.Y)(d.A,{id:"ydoHrJ",defaultMessage:"Output"}),i&&(0,x.Y)(r.m_M,{title:(0,x.Y)(d.A,{id:"gc+GrI",defaultMessage:"Model, input data or prompt have changed since last evaluation of the output"}),children:(0,x.Y)(o.W,{css:(0,n.AH)({marginLeft:h.spacing.xs},"")})})]}),(0,x.Y)(r.D$Q.Hint,{children:(0,x.Y)(d.A,{id:"JtQQMn",defaultMessage:"This is the output generated by the LLM using the prompt template and input values defined above."})}),!m&&a&&(0,x.Y)("div",{css:(0,n.AH)({marginTop:h.spacing.sm},""),children:(0,x.Y)(r.QvX,{lines:5})}),!a&&(0,x.Y)(H,{rows:5,css:L,"data-testid":"prompt-output",value:l,readOnly:!0}),!a&&m&&(0,x.Y)(r.D$Q.Message,{message:m,type:"error"}),(0,x.Y)("div",{css:(0,n.AH)({marginTop:h.spacing.sm},""),children:v})]})};var R=a(53660),N=a(17142),V=a(52350),z=a(39697);const{TextArea:B}=o.f;var q={name:"1voqbl3",styles:"margin-top:0;font-weight:normal"},O={name:"t691yx",styles:"display:grid;grid-template-columns:300px 1fr;gap:48px"},$={name:"1d3w5wq",styles:"width:100%"},K={name:"1eoy87d",styles:"display:flex;justify-content:space-between"};const Q=e=>{let{isOpen:t,closeModal:a,runBeingDuplicated:v,visibleRuns:_=[],refreshRuns:y}=e;const[Y]=(0,h.z)(),{theme:w}=(0,o.u)(),{parameters:M,updateParameter:T}=b(),[,D]=(0,R.a)(),[F,I]=(0,s.useState)(""),[S,H]=(0,s.useState)(""),[L,Q]=(0,s.useState)(!1),[j,G]=(0,s.useState)(!1),[W,J]=(0,s.useState)(null),[X,Z]=(0,s.useState)(""),[ee,te]=(0,s.useState)({}),[ae,ne]=(0,s.useState)(!1),[oe,re]=(0,s.useState)(!1),ie=(0,s.useRef)(null),se=(0,m.wA)();(0,s.useEffect)((()=>{se((0,N.ev)()).catch((e=>{c.A.logErrorAndNotifyUser((null===e||void 0===e?void 0:e.message)||e)}))}),[se]);const le=(0,l.A)(),{updateInputVariables:de,inputVariables:me,inputVariableValues:ce,updateInputVariableValue:ue,inputVariableNameViolations:pe,clearInputVariableValues:ge}=(()=>{const[e,t]=(0,s.useState)((0,f.rl)("")),[a,n]=(0,s.useState)({namesWithSpaces:[]}),[o,r]=(0,s.useState)(f.kU),l=(0,s.useCallback)((()=>r({})),[]),d=(0,s.useMemo)((()=>(0,i.debounce)((e=>{t((t=>{const a=(0,f.rl)(e);return(0,i.isEqual)(a,t)?t:a})),n((0,f.Eb)(e))}),250)),[]),m=(0,s.useCallback)(((e,t)=>{r((a=>({...a,[e]:t})))}),[]),c=(0,s.useMemo)((()=>(0,i.fromPairs)(Object.entries(o).filter((t=>{let[a]=t;return e.includes(a)})))),[o,e]);return{updateInputVariables:d,inputVariables:e,inputVariableValues:c,updateInputVariableValue:m,inputVariableNameViolations:a,clearInputVariableValues:l}})(),{handleAddVariableToTemplate:he,savePromptTemplateInputRef:fe,promptTemplate:ve,updatePromptTemplate:_e}=k();(0,s.useEffect)((()=>{t&&!v&&H((0,g.Lr)())}),[t,v]),(0,s.useEffect)((()=>{de(ve)}),[ve,de]),(0,s.useEffect)((()=>{if(v){const{promptTemplate:e,routeName:t,parameters:a}=(0,f.vC)(v);(0,f.xP)(v),e&&_e(e),a.temperature&&T("temperature",a.temperature),a.max_tokens&&T("max_tokens",a.max_tokens),t&&I(t),Z(""),ne(!1);const n=(0,g.gK)(v.runName,(0,i.compact)(_.map((e=>{let{runName:t}=e;return t}))));H(n),ge()}}),[v,ge,T,_e,_]);const ye=(0,m.d4)((e=>{let{modelGateway:t}=e;return t.modelGatewayRoutes})),be=(0,s.useMemo)((()=>(0,i.sortBy)(Object.values(ye),"name")),[ye]),Ye=(0,m.d4)((e=>{let{modelGateway:t}=e;return t.modelGatewayRoutesLoading.loading}));(0,s.useEffect)((()=>{X&&ne(!0)}),[ce,ve,M,F]);const xe=(0,s.useCallback)((()=>{const e=ye[F],t=Math.random().toString(36);if(ie.current=t,!e)throw new Error("No model route found!");J(null),G(!0);const a=(0,f.TG)(ve,ce),n=performance.now();p.f.queryModelGatewayRoute(e,{inputText:a,parameters:M}).then((e=>{if(ie.current===t){const{text:a,metadata:o}=e,r=performance.now()-n;Z(a);const i={...o,latency:r},s=Object.entries(i).reduce(((e,t)=>{let[a,n]=t;return{...e,[`MLFLOW_${a}`]:n}}),{});te(s),ne(!1),G(!1),ie.current===t&&(ie.current=null)}})).catch((e=>{const a=(e=>e instanceof z.YZ?e.getGatewayErrorMessage():e instanceof V.s?e.getMessageField():e.message)(e),n=le.formatMessage({id:"nyHcAz",defaultMessage:'MLflow deployment returned the following error: "{errorMessage}"'},{errorMessage:a});c.A.logErrorAndNotifyUser(n),G(!1),J(n),ie.current===t&&(ie.current=null)}))}),[ce,ye,M,ve,F,le]),we=(0,s.useCallback)((()=>{ie.current&&(G(!1),ie.current=null)}),[G]),Ae=le.formatMessage({id:"AyceYA",defaultMessage:"Served LLM model"}),Me=le.formatMessage({id:"pTDM+x",defaultMessage:"Select LLM model endpoint"}),Te=ve.trim().length>0,ke=(0,s.useMemo)((()=>me.every((e=>{var t;return null===(t=ce[e])||void 0===t?void 0:t.trim()}))),[me,ce]),De=S.trim().length>0,Ce=F&&Te&&ke,Fe=Boolean(F&&Te&&ke&&X&&!ae&&me.length>0&&De&&!W),Ie=(0,s.useMemo)((()=>F?Te?ke?X?ae?le.formatMessage({id:"/K6wBr",defaultMessage:"Input data or prompt template have changed since last evaluation of the output"}):0===me.length?le.formatMessage({id:"z+0t/R",defaultMessage:"You need to define at least one input variable"}):De?null:le.formatMessage({id:"dYbJha",defaultMessage:"Please provide run name"}):le.formatMessage({id:"gUhc5g",defaultMessage:"You need to evaluate the resulting output first"}):le.formatMessage({id:"flJNTA",defaultMessage:"You need to provide values for all defined inputs"}):le.formatMessage({id:"dHAuWp",defaultMessage:"You need to provide a prompt template"}):le.formatMessage({id:"4HbEVz",defaultMessage:"You need to select a served model endpoint using dropdown first"})),[ke,me.length,le,ae,X,Te,F,De]),Se=(0,s.useMemo)((()=>F?Te?ke?null:le.formatMessage({id:"flJNTA",defaultMessage:"You need to provide values for all defined inputs"}):le.formatMessage({id:"dHAuWp",defaultMessage:"You need to provide a prompt template"}):le.formatMessage({id:"4HbEVz",defaultMessage:"You need to select a served model endpoint using dropdown first"})),[ke,le,Te,F]);if(t&&oe)return(0,x.Y)(E,{isOpen:t&&oe,closeExamples:()=>re(!1),closeModal:a,updatePromptTemplate:_e,updateInputVariableValue:ue});return(0,x.FD)(r.aFV,{verticalSizing:"maxed_out",visible:t,onCancel:a,onOk:a,footer:(0,x.FD)("div",{css:(0,n.AH)({display:"flex",gap:w.spacing.sm,justifyContent:"flex-end"},""),children:[(0,x.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_589",onClick:a,children:(0,x.Y)(d.A,{id:"mqTFL+",defaultMessage:"Cancel"})}),(0,x.Y)(r.m_M,{title:Ie,children:(0,x.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_596",onClick:()=>{var e,t;Q(!0);const n=null===(e=ye[F])||void 0===e?void 0:e.name,o={...M,route_type:null===(t=ye[F])||void 0===t?void 0:t.type},r=(0,f.TG)(ve,ce);se((0,u.$v)({experimentId:Y,promptTemplate:ve,modelInput:r,modelParameters:o,modelRouteName:n,promptParameters:ce,modelOutput:X,runName:S,modelOutputParameters:ee})).then((()=>{y(),a(),Q(!1),D("ARTIFACT")})).catch((e=>{c.A.logErrorAndNotifyUser((null===e||void 0===e?void 0:e.message)||e),Q(!1)}))},"data-testid":"button-create-run",type:"primary",disabled:!Fe,children:(0,x.Y)(d.A,{id:"8Uwpjw",defaultMessage:"Create run"})})})]}),title:(0,x.FD)("div",{children:[(0,x.Y)(o.T.Title,{level:2,css:(0,n.AH)({marginTop:w.spacing.sm,marginBottom:w.spacing.xs},""),children:(0,x.Y)(d.A,{id:"sLhmy7",defaultMessage:"New run"})}),(0,x.Y)(o.T.Hint,{css:q,children:"Create a new run using a large-language model by giving it a prompt template and model parameters"})]}),dangerouslySetAntdProps:{width:1200},children:[(0,x.FD)("div",{css:O,children:[(0,x.FD)("div",{children:[(0,x.Y)(r.D$Q.Label,{htmlFor:"selected_model",css:(0,n.AH)({marginBottom:w.spacing.sm},""),children:Ae}),(0,x.Y)("div",{css:(0,n.AH)({marginBottom:w.spacing.lg,display:"flex",alignItems:"center"},""),children:(0,x.FD)(r.AYc,{label:Ae,modal:!1,value:F?[(Ee=F,Ee.includes(":")?Ee.split(":")[1]:Ee)]:void 0,children:[(0,x.Y)(r.gGe,{id:"selected_model",css:$,allowClear:!1,placeholder:Me,withInlineLabel:!1}),(0,x.Y)(r.dn6,{loading:Ye,maxHeight:400,matchTriggerWidth:!0,children:!Ye&&(0,x.Y)(r.HI_,{children:(0,x.Y)(r.dhl,{autoFocus:!0,children:be.map((e=>(0,x.FD)(r.crD,{value:e.key,onChange:e=>{I(e)},checked:F===e.key,children:[e.name,e.mlflowDeployment&&(0,x.Y)(r.b5C,{children:e.mlflowDeployment.model.name})]},e.key)))})})})]})}),F&&(0,x.Y)(A,{parameters:M,updateParameter:T}),(0,x.Y)("div",{css:U.formItem,children:(0,x.FD)(x.FK,{children:[(0,x.FD)(r.D$Q.Label,{htmlFor:"new_run_name",children:[(0,x.Y)(d.A,{id:"Zqj4VA",defaultMessage:"New run name"}),!S.trim()&&(0,x.Y)(r.D$Q.Message,{type:"error",message:le.formatMessage({id:"dYbJha",defaultMessage:"Please provide run name"})})]}),(0,x.Y)(o.f,{id:"new_run_name","data-testid":"run-name-input",required:!0,value:S,onChange:e=>H(e.target.value)})]})})]}),(0,x.FD)("div",{children:[(0,x.FD)("div",{css:U.formItem,children:[(0,x.FD)(x.FK,{children:[(0,x.FD)("div",{css:K,children:[(0,x.Y)(r.D$Q.Label,{htmlFor:"prompt_template",children:(0,x.Y)(d.A,{id:"uBTAtY",defaultMessage:"Prompt Template"})}),(0,x.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_695",onClick:()=>re(!0),style:{marginLeft:"auto"},size:"small",children:(0,x.Y)(d.A,{id:"13vJft",defaultMessage:"View Examples"})})]}),(0,x.Y)(r.D$Q.Hint,{children:(0,x.Y)(d.A,{id:"gC2Kxm",defaultMessage:"Give instructions to the model. Use '{{ }}' or the \"Add new variable\" button to add variables to your prompt."})})]}),(0,x.Y)(B,{id:"prompt_template",autoSize:{minRows:3},"data-testid":"prompt-template-input",value:ve,onChange:e=>_e(e.target.value),ref:fe}),(0,x.Y)(C,{violations:pe})]}),me.map((e=>(0,x.Y)("div",{css:U.formItem,children:(0,x.FD)(x.FK,{children:[(0,x.Y)(r.D$Q.Label,{htmlFor:e,children:(0,x.Y)("span",{children:e})}),(0,x.Y)(B,{id:e,autoSize:!0,value:ce[e]?ce[e]:"",onChange:t=>ue(e,t.target.value)})]})},e))),(0,x.Y)("div",{css:(0,n.AH)({marginBottom:2*w.spacing.md},""),children:(0,x.Y)(o.B,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluation-artifacts-compare_evaluationcreatepromptrunmodal.tsx_736",icon:(0,x.Y)(r.c11,{}),onClick:he,children:(0,x.Y)(d.A,{id:"71hvMu",defaultMessage:"Add new variable"})})}),(0,x.Y)(P,{evaluateButtonTooltip:Se,evaluationMetadata:ee,evaluationOutput:X,disabled:!Ce,isEvaluating:j,isOutputDirty:ae,onCancelClick:we,onEvaluateClick:xe,evaluationError:W})]})]}),L&&(0,x.Y)("div",{css:(0,n.AH)({inset:0,backgroundColor:w.colors.overlayOverlay,position:"absolute",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1},""),children:(0,x.Y)(o.S,{})})]});var Ee},U={formItem:{marginBottom:16}}}}]);