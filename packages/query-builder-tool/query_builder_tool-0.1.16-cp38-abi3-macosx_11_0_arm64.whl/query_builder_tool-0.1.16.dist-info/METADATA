Metadata-Version: 2.4
Name: query-builder-tool
Version: 0.1.16
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: MacOS
Classifier: Operating System :: MacOS :: MacOS X
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Rust
Classifier: Topic :: Database
Classifier: Topic :: Security
Classifier: Topic :: Software Development :: Libraries :: Python Modules
License-File: LICENSE
Summary: A secure SQL query builder for Python using Rust and pyo3. Supports dynamic templates with safety checks against SQL injection.
Keywords: sql,query,builder,security,rust,pyo3
Author-email: ç¼ªå…‹æ‹‰ <2972799448@qq.com>
Requires-Python: >=3.8, <3.13
Description-Content-Type: text/markdown; charset=UTF-8; variant=GFM
Project-URL: Homepage, https://github.com/miaokela/query-builder
Project-URL: Repository, https://github.com/miaokela/query-builder
Project-URL: Documentation, https://github.com/miaokela/query-builder#readme
Project-URL: Bug Tracker, https://github.com/miaokela/query-builder/issues

# Query Builder

ä¸€ä¸ªå®‰å…¨çš„SQLæŸ¥è¯¢æ„å»ºå™¨ï¼Œä½¿ç”¨Rust + PyO3å¼€å‘ï¼Œä¸ºPythonæä¾›é«˜æ€§èƒ½çš„SQLæ¨¡æ¿æ¸²æŸ“åŠŸèƒ½ã€‚

## ğŸš€ ç‰¹æ€§

- **é«˜æ€§èƒ½**: ä½¿ç”¨Rustå¼€å‘ï¼Œæä¾›åŸç”Ÿçº§åˆ«çš„æ€§èƒ½
- **å®‰å…¨ç¬¬ä¸€**: å†…ç½®SQLæ³¨å…¥é˜²æŠ¤å’Œå±é™©å…³é”®è¯æ£€æµ‹
- **æ¨¡æ¿å¼•æ“**: åŸºäºTeraæ¨¡æ¿å¼•æ“ï¼Œæ”¯æŒæ¡ä»¶è¯­å¥ã€å¾ªç¯ç­‰é«˜çº§åŠŸèƒ½
- **æ˜“äºä½¿ç”¨**: ç®€å•çš„Python APIï¼Œæ— ç¼é›†æˆåˆ°ç°æœ‰é¡¹ç›®
- **è·¨å¹³å°**: æ”¯æŒmacOSã€Windowsã€Linuxå¤šå¹³å°

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **ä»…æ”¯æŒ SELECT æŸ¥è¯¢** - ä¸¥æ ¼é™åˆ¶åªèƒ½æ„é€ æŸ¥è¯¢è¯­å¥
- **SQL æ³¨å…¥é˜²æŠ¤** - æ£€æµ‹å’Œé˜»æ­¢å¸¸è§çš„ SQL æ³¨å…¥æ”»å‡»æ¨¡å¼
- **å±é™©å…³é”®è¯è¿‡æ»¤** - é˜»æ­¢ DROPã€UPDATEã€DELETE ç­‰å±é™©æ“ä½œ
- **æ¨¡å¼åŒ¹é…æ£€æµ‹** - è¯†åˆ«æ³¨é‡Šæ³¨å…¥ã€UNION æ³¨å…¥ç­‰æ”»å‡»

## ï¿½ å®‰è£…

```bash
pip install query-builder
```

## ï¿½ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºSQLæ¨¡æ¿æ–‡ä»¶

åˆ›å»ºä¸€ä¸ªYAMLæ–‡ä»¶æ¥å­˜å‚¨ä½ çš„SQLæ¨¡æ¿ï¼ˆä¾‹å¦‚ï¼š`queries.yaml`ï¼‰ï¼š

```yaml
get_users: |
  SELECT id, name, email, created_at 
  FROM users 
  WHERE status = "{{ status }}"
  {% if limit %}LIMIT {{ limit }}{% endif %};

get_user_by_id: |
  SELECT * FROM users WHERE id = {{ user_id }};

search_users: |
  SELECT id, name, email 
  FROM users 
  WHERE name LIKE "%{{ keyword }}%" 
  AND status = "{{ status }}"
  ORDER BY created_at DESC
  {% if limit %}LIMIT {{ limit }}{% endif %};
```

### 2. åŸºæœ¬ç”¨æ³•

```python
import query_builder

# åˆ›å»ºæŸ¥è¯¢æ„å»ºå™¨
qb = query_builder.PyQueryBuilder()

# è®¾ç½®SQLæ¨¡æ¿æ–‡ä»¶å¤¹çš„ç»å¯¹è·¯å¾„
qb.sql_path = "/path/to/your/sql/templates"

# æ„é€ ç®€å•æŸ¥è¯¢
sql = qb.build("queries.get_user_by_id", {"user_id": 123})
print(sql)  # SELECT * FROM users WHERE id = 123;

# æ„é€ å¸¦æ¡ä»¶çš„æŸ¥è¯¢
sql = qb.build("queries.get_users", {
    "status": "active",
    "limit": 10
})
print(sql)

# æ„é€ æœç´¢æŸ¥è¯¢
sql = qb.build("queries.search_users", {
    "keyword": "john",
    "status": "active",
    "limit": 20
})
print(sql)
```

## ï¿½ æ¨¡æ¿è¯­æ³•

Query Builderä½¿ç”¨Teraæ¨¡æ¿å¼•æ“ï¼Œæ”¯æŒä»¥ä¸‹è¯­æ³•ï¼š

### å˜é‡æ›¿æ¢
```sql
SELECT * FROM users WHERE id = {{ user_id }};
```

### æ¡ä»¶è¯­å¥
```sql
SELECT * FROM products 
WHERE category = "{{ category }}"
{% if min_price %}AND price >= {{ min_price }}{% endif %}
{% if max_price %}AND price <= {{ max_price }}{% endif %};
```

### å¾ªç¯
```sql
SELECT * FROM users 
WHERE id IN ({% for id in user_ids %}{{ id }}{% if not loop.last %},{% endif %}{% endfor %});
```

### å­—ç¬¦ä¸²å¤„ç†
```sql
SELECT * FROM users 
WHERE name LIKE "%{{ keyword | lower }}%";
```

## ï¿½ğŸ›¡ï¸ å®‰å…¨æ£€æŸ¥

ä»¥ä¸‹ç±»å‹çš„ SQL ä¼šè¢«è‡ªåŠ¨é˜»æ­¢ï¼š

- é SELECT è¯­å¥ï¼ˆUPDATEã€DELETEã€INSERT ç­‰ï¼‰
- åŒ…å«å±é™©å…³é”®è¯ï¼ˆDROPã€TRUNCATEã€EXEC ç­‰ï¼‰
- SQL æ³¨å…¥æ”»å‡»æ¨¡å¼ï¼ˆæ³¨é‡Šæ³¨å…¥ã€UNION æ³¨å…¥ç­‰ï¼‰
- è„šæœ¬æ³¨å…¥æ”»å‡»ï¼ˆJavaScriptã€VBScript ç­‰ï¼‰

## ğŸ”’ å®‰å…¨ç¤ºä¾‹

Query Builderä¼šè‡ªåŠ¨é˜»æ­¢å±é™©çš„SQLæ“ä½œï¼š

```python
# âŒ è¿™äº›æ“ä½œä¼šè¢«é˜»æ­¢
qb.build('malicious', {'query': 'DROP TABLE users;'})  # æŠ›å‡ºå®‰å…¨å¼‚å¸¸
qb.build('dangerous', {'action': 'DELETE FROM users'})  # æŠ›å‡ºå®‰å…¨å¼‚å¸¸

# âœ… åªå…è®¸å®‰å…¨çš„SELECTæŸ¥è¯¢
qb.build('safe_query', {'user_id': 123})  # æ­£å¸¸å·¥ä½œ
```

## ğŸ› ï¸ å¼€å‘

### æœ¬åœ°æ„å»º

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/miaokela/query-builder.git
cd query-builder

# å®‰è£…ä¾èµ–
pip install maturin pyyaml

# å¼€å‘æ¨¡å¼æ„å»º
maturin develop

# è¿è¡Œæµ‹è¯•
python test_local.py
```

### æµ‹è¯•

```bash
# è¿è¡Œæœ¬åœ°åŠŸèƒ½æµ‹è¯•
python test_local.py

# æµ‹è¯•è¾“å‡ºç¤ºä¾‹
python -c "
import query_builder
qb = query_builder.PyQueryBuilder()
print('Query Builder æ­£å¸¸å·¥ä½œï¼')
"
```

## ğŸ“‹ APIå‚è€ƒ

### PyQueryBuilder ç±»

#### å±æ€§
- `sql_path`: è®¾ç½®SQLæ¨¡æ¿æ–‡ä»¶çš„ç›®å½•è·¯å¾„

#### æ–¹æ³•
- `build(key: str, kwargs: dict) -> str`: æ„å»ºSQLæŸ¥è¯¢
  - `key`: æ¨¡æ¿é”®åï¼ˆæ ¼å¼ï¼š`æ–‡ä»¶å.æ¨¡æ¿å`ï¼‰
  - `kwargs`: æ¨¡æ¿å˜é‡å­—å…¸
  - è¿”å›: æ¸²æŸ“åçš„SQLå­—ç¬¦ä¸²

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
query-builder/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ lib.rs              # Rustæ ¸å¿ƒä»£ç 
â”œâ”€â”€ sql/                    # SQLæ¨¡æ¿ç¤ºä¾‹
â”‚   â””â”€â”€ queries.yaml
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ build.yml       # CI/CDé…ç½®
â”œâ”€â”€ Cargo.toml              # Rustä¾èµ–é…ç½®
â”œâ”€â”€ pyproject.toml          # PythonåŒ…é…ç½®
â”œâ”€â”€ test_local.py           # æœ¬åœ°æµ‹è¯•è„šæœ¬
â”œâ”€â”€ BUILD_FIX_SUMMARY.md    # æ„å»ºä¿®å¤æ–‡æ¡£
â””â”€â”€ README.md
```

## ğŸš¦ CI/CDçŠ¶æ€

- âœ… è‡ªåŠ¨åŒ–æ„å»ºæ”¯æŒmacOSï¼ˆx86_64 + ARM64ï¼‰ã€Windows x64ã€Linux x64
- âœ… æ”¯æŒPython 3.8-3.12
- âœ… è‡ªåŠ¨å‘å¸ƒåˆ°PyPI
- âœ… å…¨é¢çš„å®‰å…¨æµ‹è¯•

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼è¯·ç¡®ä¿ï¼š

1. æ‰€æœ‰æµ‹è¯•é€šè¿‡
2. éµå¾ªå®‰å…¨ç¼–ç è§„èŒƒ
3. æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“ è”ç³»

- ä½œè€…: ç¼ªå…‹æ‹‰
- é‚®ç®±: 2972799448@qq.com
- GitHub: https://github.com/miaokela/query-builder

## ğŸ™ è‡´è°¢

- [PyO3](https://github.com/PyO3/pyo3) - ä¼˜ç§€çš„Rust-Pythonç»‘å®šåº“
- [Tera](https://github.com/Keats/tera) - å¼ºå¤§çš„æ¨¡æ¿å¼•æ“
- [maturin](https://github.com/PyO3/maturin) - PythonåŒ…æ„å»ºå·¥å…·

