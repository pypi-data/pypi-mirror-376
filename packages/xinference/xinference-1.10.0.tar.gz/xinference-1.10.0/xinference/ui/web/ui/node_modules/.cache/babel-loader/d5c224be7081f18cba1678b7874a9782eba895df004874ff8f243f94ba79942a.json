{"ast":null,"code":"import _toConsumableArray from\"/home/runner/work/inference/inference/xinference/ui/web/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/home/runner/work/inference/inference/xinference/ui/web/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import FilterNoneIcon from'@mui/icons-material/FilterNone';import{Alert,Snackbar,Tooltip}from'@mui/material';import ClipboardJS from'clipboard';import React,{useEffect,useRef,useState}from'react';import{useTranslation}from'react-i18next';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var keyMap={model_size_in_billions:'--size-in-billions',download_hub:'--download_hub',enable_thinking:'--enable_thinking',reasoning_content:'--reasoning_content',lightning_version:'--lightning_version',lightning_model_path:'--lightning_model_path'};function CopyComponent(_ref){var modelData=_ref.modelData,predefinedKeys=_ref.predefinedKeys;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isCopySuccess=_useState2[0],setIsCopySuccess=_useState2[1];var copyRef=useRef(null);var generateCommandLineStatement=function generateCommandLineStatement(params){var args=Object.entries(params).filter(function(_ref2){var _ref3=_slicedToArray(_ref2,2),key=_ref3[0],value=_ref3[1];return predefinedKeys.includes(key)&&value!==null&&value!==undefined||!predefinedKeys.includes(key);}).flatMap(function(_ref4){var _ref5=_slicedToArray(_ref4,2),key=_ref5[0],value=_ref5[1];if(key==='gpu_idx'&&Array.isArray(value)){return\"--gpu-idx \".concat(value.join(','));}else if(key==='peft_model_config'&&typeof value==='object'){var peftArgs=[];if(value.lora_list){peftArgs.push.apply(peftArgs,_toConsumableArray(value.lora_list.map(function(lora){return\"--lora-modules \".concat(lora.lora_name,\" \").concat(lora.local_path);})));}if(value.image_lora_load_kwargs){peftArgs.push.apply(peftArgs,_toConsumableArray(Object.entries(value.image_lora_load_kwargs).map(function(_ref6){var _ref7=_slicedToArray(_ref6,2),k=_ref7[0],v=_ref7[1];return\"--image-lora-load-kwargs \".concat(k,\" \").concat(v);})));}if(value.image_lora_fuse_kwargs){peftArgs.push.apply(peftArgs,_toConsumableArray(Object.entries(value.image_lora_fuse_kwargs).map(function(_ref8){var _ref9=_slicedToArray(_ref8,2),k=_ref9[0],v=_ref9[1];return\"--image-lora-fuse-kwargs \".concat(k,\" \").concat(v);})));}return peftArgs;}else if(key==='quantization_config'&&typeof value==='object'){return Object.entries(value).map(function(_ref10){var _ref11=_slicedToArray(_ref10,2),k=_ref11[0],v=_ref11[1];return\"--quantization-config \".concat(k,\" \").concat(v===null?'none':v);});}else if(key==='envs'&&typeof value==='object'){return Object.entries(value).map(function(_ref12){var _ref13=_slicedToArray(_ref12,2),k=_ref13[0],v=_ref13[1];return\"--env \".concat(k,\" \").concat(v);});}else if(key==='virtual_env_packages'&&Array.isArray(value)){return value.map(function(pkg){return\"--virtual-env-package \".concat(pkg);});}else if(key==='enable_virtual_env'){if(value===true)return\"--enable-virtual-env\";if(value===false)return\"--disable-virtual-env\";return[];}else if(predefinedKeys.includes(key)){var _keyMap$key;var newKey=(_keyMap$key=keyMap[key])!==null&&_keyMap$key!==void 0?_keyMap$key:\"--\".concat(key.replace(/_/g,'-'));return\"\".concat(newKey,\" \").concat(value===false?'false':value===null?'none':value);}else{return\"--\".concat(key,\" \").concat(value===false?'false':value===null?'none':value);}}).join(' ');return\"xinference launch \".concat(args);};useEffect(function(){var _text=generateCommandLineStatement(modelData);var clipboard=new ClipboardJS(copyRef.current,{text:function text(){return _text;}});clipboard.on('success',function(e){e.clearSelection();setIsCopySuccess(true);});var handleClick=function handleClick(event){event.stopPropagation();copyRef.current.focus();};var copy=copyRef.current;copy.addEventListener('click',handleClick);return function(){clipboard.destroy();copy.removeEventListener('click',handleClick);};},[modelData]);return/*#__PURE__*/_jsxs(\"div\",{style:{marginInline:'10px',lineHeight:'14px'},children:[/*#__PURE__*/_jsx(Tooltip,{title:t('launchModel.copyToCommandLine'),placement:\"top\",children:/*#__PURE__*/_jsx(\"div\",{ref:copyRef,children:/*#__PURE__*/_jsx(FilterNoneIcon,{className:\"copyToCommandLine\"})})}),/*#__PURE__*/_jsx(Snackbar,{anchorOrigin:{vertical:'top',horizontal:'center'},open:isCopySuccess,autoHideDuration:1500,onClose:function onClose(){return setIsCopySuccess(false);},children:/*#__PURE__*/_jsx(Alert,{severity:\"success\",variant:\"filled\",sx:{width:'100%'},children:t('components.copySuccess')})})]});}export default CopyComponent;","map":{"version":3,"names":["FilterNoneIcon","Alert","Snackbar","Tooltip","ClipboardJS","React","useEffect","useRef","useState","useTranslation","jsx","_jsx","jsxs","_jsxs","keyMap","model_size_in_billions","download_hub","enable_thinking","reasoning_content","lightning_version","lightning_model_path","CopyComponent","_ref","modelData","predefinedKeys","_useTranslation","t","_useState","_useState2","_slicedToArray","isCopySuccess","setIsCopySuccess","copyRef","generateCommandLineStatement","params","args","Object","entries","filter","_ref2","_ref3","key","value","includes","undefined","flatMap","_ref4","_ref5","Array","isArray","concat","join","peftArgs","lora_list","push","apply","_toConsumableArray","map","lora","lora_name","local_path","image_lora_load_kwargs","_ref6","_ref7","k","v","image_lora_fuse_kwargs","_ref8","_ref9","_ref10","_ref11","_ref12","_ref13","pkg","_keyMap$key","newKey","replace","text","clipboard","current","on","e","clearSelection","handleClick","event","stopPropagation","focus","copy","addEventListener","destroy","removeEventListener","style","marginInline","lineHeight","children","title","placement","ref","className","anchorOrigin","vertical","horizontal","open","autoHideDuration","onClose","severity","variant","sx","width"],"sources":["/home/runner/work/inference/inference/xinference/ui/web/ui/src/scenes/launch_model/components/copyComponent.js"],"sourcesContent":["import FilterNoneIcon from '@mui/icons-material/FilterNone'\nimport { Alert, Snackbar, Tooltip } from '@mui/material'\nimport ClipboardJS from 'clipboard'\nimport React, { useEffect, useRef, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\n\nconst keyMap = {\n  model_size_in_billions: '--size-in-billions',\n  download_hub: '--download_hub',\n  enable_thinking: '--enable_thinking',\n  reasoning_content: '--reasoning_content',\n  lightning_version: '--lightning_version',\n  lightning_model_path: '--lightning_model_path',\n}\n\nfunction CopyComponent({ modelData, predefinedKeys }) {\n  const { t } = useTranslation()\n  const [isCopySuccess, setIsCopySuccess] = useState(false)\n  const copyRef = useRef(null)\n\n  const generateCommandLineStatement = (params) => {\n    const args = Object.entries(params)\n      .filter(\n        ([key, value]) =>\n          (predefinedKeys.includes(key) &&\n            value !== null &&\n            value !== undefined) ||\n          !predefinedKeys.includes(key)\n      )\n      .flatMap(([key, value]) => {\n        if (key === 'gpu_idx' && Array.isArray(value)) {\n          return `--gpu-idx ${value.join(',')}`\n        } else if (key === 'peft_model_config' && typeof value === 'object') {\n          const peftArgs = []\n          if (value.lora_list) {\n            peftArgs.push(\n              ...value.lora_list.map(\n                (lora) => `--lora-modules ${lora.lora_name} ${lora.local_path}`\n              )\n            )\n          }\n          if (value.image_lora_load_kwargs) {\n            peftArgs.push(\n              ...Object.entries(value.image_lora_load_kwargs).map(\n                ([k, v]) => `--image-lora-load-kwargs ${k} ${v}`\n              )\n            )\n          }\n          if (value.image_lora_fuse_kwargs) {\n            peftArgs.push(\n              ...Object.entries(value.image_lora_fuse_kwargs).map(\n                ([k, v]) => `--image-lora-fuse-kwargs ${k} ${v}`\n              )\n            )\n          }\n          return peftArgs\n        } else if (key === 'quantization_config' && typeof value === 'object') {\n          return Object.entries(value).map(\n            ([k, v]) => `--quantization-config ${k} ${v === null ? 'none' : v}`\n          )\n        } else if (key === 'envs' && typeof value === 'object') {\n          return Object.entries(value).map(([k, v]) => `--env ${k} ${v}`)\n        } else if (key === 'virtual_env_packages' && Array.isArray(value)) {\n          return value.map((pkg) => `--virtual-env-package ${pkg}`)\n        } else if (key === 'enable_virtual_env') {\n          if (value === true) return `--enable-virtual-env`\n          if (value === false) return `--disable-virtual-env`\n          return []\n        } else if (predefinedKeys.includes(key)) {\n          const newKey = keyMap[key] ?? `--${key.replace(/_/g, '-')}`\n          return `${newKey} ${\n            value === false ? 'false' : value === null ? 'none' : value\n          }`\n        } else {\n          return `--${key} ${\n            value === false ? 'false' : value === null ? 'none' : value\n          }`\n        }\n      })\n      .join(' ')\n\n    return `xinference launch ${args}`\n  }\n\n  useEffect(() => {\n    const text = generateCommandLineStatement(modelData)\n    const clipboard = new ClipboardJS(copyRef.current, {\n      text: () => text,\n    })\n\n    clipboard.on('success', (e) => {\n      e.clearSelection()\n      setIsCopySuccess(true)\n    })\n\n    const handleClick = (event) => {\n      event.stopPropagation()\n      copyRef.current.focus()\n    }\n\n    const copy = copyRef.current\n    copy.addEventListener('click', handleClick)\n\n    return () => {\n      clipboard.destroy()\n      copy.removeEventListener('click', handleClick)\n    }\n  }, [modelData])\n\n  return (\n    <div style={{ marginInline: '10px', lineHeight: '14px' }}>\n      <Tooltip title={t('launchModel.copyToCommandLine')} placement=\"top\">\n        <div ref={copyRef}>\n          <FilterNoneIcon className=\"copyToCommandLine\" />\n        </div>\n      </Tooltip>\n      <Snackbar\n        anchorOrigin={{ vertical: 'top', horizontal: 'center' }}\n        open={isCopySuccess}\n        autoHideDuration={1500}\n        onClose={() => setIsCopySuccess(false)}\n      >\n        <Alert severity=\"success\" variant=\"filled\" sx={{ width: '100%' }}>\n          {t('components.copySuccess')}\n        </Alert>\n      </Snackbar>\n    </div>\n  )\n}\n\nexport default CopyComponent\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}