# MySQL多数据库配置说明

## 🎯 解决方案

为了支持跨库查询，我们采用以下方案：

### 1. 配置方式

在 `mcp_config.json` 中使用 `MYSQL_DATABASES` 环境变量：

```json
{
  "mcpServers": {
    "alibaba-bailian-mysql-service": {
      "command": "python",
      "args": ["g:/lc_mcp_server/mysql_mcp_server.py"],
      "env": {
        "MYSQL_HOST": "192.168.2.182",
        "MYSQL_PORT": "3306",
        "MYSQL_USER": "dpt_dev",
        "MYSQL_PASSWORD": "dev20161111",
        "MYSQL_DATABASES": "dpt_e-commerce,sso"
      }
    }
  }
}
```

### 2. 技术实现

- **不指定默认数据库**：MySQL连接时不设置默认数据库
- **完整数据库名**：SQL查询中使用 `数据库名.表名` 格式
- **支持多库**：通过逗号分隔的方式支持多个数据库

### 3. SQL查询示例

```sql
-- 跨库查询示例
SELECT 
    u.userId as 用户ID,
    u.nickname as 用户昵称
FROM sso.sso_user_new u
LEFT JOIN sso.sso_user_rela r on r.id=u.userId
WHERE u.mobile=concat("hash0_",SHA2(%s, 256)) 
AND r.reg_sys="NLCW"
```

### 4. 优势

✅ **性能优化**：在SQL层面完成字段映射  
✅ **跨库支持**：支持多个数据库的联合查询  
✅ **中文字段**：返回数据包含中文字段说明  
✅ **灵活配置**：可以轻松添加更多数据库  

### 5. 支持的数据库

当前配置支持：
- `dpt_e-commerce` - 电商业务数据库
- `sso` - 用户认证数据库

### 6. 添加新数据库

如需添加新数据库，只需在 `MYSQL_DATABASES` 中用逗号分隔：

```json
"MYSQL_DATABASES": "dpt_e-commerce,sso,new_database"
```

### 7. 工具列表

1. **get_user_info_by_mobile** - 根据手机号查询用户（跨sso库）
2. **get_user_info_by_nickname** - 根据用户名查询用户（跨sso库）
3. **get_user_courses** - 查询用户课程（dpt_e-commerce库）
4. **get_user_cases** - 查询用户案例（dpt_e-commerce库）
5. **get_user_orders** - 查询用户订单（dpt_e-commerce库）
6. **get_user_invoices** - 查询用户发票（dpt_e-commerce库）
7. **get_user_study_plan_stats** - 查询加分计划统计（跨库查询）

## 🚀 使用方法

1. 确保MySQL用户有访问所有指定数据库的权限
2. 将配置导入MCP客户端
3. 开始使用跨库查询功能

现在你的MCP服务器完全支持多数据库跨库查询！