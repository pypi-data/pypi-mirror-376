// mypack.mdl - Advanced example showcasing supported MDL features
pack "Minecraft Datapack Language" "Example datapack" 82;
namespace "example";

// Global state variables
var num global_counter = 0;
var num global_timer = 0;

function "inner" {
    tellraw @s {"text":"[example:inner] This is the inner function"};
    tellraw @a {"text":"Running inner","color":"yellow"};
}

function "hello" {
    tellraw @s {"text":"[example:hello] Outer says hi"};
    function "example:inner";
    tellraw @a {"text":"Back in hello","color":"aqua"};
}

// Advanced variable operations with numbers
function "variable_demo" {
    var num local_counter = 10;
    var num player_score = 100;
    
    // Number operations
    local_counter = local_counter + 5;
    global_counter = global_counter + 1;
    player_score = player_score * 2;
    
    // Complex calculations
    var num result = (local_counter * 2) + global_counter;
    var num modulo_result = result % 7;
    
    tellraw @s {"text":"Variable demo complete"};
    tellraw @s {"text":"Result: " + result};
    tellraw @s {"text":"Modulo: " + modulo_result};
}

// Advanced conditional logic with nested structures
function "conditional_demo" {
    var num player_level = 15;
    var num player_class = 1; // 1=warrior, 2=mage, 3=archer
    var num experience = 75;
    
    if "$player_level$ >= 10" {
        if "$player_class$ == 1" {
            if "$experience$ >= 50" {
                tellraw @s {"text":"Advanced warrior detected!"};
                effect give @s minecraft:strength 10 2;
                effect give @s minecraft:glowing 10 0;
            } else {
                tellraw @s {"text":"Novice warrior"};
                effect give @s minecraft:haste 10 0;
            }
        } else if "$player_class$ == 2" {
            tellraw @s {"text":"Advanced mage detected!"};
            effect give @s minecraft:night_vision 10 0;
            effect give @s minecraft:levitation 5 0;
        } else {
            tellraw @s {"text":"Unknown advanced class"};
            effect give @s minecraft:glowing 10 0;
        }
    } else if "$player_level$ >= 5" {
        tellraw @s {"text":"Intermediate player"};
        effect give @s minecraft:speed 10 0;
    } else {
        tellraw @s {"text":"Beginner player"};
        effect give @s minecraft:jump_boost 10 0;
    }
}

// Advanced weapon effects with numbers
function "weapon_effects" {
    var num weapon_type = 0; // 0=diamond, 1=golden, 2=bow
    
    if "$weapon_type$ == 0" {
        tellraw @s {"text":"Diamond sword detected!"};
        effect give @s minecraft:strength 10 1;
        effect give @s minecraft:glowing 10 0;
    } else if "$weapon_type$ == 1" {
        tellraw @s {"text":"Golden sword detected!"};
        effect give @s minecraft:haste 10 1;
        effect give @s minecraft:speed 10 0;
    } else if "$weapon_type$ == 2" {
        tellraw @s {"text":"Bow detected!"};
        effect give @s minecraft:night_vision 10 0;
        effect give @s minecraft:jump_boost 10 0;
    }
}

// Advanced loop with complex logic
function "loop_demo" {
    var num i = 0;
    var num max_iterations = 10;
    
    while "$i$ < $max_iterations$" {
        if "$i$ % 2 == 0" {
            tellraw @s {"text":"Even iteration: " + i};
            global_counter = global_counter + 1;
        } else {
            tellraw @s {"text":"Odd iteration: " + i};
            global_timer = global_timer + 1;
        }
        
        i = i + 1;
        
        // Add a small delay to prevent spam
        if "$i$ % 5 == 0" {
            tellraw @s {"text":"Progress: " + i + "/" + max_iterations};
        }
    }
    
    tellraw @s {"text":"Loop complete! Final counter: " + global_counter};
}

// Scoreboard operations
function "scoreboard_demo" {
    var num player_score = 0;
    var num target_score = 100;
    
    // Set initial score
    player_score = 50;
    
    // Increase score until target
    while "$player_score$ < $target_score$" {
        player_score = player_score + 10;
        
        if "$player_score$ >= $target_score$" {
            tellraw @s {"text":"Target score reached!"};
            break;
        }
        
        tellraw @s {"text":"Current score: " + player_score};
    }
    
    tellraw @s {"text":"Final score: " + player_score};
}

// Main function that runs all demos
function "main" {
    tellraw @s {"text":"Starting MDL feature demonstration"};
    
    function "example:variable_demo";
    function "example:conditional_demo";
    function "example:weapon_effects";
    function "example:loop_demo";
    function "example:scoreboard_demo";
    
    tellraw @s {"text":"All demonstrations complete!"};
}

// Load function - runs when datapack loads
function "load" {
    tellraw @a {"text":"[GAME] MDL Example Pack loaded successfully!"};
    tellraw @a {"text":"Type: /function example:main"};
}

// Tick function - runs every tick
function "tick" {
    global_timer = global_timer + 1;
    
    // Run main function every 20 seconds (400 ticks)
    if "$global_timer$ % 400 == 0" {
        function "example:main";
    }
}

// Hook to run load function on datapack load
on_load "example:load";

