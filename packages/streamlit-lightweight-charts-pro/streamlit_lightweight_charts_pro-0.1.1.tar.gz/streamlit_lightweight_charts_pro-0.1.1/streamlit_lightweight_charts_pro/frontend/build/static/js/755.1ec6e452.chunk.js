"use strict";(self.webpackChunkstreamlit_lightweight_charts_pro=self.webpackChunkstreamlit_lightweight_charts_pro||[]).push([[755],{3755:(t,e,i)=>{i.r(e),i.d(e,{TooltipPlugin:()=>r,createTooltipPlugin:()=>s});var o=i(1443),n=i(2823);class r{constructor(t,e,i){this.chart=void 0,this.container=void 0,this.tooltipElement=null,this.configs=new Map,this.currentData=null,this.isVisible=!1,this.chartId=void 0,this.coordinateService=void 0,this.tradeData=new Map,this.chart=t,this.container=e,this.chartId=i,this.coordinateService=o.Y.getInstance(),this.coordinateService.registerChart(this.chartId,this.chart),this.setupEventListeners()}updateContent(t){this.tooltipElement&&(this.tooltipElement.innerHTML=t)}setPosition(t){this.positionTooltip(t)}formatSeriesData(t){if(!t||0===t.size)return"";let e="";return t.forEach((t,i)=>{e+="<div>".concat(i,": ").concat(JSON.stringify(t),"</div>")}),e}formatPrice(t){return t.toFixed(2)}handleMouseEnter(t){}handleMouseLeave(t){this.hideTooltip()}handleMouseMove(t){}constrainToViewport(t){const e=window.innerWidth,i=window.innerHeight;return{x:Math.min(Math.max(t.x,0),e-200),y:Math.min(Math.max(t.y,0),i-100)}}getAbsolutePosition(t){const e=this.container.getBoundingClientRect();return{x:e.left+t.x,y:e.top+t.y}}cleanup(){this.hideTooltip(),this.tooltipElement&&this.tooltipElement.parentNode&&this.tooltipElement.parentNode.removeChild(this.tooltipElement)}remove(){this.cleanup()}addToChart(t,e){}addConfig(t,e){this.configs.set(t,e)}removeConfig(t){return this.configs.delete(t)}getConfig(t){return this.configs.get(t)}addTradeData(t,e){this.tradeData.set(t,e)}removeTradeData(t){return this.tradeData.delete(t)}setupEventListeners(){this.chart&&"function"==typeof this.chart.subscribeCrosshairMove&&this.chart.subscribeCrosshairMove(t=>{t.time&&t.seriesData.size>0?this.handleCrosshairMove(t):this.hideTooltip()}),this.chart&&"function"==typeof this.chart.subscribeClick&&this.chart.subscribeClick(()=>{this.hideTooltip()})}handleCrosshairMove(t){if(!this.isVisible)return;const[e,i]=t.seriesData.entries().next().value;if(!e||!i)return void this.hideTooltip();if(!this.isValidOHLCData(i))return void this.hideTooltip();const o=this.detectTradeAtPosition(t);o?this.showTradeTooltip(o,t):this.showTooltip(t)}detectTradeAtPosition(t){if(!t.point||!t.time)return null;const e=t.point.x,i=t.point.y;return 0===this.tradeData.size?null:this.findTradeAtCoordinates(e,i,{})}findTradeAtCoordinates(t,e,i){for(const[,o]of this.tradeData.entries())if(this.isPointInTrade(t,e,o,i))return o;return null}isValidOHLCData(t){return!(void 0===t.open||void 0===t.high||void 0===t.low||void 0===t.close||"number"!=typeof t.open||"number"!=typeof t.high||"number"!=typeof t.low||"number"!=typeof t.close||t.high<t.low||t.high<t.open||t.high<t.close||t.low>t.open||t.low>t.close)}isPointInTrade(t,e,i,o){try{const o=this.chart.timeScale(),n=o.timeToCoordinate(i.entryTime),r=o.timeToCoordinate(i.exitTime);if(null===n||null===r)return!1;if(Math.min(n,r)>t||t>Math.max(n,r))return!1;const s=this.container.clientHeight,a=s/2,l=.4*s;return!(a-l>e||e>a+l)}catch(n){return!1}}showTradeTooltip(t,e){this.tooltipElement||this.ensureTooltipElement();const i={time:e.time,series:e.seriesData.entries().next().value[0],data:e.seriesData.entries().next().value[1],price:e.price||t.exitPrice||0,index:e.index||0,trade:{entryPrice:t.entryPrice,exitPrice:t.exitPrice,size:t.size,pnl:t.pnl,side:t.side,entryTime:t.entryTime,exitTime:t.exitTime}};this.currentData=i,this.updateTooltipContent(),this.positionTradeTooltip(e.point,t)}positionTradeTooltip(t,e){if(!this.tooltipElement||!t)return;if(!this.getDefaultConfig())return;const i=this.container.getBoundingClientRect(),o=this.tooltipElement.offsetWidth||200,r=this.tooltipElement.offsetHeight||100,s=n.PositioningEngine.calculateTooltipPosition(t.x,t.y,o,r,{x:0,y:0,left:0,top:0,right:i.width,bottom:i.height,width:i.width,height:i.height},"top");n.PositioningEngine.applyPositionToElement(this.tooltipElement,{top:s.y,left:s.x}),this.tooltipElement.style.display="block"}showTooltip(t){if(!this.isVisible||!t.time||0===t.seriesData.size)return;const[e,i]=t.seriesData.entries().next().value;if(!e||!i)return;const o={time:t.time,series:e,data:i,price:t.price||i.value||i.close||0,index:t.index||0};this.currentData=o,this.updateTooltipContent(),this.positionTooltip(t.point)}hideTooltip(){this.tooltipElement&&(this.tooltipElement.style.display="none"),this.currentData=null}ensureTooltipElement(){return this.tooltipElement||(this.tooltipElement=document.createElement("div"),this.tooltipElement.className="chart-tooltip",this.tooltipElement.style.cssText="\n        position: absolute;\n        z-index: 1000;\n        background-color: rgba(255, 255, 255, 0.95);\n        border: 1px solid #e1e3e6;\n        border-radius: 4px;\n        padding: 8px;\n        font-family: sans-serif;\n        font-size: 12px;\n        color: #131722;\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n        pointer-events: none;\n        user-select: none;\n        white-space: nowrap;\n        display: none;\n      ",this.container.appendChild(this.tooltipElement)),this.tooltipElement}updateTooltipContent(){if(!this.currentData)return;const t=this.ensureTooltipElement(),e=this.getDefaultConfig();if(!e||!e.enabled)return;const i=this.formatTooltipContent(e,this.currentData);t.innerHTML=i,e.style&&this.applyTooltipStyle(t,e.style)}formatTooltipContent(t,e){if(e.trade){const t=this.configs.get("trade");if(t)return this.formatTradeTooltip(t,e)}return t.template?this.formatWithTemplate(t,e):this.formatWithFields(t,e)}formatTradeTooltip(t,e){var i,o,n;if(!e.trade)return"";const r=e.trade,s="long"===r.side?"#00ff88":"#ff4444",a=0>r.pnl?"#ff4444":"#00ff88";return'\n      <div class="trade-tooltip">\n        <div class="trade-header" style="color: '.concat(s,'; font-weight: 600; margin-bottom: 8px;">\n          ').concat(r.side.toUpperCase(),' TRADE\n        </div>\n        <div class="trade-details" style="line-height: 1.4;">\n          <div>Entry: $').concat(null===(i=r.entryPrice)||void 0===i?void 0:i.toFixed(2),"</div>\n          <div>Exit: $").concat(null===(o=r.exitPrice)||void 0===o?void 0:o.toFixed(2),"</div>\n          <div>Size: ").concat(r.size,'</div>\n          <div style="color: ').concat(a,'; font-weight: 600;">\n            P&L: $').concat(null===(n=r.pnl)||void 0===n?void 0:n.toFixed(2),"\n          </div>\n        </div>\n      </div>\n    ")}formatWithTemplate(t,e){if(!t.template)return"";let i=t.template;const o=this.extractDataObject(e),n=Object.keys(o);for(let r=0;r<n.length;r++){const e=n[r],s=o[e],a="{".concat(e,"}");if(i.includes(a)){const o=this.formatValue(e,s,t);i=i.replace(RegExp(a,"g"),o)}}if((t.showDate||t.showTime)&&e.time){const o=this.formatTime(e.time,t);o&&(i="".concat(o,"<br>").concat(i))}return i}formatWithFields(t,e){const i=[];if((t.showDate||t.showTime)&&e.time){const o=this.formatTime(e.time,t);o&&i.push(o)}const o=this.extractDataObject(e);for(const n of t.fields)if(void 0!==o[n.valueKey]){const t=o[n.valueKey],e=this.formatFieldValue(n,t);i.push("".concat(n.label,": ").concat(e))}return i.join("<br>")}extractDataObject(t){const e={time:t.time,price:t.price,value:t.data.value,open:t.data.open,high:t.data.high,low:t.data.low,close:t.data.close,volume:t.data.volume,index:t.index};return Object.assign(e,t.data),e}formatValue(t,e,i){const o=i.fields.find(e=>e.valueKey===t);return o?this.formatFieldValue(o,e):e+""}formatFieldValue(t,e){let i=e+"";return void 0!==t.precision&&"number"==typeof e&&(i=e.toFixed(t.precision)),t.prefix&&(i="".concat(t.prefix).concat(i)),t.suffix&&(i="".concat(i).concat(t.suffix)),i}formatTime(t,e){try{const i=new Date(1e3*t),o=[];if(e.showDate){const t=e.dateFormat||"%Y-%m-%d";o.push(this.formatDate(i,t))}if(e.showTime){const t=e.timeFormat||"%H:%M:%S";o.push(this.formatTimeString(i,t))}return o.join(" ")}catch(i){return t+""}}formatDate(t,e){const i=t.getFullYear(),o=(t.getMonth()+1+"").padStart(2,"0"),n=(t.getDate()+"").padStart(2,"0");return e.replace("%Y",i+"").replace("%m",o).replace("%d",n)}formatTimeString(t,e){const i=(t.getHours()+"").padStart(2,"0"),o=(t.getMinutes()+"").padStart(2,"0"),n=(t.getSeconds()+"").padStart(2,"0");return e.replace("%H",i).replace("%M",o).replace("%S",n)}positionTooltip(t){if(!this.tooltipElement||!t)return;if(!this.getDefaultConfig())return;const e=this.container.getBoundingClientRect(),i=this.tooltipElement.offsetWidth||200,o=this.tooltipElement.offsetHeight||100,r=n.PositioningEngine.calculateTooltipPosition(t.x,t.y,i,o,{x:0,y:0,left:0,top:0,right:e.width,bottom:e.height,width:e.width,height:e.height},"top");n.PositioningEngine.applyPositionToElement(this.tooltipElement,{top:r.y,left:r.x}),this.tooltipElement.style.display="block"}applyTooltipStyle(t,e){e.backgroundColor&&(t.style.backgroundColor=e.backgroundColor),e.borderColor&&(t.style.borderColor=e.borderColor),void 0!==e.borderWidth&&(t.style.borderWidth="".concat(e.borderWidth,"px")),void 0!==e.borderRadius&&(t.style.borderRadius="".concat(e.borderRadius,"px")),void 0!==e.padding&&(t.style.padding="".concat(e.padding,"px")),void 0!==e.fontSize&&(t.style.fontSize="".concat(e.fontSize,"px")),e.fontFamily&&(t.style.fontFamily=e.fontFamily),e.color&&(t.style.color=e.color),e.boxShadow&&(t.style.boxShadow=e.boxShadow),void 0!==e.zIndex&&(t.style.zIndex=e.zIndex+"")}getDefaultConfig(){return this.configs.get("default")||this.configs.values().next().value}enable(){this.isVisible=!0}disable(){this.isVisible=!1,this.hideTooltip()}destroy(){this.tooltipElement&&(this.container.removeChild(this.tooltipElement),this.tooltipElement=null),this.coordinateService.unregisterChart(this.chartId),this.configs.clear(),this.currentData=null,this.tradeData.clear()}}function s(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4?arguments[4]:void 0;const s=new r(t,e,i);for(const[r,a]of Object.entries(o))s.addConfig(r,a);return n&&n.trades&&Array.isArray(n.trades)&&n.trades.forEach((t,e)=>{const i="trade_".concat(e);s.addTradeData(i,{entryTime:t.entry_time||t.entryTime,exitTime:t.exit_time||t.exitTime,entryPrice:t.entry_price||t.entryPrice,exitPrice:t.exit_price||t.exitPrice,size:t.quantity||t.size,pnl:(t.exit_price||t.exitPrice)-(t.entry_price||t.entryPrice),side:"LONG"===t.trade_type?"long":"short"})}),s}}}]);