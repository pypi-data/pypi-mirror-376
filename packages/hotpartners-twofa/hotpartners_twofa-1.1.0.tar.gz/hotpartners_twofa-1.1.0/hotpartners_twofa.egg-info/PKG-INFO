Metadata-Version: 2.1
Name: hotpartners-twofa
Version: 1.1.0
Summary: Two-Factor Authentication (2FA) package for HotPartners
Home-page: https://pypi.org/project/hotpartners-twofa/
Author: hotseller_devjun
Author-email: jypark@hotseller.co.kr
Project-URL: Homepage, https://pypi.org/project/hotpartners-twofa/
Keywords: 2fa two-factor authentication otp totp qr-code security
Classifier: Development Status :: 5 - Production/Stable
Classifier: Intended Audience :: Developers
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Topic :: Security
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: pyotp>=2.9.0
Requires-Dist: qrcode[pil]>=7.4.2
Requires-Dist: cryptography>=41.0.7
Requires-Dist: pillow>=11.3.0
Provides-Extra: dev
Requires-Dist: pytest>=6.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Requires-Dist: black>=22.0; extra == "dev"
Requires-Dist: flake8>=4.0; extra == "dev"
Requires-Dist: mypy>=0.950; extra == "dev"
Provides-Extra: docs
Requires-Dist: sphinx>=4.0; extra == "docs"
Requires-Dist: sphinx-rtd-theme>=1.0; extra == "docs"

# HotPartners 2FA Package

[![PyPI version](https://badge.fury.io/py/hotpartners-twofa.svg)](https://badge.fury.io/py/hotpartners-twofa)
[![Python Support](https://img.shields.io/pypi/pyversions/hotpartners-twofa.svg)](https://pypi.org/project/hotpartners-twofa/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

Two-Factor Authentication (2FA) íŒ¨í‚¤ì§€ë¡œ TOTP ê¸°ë°˜ ì¸ì¦ì„ ì œê³µí•©ë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥

- ğŸ” **TOTP ê¸°ë°˜ 2FA**: Google Authenticator, Authy ë“±ê³¼ í˜¸í™˜
- ğŸ“± **QR ì½”ë“œ ìƒì„±**: ëª¨ë°”ì¼ ì•± ì—°ë™ì„ ìœ„í•œ QR ì½”ë“œ ìë™ ìƒì„±
- ğŸ”‘ **ë°±ì—… ì½”ë“œ**: ì¼íšŒìš© ë°±ì—… ì½”ë“œ ìƒì„± ë° ê´€ë¦¬
- ğŸ›¡ï¸ **ì•”í˜¸í™” ì €ì¥**: ë¯¼ê°í•œ ë°ì´í„°ì˜ ì•ˆì „í•œ ì•”í˜¸í™” ì €ì¥
- ğŸ“Š **ë¡œê·¸ ê´€ë¦¬**: 2FA ì‚¬ìš© ì´ë ¥ ì¶”ì 
- ğŸ”„ **ë¹„ë™ê¸° ì§€ì›**: async/await íŒ¨í„´ ì™„ì „ ì§€ì›

## ì„¤ì¹˜

```bash
pip install hotpartners-twofa
```

## ë¹ ë¥¸ ì‹œì‘

### 1. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ì •

```bash
# CLI ë„êµ¬ë¡œ ìŠ¤í‚¤ë§ˆ ìƒì„±
hotpartners-twofa-setup --connection-string "postgresql://user:pass@localhost/db"

# ë˜ëŠ” Python ì½”ë“œë¡œ
from hotpartners_twofa.schema import TwoFASchemaManager

schema_manager = TwoFASchemaManager(connection_func)
await schema_manager.create_tables()
```

### 2. ê¸°ë³¸ ì‚¬ìš©ë²•

```python
import asyncio
from hotpartners_twofa import TwoFAService, AdminTwoFARepository, TwoFAConfig

async def main():
    # ì„¤ì •
    config = TwoFAConfig()
    repository = AdminTwoFARepository(config)
    service = TwoFAService(repository)

    # 2FA ì„¤ì •
    user_id = "user123"
    setup_result = await service.setup_2fa(user_id)

    print(f"QR ì½”ë“œ: {setup_result.qr_code}")
    print(f"ë°±ì—… ì½”ë“œ: {setup_result.backup_codes}")

    # 2FA ì¸ì¦
    token = "123456"  # ì‚¬ìš©ìê°€ ì…ë ¥í•œ 6ìë¦¬ ì½”ë“œ
    auth_result = await service.authenticate_2fa(user_id, token)

    if auth_result.success:
        print("2FA ì¸ì¦ ì„±ê³µ!")
    else:
        print(f"ì¸ì¦ ì‹¤íŒ¨: {auth_result.message}")

asyncio.run(main())
```

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### PostgreSQL

```sql
-- ì‚¬ìš©ì 2FA í…Œì´ë¸”
CREATE TABLE user_twofa (
    user_id VARCHAR(255) PRIMARY KEY,
    otp_secret TEXT,
    backup_codes TEXT,  -- JSON ë¬¸ìì—´
    is_2fa_enabled BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 2FA ì‚¬ìš© ë¡œê·¸
CREATE TABLE user_twofa_logs (
    id SERIAL PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL,
    ip_address INET,
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## API ë¬¸ì„œ

### TwoFAService

#### `setup_2fa(user_id: str) -> TwoFASetupResponse`
ì‚¬ìš©ìì˜ 2FAë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

**ë°˜í™˜ê°’:**
- `qr_code`: QR ì½”ë“œ (Base64 ì¸ì½”ë”©ëœ ì´ë¯¸ì§€)
- `backup_codes`: ë°±ì—… ì½”ë“œ ë¦¬ìŠ¤íŠ¸
- `secret`: OTP ë¹„ë°€í‚¤ (ìˆ˜ë™ ì…ë ¥ìš©)

#### `authenticate_2fa(user_id: str, token: str) -> TwoFAAuthenticateResponse`
2FA í† í°ì„ ê²€ì¦í•©ë‹ˆë‹¤.

**ë§¤ê°œë³€ìˆ˜:**
- `user_id`: ì‚¬ìš©ì ID
- `token`: 6ìë¦¬ TOTP ì½”ë“œ

#### `verify_backup_code(user_id: str, backup_code: str) -> TwoFAVerifyResponse`
ë°±ì—… ì½”ë“œë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.

#### `regenerate_backup_codes(user_id: str) -> TwoFARegenerateBackupCodesResponse`
ìƒˆë¡œìš´ ë°±ì—… ì½”ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

#### `disable_2fa(user_id: str) -> TwoFADisableResponse`
2FAë¥¼ ë¹„í™œì„±í™”í•©ë‹ˆë‹¤.

### TwoFARepository

ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì„ ë‹´ë‹¹í•˜ëŠ” ì¶”ìƒ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

#### êµ¬í˜„ì²´
- `AdminTwoFARepository`: ê´€ë¦¬ììš© êµ¬í˜„ì²´
- `UserTwoFARepository`: ì¼ë°˜ ì‚¬ìš©ììš© êµ¬í˜„ì²´ (í™•ì¥ ê°€ëŠ¥)

## ì„¤ì •

í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
# 2FA ë°œê¸‰ì ì´ë¦„
export TWOFA_ISSUER_NAME="MyApp"

# ë°±ì—… ì½”ë“œ ê°œìˆ˜ (ê¸°ë³¸ê°’: 8)
export TWOFA_BACKUP_CODES_COUNT="10"

# TOTP ìœˆë„ìš° í¬ê¸° (ê¸°ë³¸ê°’: 1)
export TWOFA_WINDOW_SIZE="2"

# ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ (ê¸°ë³¸ê°’: 5)
export TWOFA_MAX_RETRY_ATTEMPTS="3"

# ì¬ì‹œë„ ìœˆë„ìš° (ë¶„, ê¸°ë³¸ê°’: 5)
export TWOFA_RETRY_WINDOW_MINUTES="10"
```

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **ì•”í˜¸í™”**: OTP ë¹„ë°€í‚¤ì™€ ë°±ì—… ì½”ë“œëŠ” Fernetìœ¼ë¡œ ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.
2. **ì¬ì‹œë„ ì œí•œ**: ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•œ ì¬ì‹œë„ ì œí•œì´ ìˆìŠµë‹ˆë‹¤.
3. **ë¡œê·¸ ê´€ë¦¬**: 2FA ì‚¬ìš© ì´ë ¥ì´ ì¶”ì ë˜ì–´ ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
4. **ê¶Œí•œ ë¶„ë¦¬**: ê´€ë¦¬ìì™€ ì¼ë°˜ ì‚¬ìš©ì ê¶Œí•œì„ ë¶„ë¦¬í•˜ì—¬ ê´€ë¦¬í•©ë‹ˆë‹¤.

## ê°œë°œ

### ê°œë°œ í™˜ê²½ ì„¤ì •

```bash
git clone https://github.com/hotpartners/hotpartners-twofa.git
cd hotpartners-twofa
pip install -e ".[dev]"
```

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
pytest
```

### ì½”ë“œ í¬ë§·íŒ…

```bash
black hotpartners_twofa/
flake8 hotpartners_twofa/
mypy hotpartners_twofa/
```

## ë¼ì´ì„ ìŠ¤

MIT License - ìì„¸í•œ ë‚´ìš©ì€ [LICENSE](LICENSE) íŒŒì¼ì„ ì°¸ì¡°í•˜ì„¸ìš”.

## ê¸°ì—¬í•˜ê¸°

1. Fork the Project
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## ì§€ì›

- ì´ìŠˆ ë¦¬í¬íŠ¸: [GitHub Issues](https://github.com/hotpartners/hotpartners-twofa/issues)
- ë¬¸ì„œ: [Read the Docs](https://hotpartners-twofa.readthedocs.io/)
- ì´ë©”ì¼: dev@hotpartners.com

## ë³€ê²½ ì´ë ¥

### 1.0.0 (2024-12-02)
- ì´ˆê¸° ë¦´ë¦¬ìŠ¤
- TOTP ê¸°ë°˜ 2FA ì§€ì›
- QR ì½”ë“œ ìƒì„±
- ë°±ì—… ì½”ë“œ ê´€ë¦¬
- ì•”í˜¸í™” ì €ì¥
- ë¹„ë™ê¸° ì§€ì›
