(()=>{var be=Object.defineProperty;var ae=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var re=(e,n,t)=>n in e?be(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,Q=(e,n)=>{for(var t in n||(n={}))ye.call(n,t)&&re(e,t,n[t]);if(ae)for(var t of ae(n))we.call(n,t)&&re(e,t,n[t]);return e};var ie="rxxxt-on-",se=()=>new Date().getTime(),oe=new WeakMap;function j(e){var t,a,r;let n=oe.get(e);return n===void 0&&(n=JSON.stringify([e.context_id,e.handler_name,(t=e.options.debounce)!=null?t:null,(a=e.options.prevent_default)!=null?a:null,(r=e.options.throttle)!=null?r:null,...Object.entries(e.param_map).sort((l,c)=>l[0].localeCompare(c[0]))]),oe.set(e,n)),n}function xe(e){var t;let n=new Map;for(let a of e.getAttributeNames())if(a.startsWith(ie)){let r=a.substring(ie.length),l=JSON.parse(atob((t=e.getAttribute(a))!=null?t:""));n.set(r,l)}return n}function Se(e,n){let t=e;try{for(let a of n.split("."))t=t[a];return typeof t=="string"||typeof t=="number"||typeof t=="boolean"?t:void 0}catch(a){return}}function le(e){let n=0,t=new WeakMap,a=new WeakMap,r=new Map,l=new Set,c=(o,v)=>{var p,T,f,O,C;let h=(p=t.get(o))!=null?p:[],E=h.filter(m=>l.has(m.descriptor.context_id));E.length!==h.length&&(t.set(o,E),S(o),h=E);for(let m of h.filter(M=>M.event===v.type)){let M=Q(Q({$handler_name:m.descriptor.handler_name},(T=m.descriptor.options.default_params)!=null?T:{}),Object.fromEntries(Object.entries(m.descriptor.param_map).map(P=>[P[0],Se(v,P[1])])));r.set(m.submitId,{context_id:m.descriptor.context_id,data:M}),m.timeoutHandle&&(clearTimeout(m.timeoutHandle),m.timeoutHandle=void 0),m.descriptor.options.prevent_default&&v.preventDefault();let J=Math.max(0,(f=m.descriptor.options.debounce)!=null?f:0,((O=m.lastCall)!=null?O:0)+((C=m.descriptor.options.throttle)!=null?C:0)-se());m.timeoutHandle=setTimeout(()=>{r.has(m.submitId)&&(m.lastCall=se(),e())},J)}},S=o=>{var E,p,T;let v=(E=a.get(o))!=null?E:new Map;a.set(o,v);let h=new Set((T=(p=t.get(o))==null?void 0:p.map(f=>f.event))!=null?T:[]);for(let f of Array.from(v.keys()))h.has(f)||(o.removeEventListener(f,v.get(f)),v.delete(f));for(let f of h)if(!v.has(f)){let O=C=>c(o,C);o.addEventListener(f,O),v.set(f,O)}},U=()=>{let o=Array.from(r.values());return r.clear(),o},N=o=>{var E;o.tagName==="RXXXT-META"&&l.add(o.id);let v=new Map(((E=t.get(o))!=null?E:[]).filter(p=>p.tag=="local").map(p=>[p.event,p])),h=xe(o);for(let p of v.values())h.has(p.event)||y(o,p.event,p.descriptor,"local");for(let p of h.entries())v.has(p[0])?v.get(p[0]).descriptor=p[1]:w(o,p[0],p[1],"local")},A=o=>{o.tagName==="RXXXT-META"&&l.delete(o.id)},w=(o,v,h,E="global")=>{var O;let p=j(h),T=(O=t.get(o))!=null?O:[];t.set(o,T);let f=T.find(C=>C.event===v&&j(C.descriptor)===p&&C.tag==E);f===void 0?T.push({descriptor:h,event:v,submitId:++n,tag:E}):f.descriptor=h,S(o)},y=(o,v,h,E="global")=>{var T;let p=j(h);t.set(o,((T=t.get(o))!=null?T:[]).filter(f=>f.event!=v||j(f.descriptor)!==p||f.tag!==E)),S(o)};return{registerEvent:w,unregisterEvent:y,onElementUpdated:N,onElementDeleted:A,popPendingEvents:U}}function de(e){let n,t=!1,a=!1,r=!1,l,c=()=>{if(t){a=!0;return}t=!0,a=!1,l(e.popPendingEvents())},S=(A,w)=>{e.onUpdate(A,w),t=!1,a&&c()},U=()=>{n==null||n.close(),n=void 0,l=async A=>{var y;let w=await fetch(location.href,{method:"POST",body:JSON.stringify({state_token:e.stateToken,events:A}),headers:{"Content-Type":"application/json"},credentials:"include"});if(w.ok){let o=await w.json();S(o.html_parts,o.events),e.stateToken=(y=o.state_token)!=null?y:e.stateToken}else throw new Error("Update failed! Server responded with ".concat(w.statusText," (").concat(w.status,")."))}},N=()=>{if(n!==void 0){console.warn("tried to switch to websocket again, despite using it already");return}let A=async y=>n==null?void 0:n.send(JSON.stringify({type:"update",events:y,location:location.href.substring(location.origin.length)})),w=new URL(location.href);w.protocol=location.protocol=="https:"?"wss":"ws",n=new WebSocket(w),n.addEventListener("close",U),n.addEventListener("open",()=>{l=A,n==null||n.send(JSON.stringify({type:"init",state_token:e.stateToken,enable_state_updates:e.enableWebSocketStateUpdates}))}),n.addEventListener("message",y=>{var v;if(typeof y.data!="string")return;let o=JSON.parse(y.data);e.stateToken=(v=o.state_token)!=null?v:e.stateToken,S(o.html_parts,o.events)})};return U(),{useHTTP:U,useWebSocket:N,update:()=>{r||(r=!0,setTimeout(()=>{r=!1,c()},0))}}}var pe=11;function Ae(e,n){var t=n.attributes,a,r,l,c,S;if(!(n.nodeType===pe||e.nodeType===pe)){for(var U=t.length-1;U>=0;U--)a=t[U],r=a.name,l=a.namespaceURI,c=a.value,l?(r=a.localName||r,S=e.getAttributeNS(l,r),S!==c&&(a.prefix==="xmlns"&&(r=a.name),e.setAttributeNS(l,r,c))):(S=e.getAttribute(r),S!==c&&e.setAttribute(r,c));for(var N=e.attributes,A=N.length-1;A>=0;A--)a=N[A],r=a.name,l=a.namespaceURI,l?(r=a.localName||r,n.hasAttributeNS(l,r)||e.removeAttributeNS(l,r)):n.hasAttribute(r)||e.removeAttribute(r)}}var F,Ce="http://www.w3.org/1999/xhtml",x=typeof document>"u"?void 0:document,Ue=!!x&&"content"in x.createElement("template"),Oe=!!x&&x.createRange&&"createContextualFragment"in x.createRange();function ke(e){var n=x.createElement("template");return n.innerHTML=e,n.content.childNodes[0]}function Ne(e){F||(F=x.createRange(),F.selectNode(x.body));var n=F.createContextualFragment(e);return n.childNodes[0]}function De(e){var n=x.createElement("body");return n.innerHTML=e,n.childNodes[0]}function _e(e){return e=e.trim(),Ue?ke(e):Oe?Ne(e):De(e)}function G(e,n){var t=e.nodeName,a=n.nodeName,r,l;return t===a?!0:(r=t.charCodeAt(0),l=a.charCodeAt(0),r<=90&&l>=97?t===a.toUpperCase():l<=90&&r>=97?a===t.toUpperCase():!1)}function Ie(e,n){return!n||n===Ce?x.createElement(e):x.createElementNS(n,e)}function He(e,n){for(var t=e.firstChild;t;){var a=t.nextSibling;n.appendChild(t),t=a}return n}function Z(e,n,t){e[t]!==n[t]&&(e[t]=n[t],e[t]?e.setAttribute(t,""):e.removeAttribute(t))}var ue={OPTION:function(e,n){var t=e.parentNode;if(t){var a=t.nodeName.toUpperCase();a==="OPTGROUP"&&(t=t.parentNode,a=t&&t.nodeName.toUpperCase()),a==="SELECT"&&!t.hasAttribute("multiple")&&(e.hasAttribute("selected")&&!n.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),t.selectedIndex=-1)}Z(e,n,"selected")},INPUT:function(e,n){Z(e,n,"checked"),Z(e,n,"disabled"),e.value!==n.value&&(e.value=n.value),n.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,n){var t=n.value;e.value!==t&&(e.value=t);var a=e.firstChild;if(a){var r=a.nodeValue;if(r==t||!t&&r==e.placeholder)return;a.nodeValue=t}},SELECT:function(e,n){if(!n.hasAttribute("multiple")){for(var t=-1,a=0,r=e.firstChild,l,c;r;)if(c=r.nodeName&&r.nodeName.toUpperCase(),c==="OPTGROUP")l=r,r=l.firstChild;else{if(c==="OPTION"){if(r.hasAttribute("selected")){t=a;break}a++}r=r.nextSibling,!r&&l&&(r=l.nextSibling,l=null)}e.selectedIndex=t}}},V=1,ce=11,fe=3,ve=8;function I(){}function Me(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}function Pe(e){return function(t,a,r){if(r||(r={}),typeof a=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var l=a;a=x.createElement("html"),a.innerHTML=l}else a=_e(a);else a.nodeType===ce&&(a=a.firstElementChild);var c=r.getNodeKey||Me,S=r.onBeforeNodeAdded||I,U=r.onNodeAdded||I,N=r.onBeforeElUpdated||I,A=r.onElUpdated||I,w=r.onBeforeNodeDiscarded||I,y=r.onNodeDiscarded||I,o=r.onBeforeElChildrenUpdated||I,v=r.skipFromChildren||I,h=r.addChild||function(i,s){return i.appendChild(s)},E=r.childrenOnly===!0,p=Object.create(null),T=[];function f(i){T.push(i)}function O(i,s){if(i.nodeType===V)for(var g=i.firstChild;g;){var d=void 0;s&&(d=c(g))?f(d):(y(g),g.firstChild&&O(g,s)),g=g.nextSibling}}function C(i,s,g){w(i)!==!1&&(s&&s.removeChild(i),y(i),O(i,g))}function m(i){if(i.nodeType===V||i.nodeType===ce)for(var s=i.firstChild;s;){var g=c(s);g&&(p[g]=s),m(s),s=s.nextSibling}}m(t);function M(i){U(i);for(var s=i.firstChild;s;){var g=s.nextSibling,d=c(s);if(d){var u=p[d];u&&G(s,u)?(s.parentNode.replaceChild(u,s),P(u,s)):M(s)}else M(s);s=g}}function J(i,s,g){for(;s;){var d=s.nextSibling;(g=c(s))?f(g):C(s,i,!0),s=d}}function P(i,s,g){var d=c(s);if(d&&delete p[d],!g){var u=N(i,s);if(u===!1||(u instanceof HTMLElement&&(i=u,m(i)),e(i,s),A(i),o(i,s)===!1))return}i.nodeName!=="TEXTAREA"?Ee(i,s):ue.TEXTAREA(i,s)}function Ee(i,s){var g=v(i,s),d=s.firstChild,u=i.firstChild,L,k,W,$,D;e:for(;d;){for($=d.nextSibling,L=c(d);!g&&u;){if(W=u.nextSibling,d.isSameNode&&d.isSameNode(u)){d=$,u=W;continue e}k=c(u);var K=u.nodeType,_=void 0;if(K===d.nodeType&&(K===V?(L?L!==k&&((D=p[L])?W===D?_=!1:(i.insertBefore(D,u),k?f(k):C(u,i,!0),u=D,k=c(u)):_=!1):k&&(_=!1),_=_!==!1&&G(u,d),_&&P(u,d)):(K===fe||K==ve)&&(_=!0,u.nodeValue!==d.nodeValue&&(u.nodeValue=d.nodeValue))),_){d=$,u=W;continue e}k?f(k):C(u,i,!0),u=W}if(L&&(D=p[L])&&G(D,d))g||h(i,D),P(D,d);else{var Y=S(d);Y!==!1&&(Y&&(d=Y),d.actualize&&(d=d.actualize(i.ownerDocument||x)),h(i,d),M(d))}d=$,u=W}J(i,u,k);var ne=ue[i.nodeName];ne&&ne(i,s)}var b=t,X=b.nodeType,te=a.nodeType;if(!E){if(X===V)te===V?G(t,a)||(y(t),b=He(t,Ie(a.nodeName,a.namespaceURI))):b=a;else if(X===fe||X===ve){if(te===X)return b.nodeValue!==a.nodeValue&&(b.nodeValue=a.nodeValue),b;b=a}}if(b===a)y(t);else{if(a.isSameNode&&a.isSameNode(b))return;if(P(b,a,E),T)for(var z=0,Te=T.length;z<Te;z++){var q=p[T[z]];q&&C(q,q.parentNode,!1)}}return!E&&b!==t&&t.parentNode&&(b.actualize&&(b=b.actualize(t.ownerDocument||x)),t.parentNode.replaceChild(b,t)),b}}var Re=Pe(Ae),ge=Re;var Le="root",H,me={stateToken:"",enableWebSocketStateUpdates:!1,onUpdate:(e,n)=>{for(let t of e)he(t);ee(n)},popPendingEvents:()=>R.popPendingEvents()},B=de(me),R=le(B.update),he=e=>{let n;if(e===void 0){let t=document.getElementById(Le);if(t===null)throw new Error("Update target not found!");n=t}else{let t=document.createElement("div");t.innerHTML=e;let a=t.children.item(0);if(a===null||a.tagName!=="rxxxt-meta".toUpperCase())throw new Error("Invalid update root!");let r=document.getElementById(a.id);if(r===null)throw new Error("Update target not found!");n=r,ge(n,a,{onNodeDiscarded:l=>{l instanceof Element&&R.onElementDeleted(l)}})}for(let t of n.getElementsByTagName("*"))R.onElementUpdated(t)},We={navigate:e=>{let n=new URL(e.location,location.href);H===void 0||H.origin!==n.origin||!n.pathname.startsWith(H.pathname)?location.assign(n):(window.history.pushState({},"",e.location),B.update())},"use-websocket":e=>{e.websocket?B.useWebSocket():B.useHTTP()},"set-cookie":e=>{var t;let n=["".concat(e.name,"=").concat((t=e.value)!=null?t:"")];typeof e.path=="string"&&n.push("path=".concat(e.path)),typeof e.expires=="string"&&n.push("expires=".concat(new Date(e.expires).toUTCString())),typeof e.max_age=="number"&&n.push("max-age=".concat(e.max_age)),typeof e.domain=="string"&&n.push("domain=".concat(e.domain)),e.secure&&n.push("secure"),e.http_only&&n.push("httponly"),document.cookie=n.join(";")},"event-modify-window":e=>{e.mode==="add"?R.registerEvent(window,e.name,e.descriptor):e.mode==="remove"&&R.unregisterEvent(window,e.name,e.descriptor)},"event-modify-query-selector":e=>{let n;if(e.all)n=Array.from(document.querySelectorAll(e.selector));else{let t=document.querySelector(e.selector);n=t===null?[]:[t]}for(let t of n)e.mode==="add"?R.registerEvent(t,e.name,e.descriptor):e.mode==="remove"&&R.unregisterEvent(t,e.name,e.descriptor)}},ee=e=>e.forEach(n=>We[n.event](n));window.rxxxt={navigate:e=>ee([{event:"navigate",location:new URL(e,location.href).href}]),init:e=>{H=new URL(location.href),H.pathname.endsWith(e.path)?H.pathname=H.pathname.slice(0,H.pathname.length-e.path.length):console.warn("Invalid base url!"),window.addEventListener("popstate",B.update),me.stateToken=e.state_token,ee(e.events),he()}};})();
