(()=>{var be=Object.defineProperty;var re=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var ae=(e,n,t)=>n in e?be(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,Q=(e,n)=>{for(var t in n||(n={}))ye.call(n,t)&&ae(e,t,n[t]);if(re)for(var t of re(n))we.call(n,t)&&ae(e,t,n[t]);return e};var ie="rxxxt-on-",se=()=>new Date().getTime(),oe=new WeakMap;function F(e){var t,r,a;let n=oe.get(e);return n===void 0&&(n=JSON.stringify([e.context_id,e.handler_name,(t=e.options.debounce)!=null?t:null,(r=e.options.prevent_default)!=null?r:null,(a=e.options.throttle)!=null?a:null,...Object.entries(e.param_map).sort((l,f)=>l[0].localeCompare(f[0]))]),oe.set(e,n)),n}function xe(e){var t;let n=new Map;for(let r of e.getAttributeNames())if(r.startsWith(ie)){let a=r.substring(ie.length),l=JSON.parse(atob((t=e.getAttribute(r))!=null?t:""));n.set(a,l)}return n}function Se(e,n){let t=e;try{for(let r of n.split("."))t=t[r];return typeof t=="string"||typeof t=="number"||typeof t=="boolean"?t:void 0}catch(r){return}}function le(e){let n=0,t=new WeakMap,r=new WeakMap,a=new Map,l=new Set,f=(o,u)=>{var p,b,v,C,A;let g=(p=t.get(o))!=null?p:[],E=g.filter(m=>l.has(m.descriptor.context_id));E.length!==g.length&&(t.set(o,E),x(o),g=E);for(let m of g.filter(H=>H.event===u.type)){let H=Q(Q({$handler_name:m.descriptor.handler_name},(b=m.descriptor.options.default_params)!=null?b:{}),Object.fromEntries(Object.entries(m.descriptor.param_map).map(R=>[R[0],Se(u,R[1])])));if(a.set(m.submitId,{context_id:m.descriptor.context_id,data:H}),m.timeoutHandle&&(clearTimeout(m.timeoutHandle),m.timeoutHandle=void 0),m.descriptor.options.prevent_default&&u.preventDefault(),!m.descriptor.options.no_trigger){let R=Math.max(0,(v=m.descriptor.options.debounce)!=null?v:0,((C=m.lastCall)!=null?C:0)+((A=m.descriptor.options.throttle)!=null?A:0)-se());m.timeoutHandle=setTimeout(()=>{a.has(m.submitId)&&(m.lastCall=se(),e())},R)}}},x=o=>{var E,p,b;let u=(E=r.get(o))!=null?E:new Map;r.set(o,u);let g=new Set((b=(p=t.get(o))==null?void 0:p.map(v=>v.event))!=null?b:[]);for(let v of Array.from(u.keys()))g.has(v)||(o.removeEventListener(v,u.get(v)),u.delete(v));for(let v of g)if(!u.has(v)){let C=A=>f(o,A);o.addEventListener(v,C),u.set(v,C)}},U=()=>{let o=new Map(a);return a.clear(),o},O=o=>{var E;o.tagName==="RXXXT-META"&&l.add(o.id);let u=new Map(((E=t.get(o))!=null?E:[]).filter(p=>p.tag=="local").map(p=>[p.event,p])),g=xe(o);for(let p of u.values())g.has(p.event)||T(o,p.event,p.descriptor,"local");for(let p of g.entries())u.has(p[0])?u.get(p[0]).descriptor=p[1]:S(o,p[0],p[1],"local")},k=o=>{o.tagName==="RXXXT-META"&&l.delete(o.id)},S=(o,u,g,E="global")=>{var C;let p=F(g),b=(C=t.get(o))!=null?C:[];t.set(o,b);let v=b.find(A=>A.event===u&&F(A.descriptor)===p&&A.tag==E);v===void 0?b.push({descriptor:g,event:u,submitId:++n,tag:E}):v.descriptor=g,x(o)},T=(o,u,g,E="global")=>{var b;let p=F(g);t.set(o,((b=t.get(o))!=null?b:[]).filter(v=>v.event!=u||F(v.descriptor)!==p||v.tag!==E)),x(o)};return{registerEvent:S,unregisterEvent:T,onElementUpdated:O,onElementDeleted:k,popPendingEvents:U}}function de(e){let n,t=!1,r=!1,a=!1,l,f=new Map,x=()=>{if(t){r=!0;return}t=!0,r=!1;for(let S of e.popPendingEvents())f.set(S[0],S[1]);l(Array.from(f.values()))},U=(S,T)=>{f.clear(),e.onUpdate(S,T),t=!1,r&&x()},O=()=>{n==null||n.close(),n=void 0,l=async S=>{var o;let T=await fetch(location.href,{method:"POST",body:JSON.stringify({state_token:e.stateToken,events:S}),headers:{"Content-Type":"application/json"},credentials:"include"});if(T.ok){let u=await T.json();U(u.html_parts,u.events),e.stateToken=(o=u.state_token)!=null?o:e.stateToken}else throw new Error("Update failed! Server responded with ".concat(T.statusText," (").concat(T.status,")."))}},k=()=>{if(n!==void 0){console.warn("tried to switch to websocket again, despite using it already");return}let S=async o=>n==null?void 0:n.send(JSON.stringify({type:"update",events:o,location:location.href.substring(location.origin.length)})),T=new URL(location.href);T.protocol=location.protocol=="https:"?"wss":"ws",n=new WebSocket(T),n.addEventListener("close",O),n.addEventListener("open",()=>{l=S,n==null||n.send(JSON.stringify({type:"init",state_token:e.stateToken,enable_state_updates:e.enableWebSocketStateUpdates}))}),n.addEventListener("message",o=>{var g;if(typeof o.data!="string")return;let u=JSON.parse(o.data);e.stateToken=(g=u.state_token)!=null?g:e.stateToken,U(u.html_parts,u.events)})};return O(),{useHTTP:O,useWebSocket:k,update:()=>{a||(a=!0,setTimeout(()=>{a=!1,x()},0))}}}var pe=11;function Ae(e,n){var t=n.attributes,r,a,l,f,x;if(!(n.nodeType===pe||e.nodeType===pe)){for(var U=t.length-1;U>=0;U--)r=t[U],a=r.name,l=r.namespaceURI,f=r.value,l?(a=r.localName||a,x=e.getAttributeNS(l,a),x!==f&&(r.prefix==="xmlns"&&(a=r.name),e.setAttributeNS(l,a,f))):(x=e.getAttribute(a),x!==f&&e.setAttribute(a,f));for(var O=e.attributes,k=O.length-1;k>=0;k--)r=O[k],a=r.name,l=r.namespaceURI,l?(a=r.localName||a,n.hasAttributeNS(l,a)||e.removeAttributeNS(l,a)):n.hasAttribute(a)||e.removeAttribute(a)}}var G,Ce="http://www.w3.org/1999/xhtml",w=typeof document>"u"?void 0:document,Ue=!!w&&"content"in w.createElement("template"),Oe=!!w&&w.createRange&&"createContextualFragment"in w.createRange();function ke(e){var n=w.createElement("template");return n.innerHTML=e,n.content.childNodes[0]}function Ne(e){G||(G=w.createRange(),G.selectNode(w.body));var n=G.createContextualFragment(e);return n.childNodes[0]}function _e(e){var n=w.createElement("body");return n.innerHTML=e,n.childNodes[0]}function De(e){return e=e.trim(),Ue?ke(e):Oe?Ne(e):_e(e)}function J(e,n){var t=e.nodeName,r=n.nodeName,a,l;return t===r?!0:(a=t.charCodeAt(0),l=r.charCodeAt(0),a<=90&&l>=97?t===r.toUpperCase():l<=90&&a>=97?r===t.toUpperCase():!1)}function Ie(e,n){return!n||n===Ce?w.createElement(e):w.createElementNS(n,e)}function Me(e,n){for(var t=e.firstChild;t;){var r=t.nextSibling;n.appendChild(t),t=r}return n}function Z(e,n,t){e[t]!==n[t]&&(e[t]=n[t],e[t]?e.setAttribute(t,""):e.removeAttribute(t))}var ue={OPTION:function(e,n){var t=e.parentNode;if(t){var r=t.nodeName.toUpperCase();r==="OPTGROUP"&&(t=t.parentNode,r=t&&t.nodeName.toUpperCase()),r==="SELECT"&&!t.hasAttribute("multiple")&&(e.hasAttribute("selected")&&!n.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),t.selectedIndex=-1)}Z(e,n,"selected")},INPUT:function(e,n){Z(e,n,"checked"),Z(e,n,"disabled"),e.value!==n.value&&(e.value=n.value),n.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,n){var t=n.value;e.value!==t&&(e.value=t);var r=e.firstChild;if(r){var a=r.nodeValue;if(a==t||!t&&a==e.placeholder)return;r.nodeValue=t}},SELECT:function(e,n){if(!n.hasAttribute("multiple")){for(var t=-1,r=0,a=e.firstChild,l,f;a;)if(f=a.nodeName&&a.nodeName.toUpperCase(),f==="OPTGROUP")l=a,a=l.firstChild;else{if(f==="OPTION"){if(a.hasAttribute("selected")){t=r;break}r++}a=a.nextSibling,!a&&l&&(a=l.nextSibling,l=null)}e.selectedIndex=t}}},V=1,ce=11,fe=3,ve=8;function I(){}function He(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}function Pe(e){return function(t,r,a){if(a||(a={}),typeof r=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var l=r;r=w.createElement("html"),r.innerHTML=l}else r=De(r);else r.nodeType===ce&&(r=r.firstElementChild);var f=a.getNodeKey||He,x=a.onBeforeNodeAdded||I,U=a.onNodeAdded||I,O=a.onBeforeElUpdated||I,k=a.onElUpdated||I,S=a.onBeforeNodeDiscarded||I,T=a.onNodeDiscarded||I,o=a.onBeforeElChildrenUpdated||I,u=a.skipFromChildren||I,g=a.addChild||function(i,s){return i.appendChild(s)},E=a.childrenOnly===!0,p=Object.create(null),b=[];function v(i){b.push(i)}function C(i,s){if(i.nodeType===V)for(var h=i.firstChild;h;){var d=void 0;s&&(d=f(h))?v(d):(T(h),h.firstChild&&C(h,s)),h=h.nextSibling}}function A(i,s,h){S(i)!==!1&&(s&&s.removeChild(i),T(i),C(i,h))}function m(i){if(i.nodeType===V||i.nodeType===ce)for(var s=i.firstChild;s;){var h=f(s);h&&(p[h]=s),m(s),s=s.nextSibling}}m(t);function H(i){U(i);for(var s=i.firstChild;s;){var h=s.nextSibling,d=f(s);if(d){var c=p[d];c&&J(s,c)?(s.parentNode.replaceChild(c,s),X(c,s)):H(s)}else H(s);s=h}}function R(i,s,h){for(;s;){var d=s.nextSibling;(h=f(s))?v(h):A(s,i,!0),s=d}}function X(i,s,h){var d=f(s);if(d&&delete p[d],!h){var c=O(i,s);if(c===!1||(c instanceof HTMLElement&&(i=c,m(i)),e(i,s),k(i),o(i,s)===!1))return}i.nodeName!=="TEXTAREA"?Ee(i,s):ue.TEXTAREA(i,s)}function Ee(i,s){var h=u(i,s),d=s.firstChild,c=i.firstChild,L,N,W,K,_;e:for(;d;){for(K=d.nextSibling,L=f(d);!h&&c;){if(W=c.nextSibling,d.isSameNode&&d.isSameNode(c)){d=K,c=W;continue e}N=f(c);var j=c.nodeType,D=void 0;if(j===d.nodeType&&(j===V?(L?L!==N&&((_=p[L])?W===_?D=!1:(i.insertBefore(_,c),N?v(N):A(c,i,!0),c=_,N=f(c)):D=!1):N&&(D=!1),D=D!==!1&&J(c,d),D&&X(c,d)):(j===fe||j==ve)&&(D=!0,c.nodeValue!==d.nodeValue&&(c.nodeValue=d.nodeValue))),D){d=K,c=W;continue e}N?v(N):A(c,i,!0),c=W}if(L&&(_=p[L])&&J(_,d))h||g(i,_),X(_,d);else{var Y=x(d);Y!==!1&&(Y&&(d=Y),d.actualize&&(d=d.actualize(i.ownerDocument||w)),g(i,d),H(d))}d=K,c=W}R(i,c,N);var ne=ue[i.nodeName];ne&&ne(i,s)}var y=t,$=y.nodeType,te=r.nodeType;if(!E){if($===V)te===V?J(t,r)||(T(t),y=Me(t,Ie(r.nodeName,r.namespaceURI))):y=r;else if($===fe||$===ve){if(te===$)return y.nodeValue!==r.nodeValue&&(y.nodeValue=r.nodeValue),y;y=r}}if(y===r)T(t);else{if(r.isSameNode&&r.isSameNode(y))return;if(X(y,r,E),b)for(var q=0,Te=b.length;q<Te;q++){var z=p[b[q]];z&&A(z,z.parentNode,!1)}}return!E&&y!==t&&t.parentNode&&(y.actualize&&(y=y.actualize(t.ownerDocument||w)),t.parentNode.replaceChild(y,t)),y}}var Re=Pe(Ae),ge=Re;var Le="root",M,me={stateToken:"",enableWebSocketStateUpdates:!1,onUpdate:(e,n)=>{for(let t of e)he(t);ee(n)},popPendingEvents:()=>P.popPendingEvents()},B=de(me),P=le(B.update),he=e=>{let n;if(e===void 0){let t=document.getElementById(Le);if(t===null)throw new Error("Update target not found!");n=t}else{let t=document.createElement("div");t.innerHTML=e;let r=t.children.item(0);if(r===null||r.tagName!=="rxxxt-meta".toUpperCase())throw new Error("Invalid update root!");let a=document.getElementById(r.id);if(a===null)throw new Error("Update target not found!");n=a,ge(n,r,{onNodeDiscarded:l=>{l instanceof Element&&P.onElementDeleted(l)}})}for(let t of n.getElementsByTagName("*"))P.onElementUpdated(t)},We={navigate:e=>{let n=new URL(e.location,location.href);M===void 0||M.origin!==n.origin||!n.pathname.startsWith(M.pathname)?location.assign(n):(window.history.pushState({},"",e.location),e.requires_refresh&&B.update())},"use-websocket":e=>{e.websocket?B.useWebSocket():B.useHTTP()},"set-cookie":e=>{var t;let n=["".concat(e.name,"=").concat((t=e.value)!=null?t:"")];typeof e.path=="string"&&n.push("path=".concat(e.path)),typeof e.expires=="string"&&n.push("expires=".concat(new Date(e.expires).toUTCString())),typeof e.max_age=="number"&&n.push("max-age=".concat(e.max_age)),typeof e.domain=="string"&&n.push("domain=".concat(e.domain)),e.secure&&n.push("secure"),e.http_only&&n.push("httponly"),document.cookie=n.join(";")},"event-modify-window":e=>{e.mode==="add"?P.registerEvent(window,e.name,e.descriptor):e.mode==="remove"&&P.unregisterEvent(window,e.name,e.descriptor)},"event-modify-query-selector":e=>{let n;if(e.all)n=Array.from(document.querySelectorAll(e.selector));else{let t=document.querySelector(e.selector);n=t===null?[]:[t]}for(let t of n)e.mode==="add"?P.registerEvent(t,e.name,e.descriptor):e.mode==="remove"&&P.unregisterEvent(t,e.name,e.descriptor)}},ee=e=>e.forEach(n=>We[n.event](n));window.rxxxt={navigate:e=>{ee([{event:"navigate",location:new URL(e,location.href).href,requires_refresh:!0}])},init:e=>{M=new URL(location.href),M.pathname.endsWith(e.path)?M.pathname=M.pathname.slice(0,M.pathname.length-e.path.length):console.warn("Invalid base url!"),window.addEventListener("popstate",B.update),me.stateToken=e.state_token,ee(e.events),he()}};})();
