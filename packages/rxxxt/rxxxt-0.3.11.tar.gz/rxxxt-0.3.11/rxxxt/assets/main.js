(()=>{var be=Object.defineProperty;var re=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var ae=(e,n,t)=>n in e?be(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,Q=(e,n)=>{for(var t in n||(n={}))ye.call(n,t)&&ae(e,t,n[t]);if(re)for(var t of re(n))we.call(n,t)&&ae(e,t,n[t]);return e};var ie="rxxxt-on-",se=()=>new Date().getTime(),oe=new WeakMap;function F(e){var t,r,a;let n=oe.get(e);return n===void 0&&(n=JSON.stringify([e.context_id,e.handler_name,(t=e.options.debounce)!=null?t:null,(r=e.options.prevent_default)!=null?r:null,(a=e.options.throttle)!=null?a:null,...Object.entries(e.param_map).sort((d,c)=>d[0].localeCompare(c[0]))]),oe.set(e,n)),n}function xe(e){var t;let n=new Map;for(let r of e.getAttributeNames())if(r.startsWith(ie)){let a=r.substring(ie.length),d=JSON.parse(atob((t=e.getAttribute(r))!=null?t:""));n.set(a,d)}return n}function Se(e,n){let t=e;try{for(let r of n.split("."))t=t[r];return typeof t=="string"||typeof t=="number"||typeof t=="boolean"?t:void 0}catch(r){return}}function de(e){let n=0,t=new WeakMap,r=new WeakMap,a=new Map,d=new Set,c=(o,f)=>{var p,b,v,A,C;let E=(p=t.get(o))!=null?p:[],h=E.filter(g=>d.has(g.descriptor.context_id));h.length!==E.length&&(t.set(o,h),S(o),E=h);for(let g of E.filter(V=>V.event===f.type)){let V=Q(Q({$handler_name:g.descriptor.handler_name},(b=g.descriptor.options.default_params)!=null?b:{}),Object.fromEntries(Object.entries(g.descriptor.param_map).map(I=>[I[0],Se(f,I[1])])));if(a.set(g.submitId,{context_id:g.descriptor.context_id,data:V}),g.timeoutHandle&&(clearTimeout(g.timeoutHandle),g.timeoutHandle=void 0),g.descriptor.options.prevent_default&&f.preventDefault(),!g.descriptor.options.no_trigger){let I=Math.max(0,(v=g.descriptor.options.debounce)!=null?v:0,((A=g.lastCall)!=null?A:0)+((C=g.descriptor.options.throttle)!=null?C:0)-se());g.timeoutHandle=setTimeout(()=>{a.has(g.submitId)&&(g.lastCall=se(),e())},I)}}},S=o=>{var h,p,b;let f=(h=r.get(o))!=null?h:new Map;r.set(o,f);let E=new Set((b=(p=t.get(o))==null?void 0:p.map(v=>v.event))!=null?b:[]);for(let v of Array.from(f.keys()))E.has(v)||(o.removeEventListener(v,f.get(v)),f.delete(v));for(let v of E)if(!f.has(v)){let A=C=>c(o,C);o.addEventListener(v,A),f.set(v,A)}},U=()=>{let o=new Map(a);return a.clear(),o},O=()=>Array.from(a.keys()),N=o=>{var h;o.tagName==="RXXXT-META"&&d.add(o.id);let f=new Map(((h=t.get(o))!=null?h:[]).filter(p=>p.tag=="local").map(p=>[p.event,p])),E=xe(o);for(let p of f.values())E.has(p.event)||w(o,p.event,p.descriptor,"local");for(let p of E.entries())f.has(p[0])?f.get(p[0]).descriptor=p[1]:T(o,p[0],p[1],"local")},k=o=>{o.tagName==="RXXXT-META"&&d.delete(o.id)},T=(o,f,E,h="global")=>{var A;let p=F(E),b=(A=t.get(o))!=null?A:[];t.set(o,b);let v=b.find(C=>C.event===f&&F(C.descriptor)===p&&C.tag==h);v===void 0?b.push({descriptor:E,event:f,submitId:++n,tag:h}):v.descriptor=E,S(o)},w=(o,f,E,h="global")=>{var b;let p=F(E);t.set(o,((b=t.get(o))!=null?b:[]).filter(v=>v.event!=f||F(v.descriptor)!==p||v.tag!==h)),S(o)};return{registerEvent:T,unregisterEvent:w,onElementUpdated:N,onElementDeleted:k,popPendingEvents:U,peekPendingEventIds:O}}function le(e){let n,t=!1,r=!1,a=!1,d,c=new Map,S=()=>{if(t){r=!0;return}t=!0,r=!1;for(let k of e.popPendingEvents())c.set(k[0],k[1]);d(Array.from(c.values()))},U=(k,T)=>{e.peekPendingEventIds().some(w=>c.has(w))?r=!0:(c.clear(),e.onUpdate(k,T)),t=!1,r&&S()},O=()=>{n==null||n.close(),n=void 0,d=async k=>{var w;let T=await fetch(location.href,{method:"POST",body:JSON.stringify({state_token:e.stateToken,events:k}),headers:{"Content-Type":"application/json"},credentials:"include"});if(T.ok){let o=await T.json();U(o.html_parts,o.events),e.stateToken=(w=o.state_token)!=null?w:e.stateToken}else throw new Error("Update failed! Server responded with ".concat(T.statusText," (").concat(T.status,")."))}},N=()=>{if(n!==void 0){console.warn("tried to switch to websocket again, despite using it already");return}let k=async w=>n==null?void 0:n.send(JSON.stringify({type:"update",events:w,location:location.href.substring(location.origin.length)})),T=new URL(location.href);T.protocol=location.protocol=="https:"?"wss":"ws",n=new WebSocket(T),n.addEventListener("close",O),n.addEventListener("open",()=>{d=k,n==null||n.send(JSON.stringify({type:"init",state_token:e.stateToken,enable_state_updates:e.enableWebSocketStateUpdates}))}),n.addEventListener("message",w=>{var f;if(typeof w.data!="string")return;let o=JSON.parse(w.data);e.stateToken=(f=o.state_token)!=null?f:e.stateToken,U(o.html_parts,o.events)})};return O(),{useHTTP:O,useWebSocket:N,update:()=>{a||(a=!0,setTimeout(()=>{a=!1,S()},0))}}}var pe=11;function Ae(e,n){var t=n.attributes,r,a,d,c,S;if(!(n.nodeType===pe||e.nodeType===pe)){for(var U=t.length-1;U>=0;U--)r=t[U],a=r.name,d=r.namespaceURI,c=r.value,d?(a=r.localName||a,S=e.getAttributeNS(d,a),S!==c&&(r.prefix==="xmlns"&&(a=r.name),e.setAttributeNS(d,a,c))):(S=e.getAttribute(a),S!==c&&e.setAttribute(a,c));for(var O=e.attributes,N=O.length-1;N>=0;N--)r=O[N],a=r.name,d=r.namespaceURI,d?(a=r.localName||a,n.hasAttributeNS(d,a)||e.removeAttributeNS(d,a)):n.hasAttribute(a)||e.removeAttribute(a)}}var G,ke="http://www.w3.org/1999/xhtml",x=typeof document>"u"?void 0:document,Ce=!!x&&"content"in x.createElement("template"),Ue=!!x&&x.createRange&&"createContextualFragment"in x.createRange();function Oe(e){var n=x.createElement("template");return n.innerHTML=e,n.content.childNodes[0]}function Ne(e){G||(G=x.createRange(),G.selectNode(x.body));var n=G.createContextualFragment(e);return n.childNodes[0]}function Ie(e){var n=x.createElement("body");return n.innerHTML=e,n.childNodes[0]}function _e(e){return e=e.trim(),Ce?Oe(e):Ue?Ne(e):Ie(e)}function J(e,n){var t=e.nodeName,r=n.nodeName,a,d;return t===r?!0:(a=t.charCodeAt(0),d=r.charCodeAt(0),a<=90&&d>=97?t===r.toUpperCase():d<=90&&a>=97?r===t.toUpperCase():!1)}function De(e,n){return!n||n===ke?x.createElement(e):x.createElementNS(n,e)}function Pe(e,n){for(var t=e.firstChild;t;){var r=t.nextSibling;n.appendChild(t),t=r}return n}function Z(e,n,t){e[t]!==n[t]&&(e[t]=n[t],e[t]?e.setAttribute(t,""):e.removeAttribute(t))}var ue={OPTION:function(e,n){var t=e.parentNode;if(t){var r=t.nodeName.toUpperCase();r==="OPTGROUP"&&(t=t.parentNode,r=t&&t.nodeName.toUpperCase()),r==="SELECT"&&!t.hasAttribute("multiple")&&(e.hasAttribute("selected")&&!n.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),t.selectedIndex=-1)}Z(e,n,"selected")},INPUT:function(e,n){Z(e,n,"checked"),Z(e,n,"disabled"),e.value!==n.value&&(e.value=n.value),n.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,n){var t=n.value;e.value!==t&&(e.value=t);var r=e.firstChild;if(r){var a=r.nodeValue;if(a==t||!t&&a==e.placeholder)return;r.nodeValue=t}},SELECT:function(e,n){if(!n.hasAttribute("multiple")){for(var t=-1,r=0,a=e.firstChild,d,c;a;)if(c=a.nodeName&&a.nodeName.toUpperCase(),c==="OPTGROUP")d=a,a=d.firstChild;else{if(c==="OPTION"){if(a.hasAttribute("selected")){t=r;break}r++}a=a.nextSibling,!a&&d&&(a=d.nextSibling,d=null)}e.selectedIndex=t}}},B=1,ce=11,fe=3,ve=8;function M(){}function Me(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}function He(e){return function(t,r,a){if(a||(a={}),typeof r=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var d=r;r=x.createElement("html"),r.innerHTML=d}else r=_e(r);else r.nodeType===ce&&(r=r.firstElementChild);var c=a.getNodeKey||Me,S=a.onBeforeNodeAdded||M,U=a.onNodeAdded||M,O=a.onBeforeElUpdated||M,N=a.onElUpdated||M,k=a.onBeforeNodeDiscarded||M,T=a.onNodeDiscarded||M,w=a.onBeforeElChildrenUpdated||M,o=a.skipFromChildren||M,f=a.addChild||function(i,s){return i.appendChild(s)},E=a.childrenOnly===!0,h=Object.create(null),p=[];function b(i){p.push(i)}function v(i,s){if(i.nodeType===B)for(var m=i.firstChild;m;){var l=void 0;s&&(l=c(m))?b(l):(T(m),m.firstChild&&v(m,s)),m=m.nextSibling}}function A(i,s,m){k(i)!==!1&&(s&&s.removeChild(i),T(i),v(i,m))}function C(i){if(i.nodeType===B||i.nodeType===ce)for(var s=i.firstChild;s;){var m=c(s);m&&(h[m]=s),C(s),s=s.nextSibling}}C(t);function g(i){U(i);for(var s=i.firstChild;s;){var m=s.nextSibling,l=c(s);if(l){var u=h[l];u&&J(s,u)?(s.parentNode.replaceChild(u,s),I(u,s)):g(s)}else g(s);s=m}}function V(i,s,m){for(;s;){var l=s.nextSibling;(m=c(s))?b(m):A(s,i,!0),s=l}}function I(i,s,m){var l=c(s);if(l&&delete h[l],!m){var u=O(i,s);if(u===!1||(u instanceof HTMLElement&&(i=u,C(i)),e(i,s),N(i),w(i,s)===!1))return}i.nodeName!=="TEXTAREA"?Ee(i,s):ue.TEXTAREA(i,s)}function Ee(i,s){var m=o(i,s),l=s.firstChild,u=i.firstChild,L,_,W,K,D;e:for(;l;){for(K=l.nextSibling,L=c(l);!m&&u;){if(W=u.nextSibling,l.isSameNode&&l.isSameNode(u)){l=K,u=W;continue e}_=c(u);var j=u.nodeType,P=void 0;if(j===l.nodeType&&(j===B?(L?L!==_&&((D=h[L])?W===D?P=!1:(i.insertBefore(D,u),_?b(_):A(u,i,!0),u=D,_=c(u)):P=!1):_&&(P=!1),P=P!==!1&&J(u,l),P&&I(u,l)):(j===fe||j==ve)&&(P=!0,u.nodeValue!==l.nodeValue&&(u.nodeValue=l.nodeValue))),P){l=K,u=W;continue e}_?b(_):A(u,i,!0),u=W}if(L&&(D=h[L])&&J(D,l))m||f(i,D),I(D,l);else{var Y=S(l);Y!==!1&&(Y&&(l=Y),l.actualize&&(l=l.actualize(i.ownerDocument||x)),f(i,l),g(l))}l=K,u=W}V(i,u,_);var ne=ue[i.nodeName];ne&&ne(i,s)}var y=t,$=y.nodeType,te=r.nodeType;if(!E){if($===B)te===B?J(t,r)||(T(t),y=Pe(t,De(r.nodeName,r.namespaceURI))):y=r;else if($===fe||$===ve){if(te===$)return y.nodeValue!==r.nodeValue&&(y.nodeValue=r.nodeValue),y;y=r}}if(y===r)T(t);else{if(r.isSameNode&&r.isSameNode(y))return;if(I(y,r,E),p)for(var q=0,Te=p.length;q<Te;q++){var z=h[p[q]];z&&A(z,z.parentNode,!1)}}return!E&&y!==t&&t.parentNode&&(y.actualize&&(y=y.actualize(t.ownerDocument||x)),t.parentNode.replaceChild(y,t)),y}}var Re=He(Ae),ge=Re;var Le="root",H,me={stateToken:"",enableWebSocketStateUpdates:!1,onUpdate:(e,n)=>{for(let t of e)he(t);ee(n)},peekPendingEventIds:()=>R.peekPendingEventIds(),popPendingEvents:()=>R.popPendingEvents()},X=le(me),R=de(X.update),he=e=>{let n;if(e===void 0){let t=document.getElementById(Le);if(t===null)throw new Error("Update target not found!");n=t}else{let t=document.createElement("div");t.innerHTML=e;let r=t.children.item(0);if(r===null||r.tagName!=="rxxxt-meta".toUpperCase())throw new Error("Invalid update root!");let a=document.getElementById(r.id);if(a===null)throw new Error("Update target not found!");n=a,ge(n,r,{onNodeDiscarded:d=>{d instanceof Element&&R.onElementDeleted(d)}})}for(let t of n.getElementsByTagName("*"))R.onElementUpdated(t)},We={navigate:e=>{let n=new URL(e.location,location.href);H===void 0||H.origin!==n.origin||!n.pathname.startsWith(H.pathname)?location.assign(n):(window.history.pushState({},"",e.location),e.requires_refresh&&X.update())},"use-websocket":e=>{e.websocket?X.useWebSocket():X.useHTTP()},"set-cookie":e=>{var t;let n=["".concat(e.name,"=").concat((t=e.value)!=null?t:"")];typeof e.path=="string"&&n.push("path=".concat(e.path)),typeof e.expires=="string"&&n.push("expires=".concat(new Date(e.expires).toUTCString())),typeof e.max_age=="number"&&n.push("max-age=".concat(e.max_age)),typeof e.domain=="string"&&n.push("domain=".concat(e.domain)),e.secure&&n.push("secure"),e.http_only&&n.push("httponly"),document.cookie=n.join(";")},"event-modify-window":e=>{e.mode==="add"?R.registerEvent(window,e.name,e.descriptor):e.mode==="remove"&&R.unregisterEvent(window,e.name,e.descriptor)},"event-modify-query-selector":e=>{let n;if(e.all)n=Array.from(document.querySelectorAll(e.selector));else{let t=document.querySelector(e.selector);n=t===null?[]:[t]}for(let t of n)e.mode==="add"?R.registerEvent(t,e.name,e.descriptor):e.mode==="remove"&&R.unregisterEvent(t,e.name,e.descriptor)}},ee=e=>e.forEach(n=>We[n.event](n));window.rxxxt={navigate:e=>{ee([{event:"navigate",location:new URL(e,location.href).href,requires_refresh:!0}])},init:e=>{H=new URL(location.href),H.pathname.endsWith(e.path)?H.pathname=H.pathname.slice(0,H.pathname.length-e.path.length):console.warn("Invalid base url!"),window.addEventListener("popstate",X.update),me.stateToken=e.state_token,ee(e.events),he()}};})();
